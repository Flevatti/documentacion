"use strict";(self.webpackChunkdocumentacion=self.webpackChunkdocumentacion||[]).push([[9618],{3905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>u});var n=t(7294);function l(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){l(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function r(e,a){if(null==e)return{};var t,n,l=function(e,a){if(null==e)return{};var t,n,l={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(l[t]=e[t]);return l}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=n.createContext({}),d=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},p=function(e){var a=d(e.components);return n.createElement(s.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,l=e.mdxType,o=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),m=d(t),u=l,v=m["".concat(s,".").concat(u)]||m[u]||c[u]||o;return t?n.createElement(v,i(i({ref:a},p),{},{components:t})):n.createElement(v,i({ref:a},p))}));function u(e,a){var t=arguments,l=a&&a.mdxType;if("string"==typeof e||l){var o=t.length,i=new Array(o);i[0]=m;var r={};for(var s in a)hasOwnProperty.call(a,s)&&(r[s]=a[s]);r.originalType=e,r.mdxType="string"==typeof e?e:l,i[1]=r;for(var d=2;d<o;d++)i[d]=t[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2262:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var n=t(7462),l=(t(7294),t(3905));const o={sidebar_position:11},i="API con .NET Core",r={unversionedId:"C--/API",id:"C--/API",title:"API con .NET Core",description:"Teoria",source:"@site/docs/C--/API.md",sourceDirName:"C--",slug:"/C--/API",permalink:"/documentacion/docs/C--/API",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/C--/API.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{sidebar_position:11},sidebar:"C",previous:{title:'Conceptos de "C#" - Parte 5',permalink:"/documentacion/docs/C--/guiaC5"},next:{title:"Autenticaci\xf3n JWT y Refresh Token en API REST",permalink:"/documentacion/docs/C--/autenticacion"}},s={},d=[{value:"Teoria",id:"teoria",level:2},{value:"\xbfQu\xe9 es una API?",id:"qu\xe9-es-una-api",level:4},{value:"\xbfC\xf3mo funciona HTTP?",id:"c\xf3mo-funciona-http",level:4},{value:"Solicitud",id:"solicitud",level:4},{value:"Respuesta",id:"respuesta",level:4},{value:"Objeto Request",id:"objeto-request",level:4},{value:"1- Verbo",id:"1--verbo",level:4},{value:"2- Encabezado",id:"2--encabezado",level:4},{value:"3- Contenido",id:"3--contenido",level:4},{value:"Objeto Response",id:"objeto-response",level:4},{value:"1- C\xf3digo de estado",id:"1--c\xf3digo-de-estado",level:4},{value:"2- Encabezado",id:"2--encabezado-1",level:4},{value:"3- Contenido",id:"3--contenido-1",level:4},{value:"Diferencias",id:"diferencias",level:4},{value:"Empezamos a desarrollar",id:"empezamos-a-desarrollar",level:2},{value:"Progamas requeridos",id:"progamas-requeridos",level:4},{value:"En SQL Server Management Studio",id:"en-sql-server-management-studio",level:4},{value:"Visual Studio",id:"visual-studio",level:4},{value:"MiApp_API",id:"miapp_api",level:4},{value:"Control de versiones",id:"control-de-versiones",level:4},{value:"C\xf3digo Clean Up",id:"c\xf3digo-clean-up",level:4},{value:"Clase Controlador",id:"clase-controlador",level:2},{value:"Primer Endpoint (url)",id:"primer-endpoint-url",level:2},{value:"Iniciamos",id:"iniciamos",level:4},{value:"Iniciamos de nuevo",id:"iniciamos-de-nuevo",level:4},{value:"Agregar Dto",id:"agregar-dto",level:2},{value:"Store Villa",id:"store-villa",level:2},{value:"Obtener una villa por Id (query)",id:"obtener-una-villa-por-id-query",level:2},{value:"Al ejecutarlo, nos tira un error.",id:"al-ejecutarlo-nos-tira-un-error",level:4},{value:"Lo ejecutamos y probamos con querys.",id:"lo-ejecutamos-y-probamos-con-querys",level:4},{value:"C\xf3digo de estado",id:"c\xf3digo-de-estado",level:2},{value:"Devolver c\xf3digo de estado 200",id:"devolver-c\xf3digo-de-estado-200",level:4},{value:"Devolvemos m\xfaltiples c\xf3digos de estado",id:"devolvemos-m\xfaltiples-c\xf3digos-de-estado",level:4},{value:"Tipos de respuesta",id:"tipos-de-respuesta",level:2},{value:"Verbo Post",id:"verbo-post",level:2},{value:"Mostrar informaci\xf3n del recurso creado",id:"mostrar-informaci\xf3n-del-recurso-creado",level:4},{value:"Validaciones ModelState",id:"validaciones-modelstate",level:2},{value:"Validaciones personalizadas",id:"validaciones-personalizadas",level:4},{value:"Verbo Delete (params)",id:"verbo-delete-params",level:2},{value:"Lo ejecutamos y probamos con params (par\xe1metros).",id:"lo-ejecutamos-y-probamos-con-params-par\xe1metros",level:4},{value:"Verbo Put",id:"verbo-put",level:2},{value:"Verbo Patch",id:"verbo-patch",level:2},{value:"Herramienta",id:"herramienta",level:4},{value:"Instalaci\xf3n",id:"instalaci\xf3n",level:4},{value:"Configuramos los servicios",id:"configuramos-los-servicios",level:4},{value:"Lo implementamos",id:"lo-implementamos",level:4},{value:"Al ejecutarlo",id:"al-ejecutarlo",level:4},{value:"Logger - inyecci\xf3n de dependencia",id:"logger---inyecci\xf3n-de-dependencia",level:2},{value:"Inyecci\xf3n de dependencia",id:"inyecci\xf3n-de-dependencia",level:4},{value:"Ya lo podemos usar",id:"ya-lo-podemos-usar",level:4},{value:"Modelos y Base de datos",id:"modelos-y-base-de-datos",level:2},{value:"Modelos",id:"modelos",level:4},{value:"Instalaci\xf3n de Entity Framework Core",id:"instalaci\xf3n-de-entity-framework-core",level:4},{value:"Nombre del servidor  SQLServer",id:"nombre-del-servidor--sqlserver",level:4},{value:"Atributo DatabaseGenerated",id:"atributo-databasegenerated",level:3},{value:"DbContext",id:"dbcontext",level:3},{value:"Code First",id:"code-first",level:4},{value:"Crear URL de conexi\xf3n",id:"crear-url-de-conexi\xf3n",level:4},{value:"Agregar servicio",id:"agregar-servicio",level:4},{value:"Aplicar inyecci\xf3n de dependencia",id:"aplicar-inyecci\xf3n-de-dependencia",level:4},{value:"Crear Base de datos y Tabla Villa",id:"crear-base-de-datos-y-tabla-villa",level:4},{value:"Emigraci\xf3n",id:"emigraci\xf3n",level:4},{value:"Como ejecutar una emigraci\xf3n",id:"como-ejecutar-una-emigraci\xf3n",level:4},{value:"Nos va a tirar un error porque no especificamos una certificaci\xf3n que diga que es seguro",id:"nos-va-a-tirar-un-error-porque-no-especificamos-una-certificaci\xf3n-que-diga-que-es-seguro",level:4},{value:"Lo ejecutamos de nuevo y ahora deber\xeda andar",id:"lo-ejecutamos-de-nuevo-y-ahora-deber\xeda-andar",level:4},{value:"Alimentar tabla Villa",id:"alimentar-tabla-villa",level:2},{value:"Ejecutamos los dos comandos de nuevo",id:"ejecutamos-los-dos-comandos-de-nuevo",level:4},{value:"En SQL Server Management Studio",id:"en-sql-server-management-studio-1",level:4},{value:"Usar ApplicationDbContext en API Controller",id:"usar-applicationdbcontext-en-api-controller",level:2},{value:"AsNoTracking en acci\xf3n",id:"asnotracking-en-acci\xf3n",level:2},{value:"\xbfQu\xe9 provoca el error?",id:"qu\xe9-provoca-el-error",level:4},{value:"Subir cambios a github",id:"subir-cambios-a-github",level:2},{value:"Separar DTO",id:"separar-dto",level:2},{value:"M\xe9todos Async",id:"m\xe9todos-async",level:2},{value:"Configurar AutoMapper y Mapping Config",id:"configurar-automapper-y-mapping-config",level:2},{value:"\xbfQu\xe9 pasar\xeda cuando el modelo tenga miles de propiedades?",id:"qu\xe9-pasar\xeda-cuando-el-modelo-tenga-miles-de-propiedades",level:4},{value:"Instalaci\xf3n de AutoMapper",id:"instalaci\xf3n-de-automapper",level:4},{value:"Creamos la clase MappingConfig",id:"creamos-la-clase-mappingconfig",level:4},{value:"Agregamos el servicio",id:"agregamos-el-servicio",level:4},{value:"Inyecci\xf3n de dependencia",id:"inyecci\xf3n-de-dependencia-1",level:4},{value:"Subir cambios a github",id:"subir-cambios-a-github-1",level:2},{value:"Agregar Interfaz Villa - Patr\xf3n Repositorio",id:"agregar-interfaz-villa---patr\xf3n-repositorio",level:2},{value:"Interfaces",id:"interfaces",level:4},{value:"Implementamos la interfaz",id:"implementamos-la-interfaz",level:4},{value:"Interfaz para la entidad Villa",id:"interfaz-para-la-entidad-villa",level:4},{value:"Agregarla como servicio",id:"agregarla-como-servicio",level:4},{value:"Usamos el servicio en el controlador",id:"usamos-el-servicio-en-el-controlador",level:4},{value:"API Response",id:"api-response",level:2},{value:"C\xf3digo de estado 204",id:"c\xf3digo-de-estado-204",level:4},{value:"Modelo N\xfamero de Villa",id:"modelo-n\xfamero-de-villa",level:2},{value:"Corregir error fecha creaci\xf3n/actualizaci\xf3n",id:"corregir-error-fecha-creaci\xf3nactualizaci\xf3n",level:4},{value:"Nuevo Modelo",id:"nuevo-modelo",level:4},{value:"Dtos",id:"dtos",level:4},{value:"Mapeo",id:"mapeo",level:4},{value:"DBContext",id:"dbcontext-1",level:4},{value:"Interfaces",id:"interfaces-1",level:4},{value:"Agregamos los servicios",id:"agregamos-los-servicios",level:4},{value:"Creamos el controlador",id:"creamos-el-controlador",level:4},{value:"Attribute routes with the same name &#39;GetVilla&#39; must have the same template",id:"attribute-routes-with-the-same-name-getvilla-must-have-the-same-template",level:4},{value:"Lo ejecutamos",id:"lo-ejecutamos",level:4},{value:"Deploy",id:"deploy",level:2},{value:"Habilitamos IIS",id:"habilitamos-iis",level:4},{value:"Carpeta inetpub",id:"carpeta-inetpub",level:4},{value:"En el proyecto",id:"en-el-proyecto",level:4},{value:"Pasos a seguir para hacer deploy",id:"pasos-a-seguir-para-hacer-deploy",level:4},{value:"Paso 1",id:"paso-1",level:4},{value:"Paso 2",id:"paso-2",level:4},{value:"En IIS",id:"en-iis",level:4},{value:"Configuraci\xf3n b\xe1sica de Grupo de aplicaciones",id:"configuraci\xf3n-b\xe1sica-de-grupo-de-aplicaciones",level:4},{value:"En el servidor (en IIS)",id:"en-el-servidor-en-iis",level:4},{value:"Desplegamos!",id:"desplegamos",level:4},{value:"Usar una BD",id:"usar-una-bd",level:4},{value:"\xa1Listo!",id:"listo",level:4}],p={toc:d};function c(e){let{components:a,...t}=e;return(0,l.kt)("wrapper",(0,n.Z)({},p,t,{components:a,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"api-con-net-core"},"API con .NET Core"),(0,l.kt)("h2",{id:"teoria"},"Teoria"),(0,l.kt)("h4",{id:"qu\xe9-es-una-api"},"\xbfQu\xe9 es una API?"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Significa interfaz de progamaci\xf3n de aplicaciones."),(0,l.kt)("li",{parentName:"ul"},"Permite que varias aplicaciones puedan comunicarse entre s\xed."),(0,l.kt)("li",{parentName:"ul"},"Es responsable de obtener una solicitud del cliente y luego enviarle una respuesta en funci\xf3n de la solicitud."),(0,l.kt)("li",{parentName:"ul"},"El cliente puede ser una aplicaci\xf3n web, de Windows, linux, m\xf3vil, etc."),(0,l.kt)("li",{parentName:"ul"},"Puede haber m\xfaltiples solicitudes/respuestas entre un cliente y la API.")),(0,l.kt)("h4",{id:"c\xf3mo-funciona-http"},"\xbfC\xf3mo funciona HTTP?"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Cuando navegamos a un sitio web, hacemos una solicitud a un servidor."),(0,l.kt)("li",{parentName:"ul"},"El servidor nos devuelve una respuesta (la p\xe1gina web que solicitamos ver)."),(0,l.kt)("li",{parentName:"ul"},"El servidor no tiene estado (no guarda cosas), solo se encarga de procesar solicitudes y devolver respuestas.")),(0,l.kt)("h4",{id:"solicitud"},"Solicitud"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Es un documento de texto."),(0,l.kt)("li",{parentName:"ul"},"Tiene tres datos:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Verbo: Contiene la acci\xf3n que debe realizar el servidor."),(0,l.kt)("li",{parentName:"ul"},"Encabezado: Tiene informaci\xf3n sobre la solicitud."),(0,l.kt)("li",{parentName:"ul"},"El Contenido: Es opcional y contiene toda la informaci\xf3n que necesita el servidor para realizar la acci\xf3n."))),(0,l.kt)("li",{parentName:"ul"},"El servidor puede procesar o rechazar el documento de texto.")),(0,l.kt)("h4",{id:"respuesta"},"Respuesta"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Contiene tres elementos: C\xf3digo de estado, encabezado y contenido. "),(0,l.kt)("li",{parentName:"ul"},"C\xf3digo de estado: Define si se realiz\xf3 con \xe9xito lo que se quer\xeda hacer o si por alguna raz\xf3n fallo. ")),(0,l.kt)("h4",{id:"objeto-request"},"Objeto Request"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Es la solicitud.")),(0,l.kt)("h4",{id:"1--verbo"},"1- Verbo"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Son acciones o verbos HTTP."),(0,l.kt)("li",{parentName:"ul"},"Define cual es la acci\xf3n que debe suceder."),(0,l.kt)("li",{parentName:"ul"},"Ejemplos:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"GET: Obtener alguna informaci\xf3n del servidor."),(0,l.kt)("li",{parentName:"ul"},"POST: Crear informaci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"PUT: Actualizar informaci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"PATCH: Actualizar una parte de la informaci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"DELETE: Eliminar informaci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"M\xe1s verbos\u2026")))),(0,l.kt)("h4",{id:"2--encabezado"},"2- Encabezado"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Son un conjunto de pares (clave-valor) que son metadatos sobre la solicitud."),(0,l.kt)("li",{parentName:"ul"},"Ejemplos:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Content Type: Define cual es el tipo de contenido de la solicitud. Es json , binario , xml , etc."),(0,l.kt)("li",{parentName:"ul"},"Content Lenght: Es el tama\xf1o del contenido."),(0,l.kt)("li",{parentName:"ul"},"Authorization: \xbfQui\xe9n esta haciendo el Request? Aca se suele poner el token para autenticarse."),(0,l.kt)("li",{parentName:"ul"},"Accept: Define que tipo de solicitud es aceptable. Puede ser json , xml , etc."),(0,l.kt)("li",{parentName:"ul"},"Mas encabezados\u2026."))),(0,l.kt)("li",{parentName:"ul"},"Tambien puedes definir tus propios encabezados.")),(0,l.kt)("h4",{id:"3--contenido"},"3- Contenido"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Es un campo opcional."),(0,l.kt)("li",{parentName:"ul"},"Aca se ubica el contenido que el servidor requerir\xe1 para completar la solicitud."),(0,l.kt)("li",{parentName:"ul"},"Cuando se utiliza GET, este campo no se utiliza.")),(0,l.kt)("h4",{id:"objeto-response"},"Objeto Response"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Es la respuesta.")),(0,l.kt)("h4",{id:"1--c\xf3digo-de-estado"},"1- C\xf3digo de estado"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Es un n\xfamero que representa lo que se hizo en el servidor:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"100-199: Es informativo."),(0,l.kt)("li",{parentName:"ul"},"200-299: La solicitud se complet\xf3 con \xe9xito:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"200: Todo se hizo seg\xfan lo solicitado."),(0,l.kt)("li",{parentName:"ul"},"201: Se creo algo con \xe9xito."),(0,l.kt)("li",{parentName:"ul"},"204: Sin contenido (Es comun cuando actualizamos algo y no queremos pasarle el registro actualizado, solo decirle que se actualizo)."))),(0,l.kt)("li",{parentName:"ul"},"300-399: Se usa con redirecci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"400-499: Hay un error en la solicitud que se envio.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"400: Solicitud incorrecta."),(0,l.kt)("li",{parentName:"ul"},"404: Recurso no encontrado."))),(0,l.kt)("li",{parentName:"ul"},"500-599: Hay un error en el servidor.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"500: Hay un error interno del servidor.")))))),(0,l.kt)("h4",{id:"2--encabezado-1"},"2- Encabezado"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Contiene metadatos sobre la respuesta."),(0,l.kt)("li",{parentName:"ul"},"Ejemplos:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Content-Type : Tipo de contenido."),(0,l.kt)("li",{parentName:"ul"},"Content-Lenght : Tama\xf1o del contenido."),(0,l.kt)("li",{parentName:"ul"},"Expires: Cuando es invalido."),(0,l.kt)("li",{parentName:"ul"},"M\xe1s encabezados\u2026")))),(0,l.kt)("h4",{id:"3--contenido-1"},"3- Contenido"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Esto puede contener HTML, CSS, XML, JSON, Blobs, etc. Lo que sea que el servidor tenga que enviar en el contenido para completar la solicitud."),(0,l.kt)("li",{parentName:"ul"},"Aca se suele guardar la  respuesta del servidor.")),(0,l.kt)("h4",{id:"diferencias"},"Diferencias"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ambos tienen encabezado y contenido."),(0,l.kt)("li",{parentName:"ul"},"La solicitud tiene un verbo y la respuesta tiene un c\xf3digo de estado.")),(0,l.kt)("h2",{id:"empezamos-a-desarrollar"},"Empezamos a desarrollar"),(0,l.kt)("h4",{id:"progamas-requeridos"},"Progamas requeridos"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Requisitos:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Visual studio."),(0,l.kt)("li",{parentName:"ul"},".NET 7.0."),(0,l.kt)("li",{parentName:"ul"},"Microsoft sql server \u2013 versi\xf3n desarrolladora (instalar SSMS)."),(0,l.kt)("li",{parentName:"ul"},"Git.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Podemos verificar la versi\xf3n en la consola con el comando dotnet --version         ")))),(0,l.kt)("h4",{id:"en-sql-server-management-studio"},"En SQL Server Management Studio"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En Server Name: localhost (es el nombre con el que se instal\xf3)."),(0,l.kt)("li",{parentName:"ul"},"Authentication: Windows Authentication."),(0,l.kt)("li",{parentName:"ul"},"Hacemos click en Connect.")),(0,l.kt)("h4",{id:"visual-studio"},"Visual Studio"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Nuevo proyecto."),(0,l.kt)("li",{parentName:"ol"},"En los filtros: C# -- Todas las plataformas \u2013 Web."),(0,l.kt)("li",{parentName:"ol"},"Seleccionamos la plantilla ASP.NET Core Web API:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Nombre del proyecto: MiApp_API."),(0,l.kt)("li",{parentName:"ul"},"Nombre de la soluci\xf3n: MiApp."),(0,l.kt)("li",{parentName:"ul"},"Desmarcar la opcion \u201cColocar  soluci\xf3n y proyecto en el mismo directorio\u201d."),(0,l.kt)("li",{parentName:"ul"},"Framework: .Net 7.0."),(0,l.kt)("li",{parentName:"ul"},"Autenticacion: Ninguna (Luego lo vamos a hacer nosotros)."),(0,l.kt)("li",{parentName:"ul"},"Marcamos la opcion \u201cUsar controladores\u201d."))),(0,l.kt)("li",{parentName:"ol"},"Y creamos el proyecto.",(0,l.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Una soluci\xf3n es un contenedor donde pueden ir uno o varios proyectos."))))),(0,l.kt)("h4",{id:"miapp_api"},"MiApp_API"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el archivo con el nombre del proyecto, en este caso MiApp_API ,  podemos ver la versi\xf3n ,  paquetes , etc.")),(0,l.kt)("h4",{id:"control-de-versiones"},"Control de versiones"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Para controlar los cambios vamos a usar git  y github.")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Hay que registrar un usuario y email en git."),(0,l.kt)("li",{parentName:"ol"},"Creamos un repositorio en github."),(0,l.kt)("li",{parentName:"ol"},"En visual studio , click derecho en el nombre de la soluci\xf3n \u2013 Abrir en terminal."),(0,l.kt)("li",{parentName:"ol"},"En la terminal ingresamos los comandos que nos aparece al crear el repositorio de Github:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-powershell"},"Git init\nGit add .\nGit commit -m \u201cCreacion Proyecto\u201d\ngit branch -M main\ngit remote add origin XX \ngit push -u origin main\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"MiApp.sln es el nombre de la soluci\xf3n y cada directorio es un proyecto.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://fedeleva.github.io/documentacion/docs/Git/github"},"Mas informaci\xf3n sobre git/github")," ")))),(0,l.kt)("h4",{id:"c\xf3digo-clean-up"},"C\xf3digo Clean Up"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Eliminamos el controlador que se gener\xf3 como ejemplo:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Controllers/WeatherForecastController.cs"),(0,l.kt)("li",{parentName:"ul"},"WeatherForecast.cs"))),(0,l.kt)("li",{parentName:"ul"},"Lo que queda del proyecto, son los archivos/carpetas esenciales."),(0,l.kt)("li",{parentName:"ul"},"Carpeta controllers: Es donde vamos a crear controladores con sus endpoints (url)."),(0,l.kt)("li",{parentName:"ul"},"Clase Progam.cs : Es donde creamos los servicios.")),(0,l.kt)("h2",{id:"clase-controlador"},"Clase Controlador"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Click derecho en la carpeta Controllers \u2013 Agregar \u2013 Controlador. "),(0,l.kt)("li",{parentName:"ol"},"Creamos un Controlador de API en blanco:"),(0,l.kt)("li",{parentName:"ol"},"Le damos un nombre: VillaController.cs"),(0,l.kt)("li",{parentName:"ol"},"Hacemos click en \u201cagregar\u201d.")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},'El nombre debe terminar con la palabra "Controller".')))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"El archivo quedar\xeda:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Mvc;\n\nnamespace MiApp_API.Controllers\n{\n    [Route("api/[controller]")]\n    [ApiController]\n    public class VillaController : ControllerBase\n    {\n    }\n}\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Es una clase que hereda de ControllerBase , que hace que sea una clase de tipo controlador."),(0,l.kt)("li",{parentName:"ul"},"Tiene el atributo \u201c","[ApiController]","\u201d que identifica el tipo de controlador, en este caso de API."),(0,l.kt)("li",{parentName:"ul"},'Luego la l\xednea \u201c[Route("api/',"[controller]",'")]\u201d nos especifica la ruta del controlador.',(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"controller representa el nombre del controlador."),(0,l.kt)("li",{parentName:"ul"},"El nombre de la clase  sin la palabra Controller es el nombre del controlador.")))))),(0,l.kt)("h2",{id:"primer-endpoint-url"},"Primer Endpoint (url)"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Una API normalmente retorna datos."),(0,l.kt)("li",{parentName:"ul"},"Un modelo contiene los \u201cdatos\u201d que manejar\xeda una Base de datos."),(0,l.kt)("li",{parentName:"ul"},"En el proyecto, creamos la carpeta Modelos y adentro una Clase llamada Villa."),(0,l.kt)("li",{parentName:"ul"},"La clase quedar\xeda asi:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"namespace MiApp_API.Modelos\n{\n    public class Villa\n    {\n        public int Id { get; set; }\n        public string Nombre { get; set; }\n\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Escribiendo prop y d\xe1ndole dos veces a tab, nos genera la sintaxis para crear una propiedad.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el controlador:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using MiApp_API.Modelos;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Mvc;\n\nnamespace MiApp_API.Controllers\n{\n    [Route("api/[controller]")]\n    [ApiController]\n    public class VillaController : ControllerBase\n    {\n        public IEnumerable<Villa> GetVillas()\n        {\n            return new List<Villa>\n            {\n                new Villa{Id=1, Nombre="Vista a la Piscina"},\n                new Villa{Id=2, Nombre = "Vista a la Playa"}\n            };\n        }\n    }\n}\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Creamos un Endpoint que a simple vista es un m\xe9todo llamado GetVillas() que es publico y devuelve una lista."),(0,l.kt)("li",{parentName:"ul"},"Como es un metodo Get , el nombre del  metodo arranca con \u201cGet\u201d")))),(0,l.kt)("h4",{id:"iniciamos"},"Iniciamos"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Hacemos click en Iniciar https."),(0,l.kt)("li",{parentName:"ol"},"Nos abre el navegador (sin HTTPS, entra igual), con un error.")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"El error nos indica que nuestra API no est\xe1 documentada."),(0,l.kt)("li",{parentName:"ul"},"Cada \u201cEndpoint (m\xe9todo como el anterior)\u201d debe especificar qu\xe9 acci\xf3n hace."),(0,l.kt)("li",{parentName:"ul"},"Esto se realiza con un atributo  ","[HttpVERBO]",":")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'     [HttpGet]\n        public IEnumerable<Villa> GetVillas()\n        {\n            return new List<Villa>\n            {\n                new Villa{Id=1, Nombre="Vista a la Piscina"},\n                new Villa{Id=2, Nombre = "Vista a la Playa"}\n            };\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Especificamos que es una acci\xf3n Get (obtener informaci\xf3n)."),(0,l.kt)("li",{parentName:"ul"},"Por defecto , si no especificamos ning\xfan par\xe1metro en el atributo ","[HttpVERBO]"," , se utiliza la ruta del controlador para ejecutar (enviar una solicitud) el \u201cendpoint\u201d.")))),(0,l.kt)("h4",{id:"iniciamos-de-nuevo"},"Iniciamos de nuevo"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Iniciamos de nueva la aplicaci\xf3n."),(0,l.kt)("li",{parentName:"ol"},"En el navegador podemos ver nuestros endpoints (url)."),(0,l.kt)("li",{parentName:"ol"},"Hacemos click en /api/Villa \u2013 Try it out \u2013 Execute"),(0,l.kt)("li",{parentName:"ol"},"Nos devolver\xeda la informaci\xf3n que especificamos en el m\xe9todo GET.")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Endpoint")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Un endpoint es una direcci\xf3n(URL) de una API , que se encarga de dar respuesta a una solicitud."),(0,l.kt)("li",{parentName:"ul"},"Las solicitudes las hacemos a trav\xe9s de URLs que son llamadas endpoint."),(0,l.kt)("li",{parentName:"ul"},"El servidor procesa la solicitud que enviaste por la url y luego te devuelve una respuesta.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Cuando ingresas a una p\xe1gina en el navegador, estas haciendo una petici\xf3n GET."),(0,l.kt)("li",{parentName:"ul"},"En .Net un endpoint es un m\xe9todo."),(0,l.kt)("li",{parentName:"ul"},"En la documentacion de Microsoft , un endpoint suele llamarse \u201cacci\xf3n\u201d.")))),(0,l.kt)("h2",{id:"agregar-dto"},"Agregar Dto"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Las clases DTO especifican que informaci\xf3n debe ser \u201cexpuesta\u201d al usuario."),(0,l.kt)("li",{parentName:"ul"},"Los controladores(endpoints) deben devolver instanciar de las clases DTO y NO de los modelos."),(0,l.kt)("li",{parentName:"ul"},"Creamos una carpeta llamada Dto en Modelos y en esta carpeta creamos la clase VillaDto."),(0,l.kt)("li",{parentName:"ul"},"En Modelos/Villa.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"namespace MiApp_API.Modelos\n{\n    public class Villa\n    {\n        public int Id { get; set; }\n        public string Nombre { get; set; }\n        public DateTime FechaCreacion { get; set; }\n\n    }\n}\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En Modelos/Dto/VillaDto.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"namespace MiApp_API.Modelos.Dto\n{\n    public class VillaDto\n    {\n        public int Id { get; set; }\n        public String Nombre { get; set; }\n    }\n}\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el controller:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using MiApp_API.Modelos;\nusing MiApp_API.Modelos.Dto;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Mvc;\n\nnamespace MiApp_API.Controllers\n{\n    [Route("api/[controller]")]\n    [ApiController]\n    public class VillaController : ControllerBase\n    {\n        [HttpGet]\n        public IEnumerable<VillaDto> GetVillas()\n        {\n            return new List<VillaDto>\n            {\n                new VillaDto{Id=1, Nombre="Vista a la Piscina"},\n                new VillaDto{Id=2, Nombre = "Vista a la Playa"}\n            };\n        }\n    }\n}\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"La API solo devolver\xe1 la id y el Nombre, la fecha de creaci\xf3n NO.")))),(0,l.kt)("h2",{id:"store-villa"},"Store Villa"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Una API generalmente usa una Base de datos."),(0,l.kt)("li",{parentName:"ul"},"Todavia no usaremos una base de dato, por eso creamos datos ficticios en un \u201cstore\u201d."),(0,l.kt)("li",{parentName:"ul"},"En el proyecto, creamos una carpeta llamada Datos. Adentro de la carpeta creamos la clase VillaStore:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using MiApp_API.Modelos.Dto;\n\n\nnamespace MiApp_API.Datos\n{\n    public static class VillaStore\n    {\n        public static List<VillaDto> villaList = new List<VillaDto> {\n            new VillaDto{Id = 1 ,  Nombre = "Vista a la Piscina" },\n             new VillaDto{Id = 2 , Nombre = "Vista a la Playa"}\n        };\n    }\n}\n\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En nuestro controlador:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using MiApp_API.Datos;\nusing MiApp_API.Modelos;\nusing MiApp_API.Modelos.Dto;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Mvc;\n\nnamespace MiApp_API.Controllers\n{\n    [Route("api/[controller]")]\n    [ApiController]\n    public class VillaController : ControllerBase\n    {\n        [HttpGet]\n        public IEnumerable<VillaDto> GetVillas()\n        {\n            return VillaStore.villaList;\n        }\n    }\n}\n\n')),(0,l.kt)("h2",{id:"obtener-una-villa-por-id-query"},"Obtener una villa por Id (query)"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Vamos a crear otro endpoint que nos permita conseguir una villa por la ID."),(0,l.kt)("li",{parentName:"ul"},"En el controller:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using MiApp_API.Datos;\nusing MiApp_API.Modelos;\nusing MiApp_API.Modelos.Dto;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Mvc;\n\nnamespace MiApp_API.Controllers\n{\n    [Route("api/[controller]")]\n    [ApiController]\n    public class VillaController : ControllerBase\n    {\n        [HttpGet]\n        public IEnumerable<VillaDto> GetVillas()\n        {\n            return VillaStore.villaList;\n        }\n\n        [HttpGet]\n        public VillaDto GetVilla(int id)\n        {\n            return VillaStore.villaList.FirstOrDefault(v => v.Id == id);\n        }\n    }\n\n  \n}\n\n')),(0,l.kt)("h4",{id:"al-ejecutarlo-nos-tira-un-error"},"Al ejecutarlo, nos tira un error."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"El error se debe a que tenemos dos endpoints (m\xe9todos) que apuntan a la misma url y tienen el mismo verbo (Get)."),(0,l.kt)("li",{parentName:"ul"},"Para solucionar esto debemos distinguirlos.  Para esto vamos a especificar que el nuevo endpoint (el que creamos recien) tiene el \u201cid\u201d en la ruta."),(0,l.kt)("li",{parentName:"ul"},"De esta manera modificamos el endpoint y pasamos la id por una query:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'   [HttpGet("id")]\n    public VillaDto GetVilla(int id)\n    {\n        return VillaStore.villaList.FirstOrDefault(v => v.Id == id);\n    }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El par\xe1metro posicional del atributo HttpGet indicara cual es la ruta(endpoint) para solicitar la acci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"Entonces para acceder a un endpoint con [HttpGet(\u201cAA/BB/\u2026.\u201d) , se utilizara la ruta /api/nombreController/AA/BB/\u2026."),(0,l.kt)("li",{parentName:"ul"},"Esto lo puede aplicar con el resto de atributos que representen un verbo.")))),(0,l.kt)("h4",{id:"lo-ejecutamos-y-probamos-con-querys"},"Lo ejecutamos y probamos con querys."),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"query")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El query es una \u201cvariable\u201d de la url que contiene un valor. Es el par\xe1metro que se le pasa al m\xe9todo."),(0,l.kt)("li",{parentName:"ul"},"Las query van despues del signo \u201c?\u201d."),(0,l.kt)("li",{parentName:"ul"},"Ejemplo:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Si entramos a la url: /api/Villa/id:int?id=1"),(0,l.kt)("li",{parentName:"ul"},"El valor de id es 1"),(0,l.kt)("li",{parentName:"ul"},"Si entramos a la url: /api/Villa/id:int?id=2"),(0,l.kt)("li",{parentName:"ul"},"El valor de id es 2")))))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Incluso podemos especificar ",(0,l.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/aspnet/web-api/overview/web-api-routing-and-actions/attribute-routing-in-web-api-2#route-constraints"},"el tipo de dato"),":")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'  [HttpGet("id:int")]\n        public VillaDto GetVilla(int id)\n        {\n            return VillaStore.villaList.FirstOrDefault(v => v.Id == id);\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"\u201cid:int\u201d va entre llaves \u201c{}\u201d para que funcione la validaci\xf3n, pero para mostrar un ejemplo de un endpoint con query lo dejamos asi.")))),(0,l.kt)("h2",{id:"c\xf3digo-de-estado"},"C\xf3digo de estado"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Vamos a utilizar ActionResult","<","T>:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"    public ActionResult<IEnumerable<VillaDto>> GetVillas()\n        {\n            return VillaStore.villaList;\n        }\n\n")),(0,l.kt)("h4",{id:"devolver-c\xf3digo-de-estado-200"},"Devolver c\xf3digo de estado 200"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Con ActionResult","<","T> podemos devolver m\xfaltiples cosas (el objeto que especificamos en el tipo de dato gen\xe9rico de ActionResult y el c\xf3digo de estado, por ejemplo):")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"     [HttpGet]\n        public ActionResult<IEnumerable<VillaDto>> GetVillas()\n        {\n\n            return Ok(VillaStore.villaList); \n        }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Con el m\xe9todo Ok(valor), devolvemos un c\xf3digo de estado 200 y el valor (en el contenido de la respuesta) al usuario que realizo la petici\xf3n.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Realizamos lo mismo con el otro:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'   [HttpGet("id:int")]\n        public ActionResult<VillaDto> GetVilla(int id)\n        {\n            return Ok(VillaStore.villaList.FirstOrDefault(v => v.Id == id));\n           \n        }\n\n')),(0,l.kt)("h4",{id:"devolvemos-m\xfaltiples-c\xf3digos-de-estado"},"Devolvemos m\xfaltiples c\xf3digos de estado"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'  [HttpGet("id:int")]\n        public ActionResult<VillaDto> GetVilla(int id)\n        {\n            if (id==0)\n            {\n                return BadRequest();\n            }\n\n            var villa = VillaStore.villaList.FirstOrDefault(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n            return Ok(villa);\n           \n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"BadRequest() devuelve el c\xf3digo de estado 400."),(0,l.kt)("li",{parentName:"ul"},"NotFound() devuelve el c\xf3digo de estado 404.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/aspnet/core/web-api/action-return-types?view=aspnetcore-7.0"},"Controller action return types in ASP.NET Core web API"))))),(0,l.kt)("h2",{id:"tipos-de-respuesta"},"Tipos de respuesta"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Con el atributo ProducesResponseType \u201cdocumentamos\u201d que respuestas nos puede devolver el servidor cuando hacemos una solicitud a un endpoint."),(0,l.kt)("li",{parentName:"ul"},"Con ","[ProducesResponseType(c\xf3digo_de_estado)]"," estamos especificando que nos puede devolver ese c\xf3digo de estado:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'[HttpGet("id:int")]\n        [ProducesResponseType(200)]\n        [ProducesResponseType(400)]\n        [ProducesResponseType(404)]\n        public ActionResult<VillaDto> GetVilla(int id)\n\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Tambi\xe9n podemos utilizar la clase est\xe1tica StatusCodes que contiene constantes con todos los c\xf3digos de estado:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'[HttpGet("id:int")]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        public ActionResult<VillaDto> GetVilla(int id)\n\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Con el otro endpoint hacemos lo mismo:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"  [HttpGet]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        public ActionResult<IEnumerable<VillaDto>> GetVillas()\n")),(0,l.kt)("h2",{id:"verbo-post"},"Verbo Post"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Vamos a utilizar el verbo POST para crear una villa."),(0,l.kt)("li",{parentName:"ul"},"En el controlador:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"       [HttpPost]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status500InternalServerError)]\n        public ActionResult<VillaDto> crearVilla([FromBody] VillaDto villaDto) { \n            if (villaDto == null)\n            {\n                return BadRequest(villaDto);\n            }\n            if(villaDto.Id > 0) {\n                return StatusCode(StatusCodes.Status500InternalServerError);\n            }\n            villaDto.Id = VillaStore.villaList.OrderByDescending(v => v.Id).FirstOrDefault().Id + 1;\n            VillaStore.villaList.Add(villaDto);\n            return Ok(villaDto);\n        }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El atributo ","[HttpPost]"," especifica que es una acci\xf3n POST (crea algo)."),(0,l.kt)("li",{parentName:"ul"},"Con el atributo ","[FromBody]"," especificamos que el valor del argumento lo recibimos en el body(contenido) de la solicitud/petici\xf3n."),(0,l.kt)("li",{parentName:"ul"},"BadRequest(valor) devuelve el c\xf3digo de estado 404 y un valor (en el contenido de la respuesta)."),(0,l.kt)("li",{parentName:"ul"},"StatusCode(C\xf3digo_de_estado) devuelve el c\xf3digo de estado que le pasamos. Recibe como parametro el mismo valor que el par\xe1metro posicional del atributo ProducesResponseType.")))),(0,l.kt)("h4",{id:"mostrar-informaci\xf3n-del-recurso-creado"},"Mostrar informaci\xf3n del recurso creado"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En algunas API queremos que, al crear el recurso, te muestre la url(endpoint) para obtener la informaci\xf3n de este."),(0,l.kt)("li",{parentName:"ul"},"En pocas palabras, al crear un recurso, debemos retornar la informaci\xf3n de este para que el usuario sepa que cosa se cre\xf3."),(0,l.kt)("li",{parentName:"ul"},"Para esto utilizamos el m\xe9todo CreatedAtRoute(nombre , argumentos_para_el_metodo_endpoint, el contenido) :",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"nombre: Nombre de la ruta (del m\xe9todo que representa un endpoint). El nombre se define mediante el atributo HttpGet."),(0,l.kt)("li",{parentName:"ul"},"Argumentos_para_el_metodo_endpoint: Los datos que se piden como par\xe1metros para el m\xe9todo que maneja el \u201cendpoint\u201d que corresponde al nombre."),(0,l.kt)("li",{parentName:"ul"},"Contenido: El \u201cformato\u201d que debe tener el contenido de la respuesta."))),(0,l.kt)("li",{parentName:"ul"},"Entonces en el c\xf3digo:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'     [HttpGet("id:int" , Name ="GetVilla")]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        public ActionResult<VillaDto> GetVilla(int id)\n        {\n            if (id==0)\n            {\n                return BadRequest();\n            }\n\n            var villa = VillaStore.villaList.FirstOrDefault(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n            return Ok(villa);\n           \n        }\n\n        [HttpPost]\n        [ProducesResponseType(StatusCodes.Status201Created)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status500InternalServerError)]\n        public ActionResult<VillaDto> crearVilla([FromBody] VillaDto villaDto) { \n            if (villaDto == null)\n            {\n                return BadRequest(villaDto);\n            }\n            if(villaDto.Id > 0) {\n                return StatusCode(StatusCodes.Status500InternalServerError);\n            }\n            villaDto.Id = VillaStore.villaList.OrderByDescending(v => v.Id).FirstOrDefault().Id + 1;\n            VillaStore.villaList.Add(villaDto);\n           return CreatedAtRoute("GetVilla" , new {id= villaDto.Id } , villaDto);\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"En el m\xe9todo GetVilla tenemos el atributo HttpGet ,el cual le a\xf1adimos un par\xe1metro nombrado llamado Name . El valor puede ser cualquier String."),(0,l.kt)("li",{parentName:"ul"},"El valor del par\xe1metro Name es el valor del primer par\xe1metro del m\xe9todo CreatedAtRoute. A trav\xe9s de este m\xe9todo:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Generamos un c\xf3digo de estado 201."),(0,l.kt)("li",{parentName:"ul"},"Llamamos al endpoint (m\xe9todo) , que especificamos en el primer par\xe1metro, a trav\xe9s de su nombre. Con el segundo par\xe1metro les pasamos los par\xe1metros al m\xe9todo a trav\xe9s de un objeto an\xf3nimo y por \xfaltimo con el tercer par\xe1metro le decimos que informaci\xf3n queremos devolverle en el contenido de la respuesta a trav\xe9s de un objeto."),(0,l.kt)("li",{parentName:"ul"},"Lo que de verdad hace: Utiliza el primer y segundo par\xe1metro para especificar que endpoint(m\xe9todo) se usa para obtener la informaci\xf3n del recurso que se cre\xf3 (esta informaci\xf3n est\xe1 en la propiedad  \u201clocation\u201d en el encabezado) y utiliza el tercer par\xe1metro para mostrarle informaci\xf3n al usuario a trav\xe9s del contenido(body) de la respuesta.")))))),(0,l.kt)("h2",{id:"validaciones-modelstate"},"Validaciones ModelState"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Podemos utilizar atributos en la clase Dto para hacer validaciones."),(0,l.kt)("li",{parentName:"ul"},"Por ejemplo:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.ComponentModel.DataAnnotations;\n\nnamespace MiApp_API.Modelos.Dto\n{\n    public class VillaDto\n    {\n        public int Id { get; set; }\n\n        [Required]\n        [MaxLength(30)]\n        public String Nombre { get; set; }\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Los atributos para validar, son del namespace DataAnnotations."),(0,l.kt)("li",{parentName:"ul"},"La propiedad nombre es Obligatoria y como m\xe1ximo tiene 30 caracteres.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el controller podemos controlar si se cumplieron las validaciones:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'[HttpPost]\n        [ProducesResponseType(StatusCodes.Status201Created)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status500InternalServerError)]\n        public ActionResult<VillaDto> crearVilla([FromBody] VillaDto villaDto) { \n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n\n            if (villaDto == null)\n            {\n                return BadRequest(villaDto);\n            }\n            if(villaDto.Id > 0) {\n                return StatusCode(StatusCodes.Status500InternalServerError);\n            }\n            villaDto.Id = VillaStore.villaList.OrderByDescending(v => v.Id).FirstOrDefault().Id + 1;\n            VillaStore.villaList.Add(villaDto);\n           return CreatedAtRoute("GetVilla" , new {id= villaDto.Id } , villaDto);\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"ModelState.IsValid Devuelve true si se cumplen las validaciones. En caso contrario false."),(0,l.kt)("li",{parentName:"ul"},"ModelState viene de ControllerBase")))),(0,l.kt)("h4",{id:"validaciones-personalizadas"},"Validaciones personalizadas"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'public ActionResult<VillaDto> crearVilla([FromBody] VillaDto villaDto) { \n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n\n            if (VillaStore.villaList.FirstOrDefault(v => v.Nombre.ToLower() == villaDto.Nombre.ToLower()) != null)\n            {\n                ModelState.AddModelError("NombreExiste", "La villa con ese nombre ya existe");\n                 return BadRequest(ModelState);\n            }\n\n            if (villaDto == null)\n            {\n                return BadRequest(villaDto);\n            }\n            if(villaDto.Id > 0) {\n                return StatusCode(StatusCodes.Status500InternalServerError);\n            }\n            villaDto.Id = VillaStore.villaList.OrderByDescending(v => v.Id).FirstOrDefault().Id + 1;\n            VillaStore.villaList.Add(villaDto);\n           return CreatedAtRoute("GetVilla" , new {id= villaDto.Id } , villaDto);\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Usamos el metodo ModelState.AddModelError(\u201cNombreValidaci\xf3n\u201d , \u201cMensaje\u201d) para crear un \u201cerror de validaci\xf3n\u201d en el modelo de validaciones(ModelState) que contiene el endpoint (m\xe9todo).")))),(0,l.kt)("h2",{id:"verbo-delete-params"},"Verbo Delete (params)"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Con el verbo delete podemos eliminar un recurso."),(0,l.kt)("li",{parentName:"ul"},"En el controlador:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'\n       [HttpDelete("{id:int}")]\n        [ProducesResponseType(StatusCodes.Status204NoContent)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public IActionResult DeleteVilla(int id)\n        {\n            if (id == 0)\n            {\n                return BadRequest();\n            }\n\n            var villa = VillaStore.villaList.FirstOrDefault(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n            VillaStore.villaList.Remove(villa);\n            return NoContent();\n        }\n\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"En este caso utilizamos IActionResult porque no necesitamos retornar/devolver el modelo/Dto (una instancia de la clase)."),(0,l.kt)("li",{parentName:"ul"},"Usamos el atributo ",'[HttpDelete("{id:int}")]'," para indicar que va a recibir una \u201cid\u201d en la url como par\xe1metro(params) y no como query.  Si usamos las llaves ({}) es porque es una parte de la url din\xe1mica (params)."),(0,l.kt)("li",{parentName:"ul"},"El m\xe9todo NoContent() devuelve el c\xf3digo de estado 204 (El servidor realizo con \xe9xito la petici\xf3n que pediste pero no te devolvi\xf3 contenido).")))),(0,l.kt)("h4",{id:"lo-ejecutamos-y-probamos-con-params-par\xe1metros"},"Lo ejecutamos y probamos con params (par\xe1metros)."),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Parametro")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Es una \u201cvariable\u201d que se ubica en la URL. No es lo mismo que las query (Se ubican despu\xe9s del signo \u201c?\u201d)."),(0,l.kt)("li",{parentName:"ul"},"Lo que se define entre llaves {} en el parametro posicional de los atributos HttpVERBO son los params (par\xe1metros) de la url."),(0,l.kt)("li",{parentName:"ul"},"Estos se pueden utilizar en todos los atributos que representen un verbo."),(0,l.kt)("li",{parentName:"ul"},"Ejemplo:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},'[HttpGet("{nombrevariable}"]'),(0,l.kt)("li",{parentName:"ul"},"la ruta es /api/nombreController/nombrevariable"),(0,l.kt)("li",{parentName:"ul"},"Entonces si vamos a /api/nombreController/620a5b245908e57941d2954c"),(0,l.kt)("li",{parentName:"ul"},"El valor de nombrevariable es 620a5b245908e57941d2954c")))))),(0,l.kt)("h2",{id:"verbo-put"},"Verbo Put"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Es un verbo para actualizar un registro entero. Si solo queremos actualizar una o varias propiedades (pero no todas) de un objeto usamos el verbo patch."),(0,l.kt)("li",{parentName:"ul"},"Para esto, a\xf1adimos m\xe1s informaci\xf3n en la claseDto:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.ComponentModel.DataAnnotations;\n\nnamespace MiApp_API.Modelos.Dto\n{\n    public class VillaDto\n    {\n        public int Id { get; set; }\n\n        [Required]\n        [MaxLength(30)]\n        public String Nombre { get; set; }\n        public int Ocupantes { get; set; }\n        public int MetrosCuadrados { get; set; }\n    }\n}\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Modificamos el VillaStore:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using MiApp_API.Modelos.Dto;\n\n\nnamespace MiApp_API.Datos\n{\n    public static class VillaStore\n    {\n        public static List<VillaDto> villaList = new List<VillaDto> {\n            new VillaDto{Id = 1 ,  Nombre = "Vista a la Piscina"  , Ocupantes = 3 , MetrosCuadrados = 50},\n             new VillaDto{Id = 2 , Nombre = "Vista a la Playa" , Ocupantes = 4 , MetrosCuadrados = 80}\n        };\n    }\n}\n\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el controlador:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'    [HttpPut ("{id:int}")]\n        [ProducesResponseType(StatusCodes.Status204NoContent)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public IActionResult UpdateVilla(int id , [FromBody] VillaDto villaDto)\n        {\n            if (villaDto == null || id!= villaDto.Id)\n            {\n                return BadRequest();\n            }\n            var villa = VillaStore.villaList.FirstOrDefault(v => v.Id == id);\n            villa.Nombre = villaDto.Nombre;\n            villa.Ocupantes = villaDto.Ocupantes;\n            villa.MetrosCuadrados = villaDto.MetrosCuadrados;\n            return NoContent();\n        }\n\n')),(0,l.kt)("h2",{id:"verbo-patch"},"Verbo Patch"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Con el verbo patch actualizamos una o varias propiedades (no todas) de un objeto.")),(0,l.kt)("h4",{id:"herramienta"},"Herramienta"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Utilizaremos la herramienta ",(0,l.kt)("a",{parentName:"li",href:"https://jsonpatch.com/"},"Json Patch"),".")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/aspnet/core/web-api/jsonpatch?view=aspnetcore-7.0"},"JsonPatch in ASP.NET Core web API"))))),(0,l.kt)("h4",{id:"instalaci\xf3n"},"Instalaci\xf3n"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"En Visual studio:  Herramienta \u2013 Administracion de paquetes Nuget \u2013 Administrar paquetes Nuget Para la soluci\xf3n -- Examinar."),(0,l.kt)("li",{parentName:"ol"},"Buscamos los siguientes paquetes y los instalamos en el proyecto con la misma versi\xf3n que estamos trabajando (7.0.0):",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Microsoft.AspNetCore.JsonPatch"),(0,l.kt)("li",{parentName:"ul"},"Microsoft.AspNetCore.Mvc.NewtonsoftJson")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Nuget")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"NuGet es un gestor de paquetes(dependencias/m\xf3dulos/funcionalidades/plugin/paquetes) dise\xf1ado para permitir a los desarrolladores compartir c\xf3digo reutilizable. "),(0,l.kt)("li",{parentName:"ul"},"Los paquetes de NuGet son unidades de c\xf3digo reutilizable que otros desarrolladores ponen a tu disposici\xf3n para que los use en tus proyectos. "),(0,l.kt)("li",{parentName:"ul"},"B\xe1sicamente sirven para \u201cimportar una funcionalidad que otro Desarollador creo\u201d.")))),(0,l.kt)("h4",{id:"configuramos-los-servicios"},"Configuramos los servicios"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Vamos a la clase Progam.cs que es donde configuramos los servicios:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"var builder = WebApplication.CreateBuilder(args);\n\n// Add services to the container.\n\nbuilder.Services.AddControllers().AddNewtonsoftJson();\n// Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle\nbuilder.Services.AddEndpointsApiExplorer();\nbuilder.Services.AddSwaggerGen();\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Solo le a\xf1adimos \u201c.AddNewtonsoftJson();\u201d"),(0,l.kt)("li",{parentName:"ul"},"Con esa l\xednea, ya a\xf1adimos el servicio que descargamos al proyecto (API).")))),(0,l.kt)("h4",{id:"lo-implementamos"},"Lo implementamos"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el controlador:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'        [HttpPatch("{id:int}")]\n        [ProducesResponseType(StatusCodes.Status204NoContent)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public IActionResult UpdatePartialVilla(int id, JsonPatchDocument<VillaDto> patchDto)\n        {\n            if (patchDto == null || id == 0)\n            {\n                return BadRequest();\n            }\n            var villa = VillaStore.villaList.FirstOrDefault(v => v.Id == id);\n            patchDto.ApplyTo(villa , ModelState);\n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n            return NoContent();\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Es lo mismo que put, pero con algunas diferencias."),(0,l.kt)("li",{parentName:"ul"},"JsonPatchDocument tiene como par\xe1metro de tipo generico la clase DTO que se va a utilizar (esta va a contener los nuevos datos)."),(0,l.kt)("li",{parentName:"ul"},"patchDto.ApplyTo recibe dos par\xe1metros:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"El Modelo (una instancia de la clase DTO): El objeto que se va a modificar."),(0,l.kt)("li",{parentName:"ul"},"El ModelState : Te permite recibir mensajes de error en la respuesta. (Es opcional).")))))),(0,l.kt)("h4",{id:"al-ejecutarlo"},"Al ejecutarlo"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el body(contenido) se debe enviar los siguientes datos de esta forma:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "operationType": 0,\n    "path": "string",\n    "op": "string",\n    "from": "string",\n    "value": "string"\n  }\n]\n\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"operationType (opcional si utiliza la opcion \u201cop\u201d) : Se utiliza para especificar que acci\xf3n se quiere hacer. Recibe como valor el numero que corresponde a un ",(0,l.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.jsonpatch.operations.operationtype?view=aspnetcore-7.0"},"Enum"),"."),(0,l.kt)("li",{parentName:"ul"},"path: Especifica que valor debe ser modificado. La sintaxis es como si fuera la ubicaci\xf3n de un archivo. Ejemplo: Para la propiedad name se usa /name."),(0,l.kt)("li",{parentName:"ul"},"Op (opcional si utiliza la opcion \u201coperationType\u201d): Se utiliza para especificar que acci\xf3n se quiere hacer."),(0,l.kt)("li",{parentName:"ul"},"from: Se utiliza para copiar/mover un archivo. Especifica \u201cdonde\u201d se va a copiar/mover el elemento."),(0,l.kt)("li",{parentName:"ul"},"Value: Se utiliza para remplazar un elemento o comprobar si existe. Especifica el \u201celemento nuevo\u201d o el \u201celemento\u201d que queremos saber si existe.")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Entonces una petici\xf3n de prueba para remplazar el valor de la propiedad Nombre:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "path": "/nombre",\n    "op": "replace",\n    "value": "Nueva villa"\n  }\n]\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El path no es sensible a may\xfascula/min\xfascula.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Podemos hacer lo mismo con este body(contenido) tambi\xe9n:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'\n[\n  {\n    "operationType": 2,\n    "path": "/nombre",\n    "value": "Nueva villa"\n  }\n]\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El numero 2 corresponde a la operaci\xf3n Replace (",(0,l.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.jsonpatch.operations.operationtype?view=aspnetcore-7.0"},"consultar documentaci\xf3n del Enum"),").")))),(0,l.kt)("h2",{id:"logger---inyecci\xf3n-de-dependencia"},"Logger - inyecci\xf3n de dependencia"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Logger sirve para mostrar mensajes en la consola."),(0,l.kt)("li",{parentName:"ul"},"En .Net Core, logger est\xe1 incluido por defecto en la consola de windows."),(0,l.kt)("li",{parentName:"ul"},"Logger est\xe1 registrado(instalado) dentro del \u201cbuilder\u201d (Lo que se genera al compilar la aplicaci\xf3n) cuando la aplicaci\xf3n se construye (compila), por lo cual se puede utilizar en la aplicaci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"En el archivo appsetting.json:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'{\n  "Logging": {\n    "LogLevel": {\n      "Default": "Information",\n      "Microsoft.AspNetCore": "Warning"\n    }\n  },\n  "AllowedHosts": "*"\n}\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Logger est\xe1 registrado en \u201cLogging\u201d."),(0,l.kt)("li",{parentName:"ul"},"Para poder utilizarlo, tenemos que inyectarlo en nuestra aplicaci\xf3n por medio de la inyecci\xf3n de dependencia.")))),(0,l.kt)("h4",{id:"inyecci\xf3n-de-dependencia"},"Inyecci\xf3n de dependencia"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el controlador, creamos un campo(variable) privado de solo lectura de tipo ILogger  , el cual su par\xe1metro de tipo gen\xe9rico es el nombre de la clase del controlador:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"   private readonly ILogger<VillaController> _logger;\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Las variables privadas, suelen tener un guion bajo (\u201c_\u201d) al comienzo del nombre."),(0,l.kt)("li",{parentName:"ul"},"Este campo contendr\xe1 el ILogger, el cual se le asignar\xe1 en el constructor.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el controlador, creamos un constructor:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"  public VillaController(ILogger<VillaController> logger)\n        {\n            _logger = logger;\n        }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Le asignamos el ILogger (que como dijimos antes, ya est\xe1 registrado por defecto) al campo privado."),(0,l.kt)("li",{parentName:"ul"},"Al ejecutarse la aplicaci\xf3n , se ejecuta el constructor  que creamos con los  parametros que especificamos (donde cada argumento es un servicio)."),(0,l.kt)("li",{parentName:"ul"},"Los argumentos de los constructores de los controladores corresponden a los servicios que utiliza nuestra App.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Si escribimos ctor y le damos dos veces a tab, se nos generara el constructor.")))),(0,l.kt)("h4",{id:"ya-lo-podemos-usar"},"Ya lo podemos usar"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ejemplos:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'public ActionResult<IEnumerable<VillaDto>> GetVillas()\n        {\n            _logger.LogInformation("Obtener las Villas");\n            return Ok(VillaStore.villaList); \n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Con LogInformation(\u201cMensaje\u201d) Estamos mostrando informaci\xf3n en la consola.")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'   public ActionResult<VillaDto> GetVilla(int id)\n        {\n            if (id==0)\n            {\n                _logger.LogError("Error al traer Villa con Id " + 0);\n                return BadRequest();\n            }\n\n            var villa = VillaStore.villaList.FirstOrDefault(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n            return Ok(villa);\n           \n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Con LogError(\u201cMensaje\u201d) estamos mostrando un mensaje de error en la consola.")))),(0,l.kt)("h2",{id:"modelos-y-base-de-datos"},"Modelos y Base de datos"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ahora remplazaremos el store con una base de datos para que los datos sean persistentes."),(0,l.kt)("li",{parentName:"ul"},"Para trabajar con BD es necesario utilizar Entity framework core , que es un ORM  (Object Relational Mapping) que maneja las operaciones de la BD de una manera sencilla.")),(0,l.kt)("h4",{id:"modelos"},"Modelos"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Un modelo es una clase que representa una tabla en la BD."),(0,l.kt)("li",{parentName:"ul"},"Cada propiedad es un \u201catributo/columna/propiedad\u201d de la tabla.")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ejemplo Villa.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.ComponentModel.DataAnnotations;\nusing System.ComponentModel.DataAnnotations.Schema;\n\nnamespace MiApp_API.Modelos\n{\n    public class Villa\n    {\n        [Key]\n        public int Id { get; set; }\n        public string Nombre { get; set; }\n        public string Detalles { get; set; }\n        [Required]\n        public double Tarifa { get; set; }\n        public int Ocupantes { get; set; }\n        public int MetrosCuadrados { get; set; }\n        public string ImagenUrl { get; set; }\n        public string Amenidad { get; set; }\n        public DateTime FechaCreacion { get; set; }\n        public DateTime FechaActualizacion { get; set; }\n\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Con el atributo ","[Key]"," especificamos que esa propiedad es una primary key.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Modificamos el modelo \u201cDTO\u201d:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.ComponentModel.DataAnnotations;\n\nnamespace MiApp_API.Modelos.Dto\n{\n    public class VillaDto\n    {\n        public int Id { get; set; }\n\n        [Required]\n        [MaxLength(30)]\n        public String Nombre { get; set; }\n        public int Ocupantes { get; set; }\n        public int MetrosCuadrados { get; set; }\n        public string Detalles { get; set; }\n        [Required]\n        public double Tarifa { get; set; }\n        public string ImagenUrl { get; set; }\n        public string Amenidad { get; set; }\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El DTO no representa una tabla en la base de datos, solo contendr\xe1 la informaci\xf3n que manejar\xe1 el usuario de la aplicaci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"Contendr\xe1 los datos que podr\xe1 ver el usuario.")))),(0,l.kt)("h4",{id:"instalaci\xf3n-de-entity-framework-core"},"Instalaci\xf3n de Entity Framework Core"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Nos vamos al administrador de paquetes Nuget.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Los paquetes  Nuget que necesitamos son:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Microsoft.EntityFrameworkCore.SqlServer."),(0,l.kt)("li",{parentName:"ul"},"Microsoft.EntityFrameworkCore (Este hace referencia al motor de base de datos que estamos utilizando, en este caso SQL )."),(0,l.kt)("li",{parentName:"ul"},"Microsoft.EntityFrameworkCore.Relational."))))),(0,l.kt)("li",{parentName:"ol"},"Instalamos los siguientes paquetes:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Microsoft.EntityFrameworkCore.SqlServer\u201d (este viene con los otros dos incluido (f\xedjate en las dependencias))."),(0,l.kt)("li",{parentName:"ul"},"Microsoft.EntityFrameWorkCore.Tools (Nos ayuda a crear las tablas de la BD).")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Recordatorio")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Inst\xe1lalo con la versi\xf3n del proyecto (7.0.0) en el proyecto.")))),(0,l.kt)("h4",{id:"nombre-del-servidor--sqlserver"},"Nombre del servidor  SQLServer"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Para conectarnos a la base de datos necesitamos conocer el nombre del servidor de Microsoft SQL Server (el que instalamos) , para eso:",(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"Abrimos SQL Server Management Studio"),(0,l.kt)("li",{parentName:"ol"},"Al abrirlo nos va a aparecer el nombre del servidor (Server name)")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Con este nombre, vamos a crear una URL/cadena de conexi\xf3n que nos va a permitir conectarnos a la BD y realizar operaciones.")))),(0,l.kt)("h3",{id:"atributo-databasegenerated"},"Atributo DatabaseGenerated"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el modelo Villa:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public class Villa\n    {\n        [Key]\n        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n        public int Id { get; set; }\n        public string Nombre { get; set; }\n        public string Detalles { get; set; }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Con el atributo ","[Key]"," el atributo es auto incremental (el valor se asigna solo, en la primera fila su valor ser\xe1 1, en la segunda fila su valor ser\xe1 2 y se ir\xe1 incrementando de esta forma)."),(0,l.kt)("li",{parentName:"ul"},"Tambi\xe9n con el par\xe1metro posicional del atributo ","[DatabaseGenerated]"," podemos especificar como se va a asignar el valor de la propiedad, en este caso lo dejamos como si fuera auto incremental (DatabaseGeneratedOption.Identity)."),(0,l.kt)("li",{parentName:"ul"},"DatabaseGeneratedOption Es un enum donde cada valor especifica como se va a asignar el valor de la primary key.")))),(0,l.kt)("h3",{id:"dbcontext"},"DbContext"),(0,l.kt)("h4",{id:"code-first"},"Code First"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Code First permite que Entity Framework cree las tablas en base a los modelos que creamos."),(0,l.kt)("li",{parentName:"ul"},"En la carpeta datos, creamos la clase ApplicationDbContext:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using MiApp_API.Modelos;\nusing Microsoft.EntityFrameworkCore;\n\nnamespace MiApp_API.Datos\n{\n    public class ApplicationDbContext : DbContext\n    {\n        public DbSet<Villa> Villas {get;set;}\n\n\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"La clase hereda de DbContext que viene de EntityFrameworkCore"),(0,l.kt)("li",{parentName:"ul"},"Todas las propiedades de tipo DbSet  son \u201ctablas\u201d de la base de datos. De hecho, el nombre de la propiedad es el nombre de la tabla."),(0,l.kt)("li",{parentName:"ul"},"El par\xe1metro de tipo generico de DbSet es la clase que es modelo."),(0,l.kt)("li",{parentName:"ul"},"Normalmente los nombres de las tablas se escriben en plural.")))),(0,l.kt)("h4",{id:"crear-url-de-conexi\xf3n"},"Crear URL de conexi\xf3n"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Appsetings.json : Es para producci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"Appsettings.Development.json : Es para desarrollo.")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En Appsetings.json:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Logging": {\n    "LogLevel": {\n      "Default": "Information",\n      "Microsoft.AspNetCore": "Warning"\n    }\n  },\n  "AllowedHosts": "*",\n  "ConnectionStrings": {\n    "DefaultConnection": "Server=localhost;Database=Villa;Trusted_Connection=true;MultipleActiveResultSets=true"\n  }\n}\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Adentro de ConnectionStrings configuramos la url de conexi\xf3n."),(0,l.kt)("li",{parentName:"ul"},"\u201cDefaultConnection\u201d puede ser cualquier String y su valor es la cadena(url) de conexi\xf3n:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Server: Nombre del servidor."),(0,l.kt)("li",{parentName:"ul"},"Database: Nombre de la base de datos."),(0,l.kt)("li",{parentName:"ul"},"Trusted_Connection: Para que sea una conexi\xf3n segura debe ser true."),(0,l.kt)("li",{parentName:"ul"},"MultipleActiveResultSets : Permite hacer multiples consultas al mismo  tiempo.")))))),(0,l.kt)("h4",{id:"agregar-servicio"},"Agregar servicio"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Tenemos que agregar un servicio en el Progam.cs , para especificar cual va a ser la clase  de dbContext y que estar\xe1 vinculada con la cadena de conexi\xf3n junto con el motor de base dato. Al final mediante inyecciones de dependencias dejamos detallada esta configuraci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"Progam.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using MiApp_API.Datos;\nusing Microsoft.EntityFrameworkCore;\n\nvar builder = WebApplication.CreateBuilder(args);\n\n// Add services to the container.\n\nbuilder.Services.AddControllers().AddNewtonsoftJson();\n// Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle\nbuilder.Services.AddEndpointsApiExplorer();\nbuilder.Services.AddSwaggerGen();\nbuilder.Services.AddDbContext<ApplicationDbContext>( option =>\n{\n    option.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection"));\n});\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"AddDbContext tiene un par\xe1metro de tipo gen\xe9rico, con el cual especificamos la clase dbContext."),(0,l.kt)("li",{parentName:"ul"},"Con el metodo UseSqlServer() Especificamos que usamos un motor sql"),(0,l.kt)("li",{parentName:"ul"},"Con builder.Configuration accedemos al archivo appsetting.json."),(0,l.kt)("li",{parentName:"ul"},"Con GetConnectionString(X) accedemos a \u201cConnectionStrings\u201d . X es la \u201cclave\u201d del json cuyo valor es la cadena de conexi\xf3n"),(0,l.kt)("li",{parentName:"ul"},"Entonces el m\xe9todo UseSqlServer() recibe como par\xe1metro la cadena de conexi\xf3n.")))),(0,l.kt)("h4",{id:"aplicar-inyecci\xf3n-de-dependencia"},"Aplicar inyecci\xf3n de dependencia"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En ApplicationDbContext.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using MiApp_API.Modelos;\nusing Microsoft.EntityFrameworkCore;\n\nnamespace MiApp_API.Datos\n{\n    public class ApplicationDbContext : DbContext\n    {\n\n        public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options ) : base(options)\n        {\n            \n        }\n        public DbSet<Villa> Villas {get;set;}\n\n\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El par\xe1metro de tipo gen\xe9rico de DbContextOptions es la clase que representa el dbcontext."),(0,l.kt)("li",{parentName:"ul"},"Le pasamos toda la configuraci\xf3n del servicio que agregamos al constructor de la clase DbContext")))),(0,l.kt)("h4",{id:"crear-base-de-datos-y-tabla-villa"},"Crear Base de datos y Tabla Villa"),(0,l.kt)("h4",{id:"emigraci\xf3n"},"Emigraci\xf3n"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Una emigraci\xf3n nos permite crear nuestra base de datos cuando se ejecute Add-migration y Update-database"),(0,l.kt)("li",{parentName:"ul"},"Al ejecutar los comandos , puede pasar lo siguiente:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Si la BD ya existe, no la vuelve a crear."),(0,l.kt)("li",{parentName:"ul"},"Si existen nuevos modelos en el dbContext, los crea como tabla en la BD. Si hay diferencias entre las propiedades, se modifican las tablas para que coincidan con el modelo.")))),(0,l.kt)("h4",{id:"como-ejecutar-una-emigraci\xf3n"},"Como ejecutar una emigraci\xf3n"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Abrimos la consola, donde vamos a ejecutar los comandos: Herramientas -- Administrador de paquetes Nuget \u2013 Consola del Administrador de paquetes.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Primero tenemos que  ejecutar el comando add-migration con la siguiente sintaxis para poder generar un script:")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-powershell"},"add-migration    nombre\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"nombre es un texto que detalla que vamos a hacer con la migraci\xf3n, crear una base de dato? Modificar una tabla? Crear una tabla?")))),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Ejecutamos el siguiente comando:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"add-migration AgregarBaseDatos\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Si lo hiciste bien, se te debi\xf3 generar la carpeta Migrations con los archivos correspondiente."),(0,l.kt)("li",{parentName:"ul"},"En este caso se te debi\xf3 generar dos archivos:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Un Snapshot : Que contiene un resumen de todas las migraciones."),(0,l.kt)("li",{parentName:"ul"},"X_AgregarBaseDatos.cs : Es una clase con el nombre que le dimos, Este archivo contiene el c\xf3digo(script) que crea(o no) y manipula la base de datos (modifica/elimina/inserta columnas  de las tablas, etc).")))))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ahora tenemos que ejecutar el comando Update-database para que se ejecute el script que generamos.")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"Ejecutamos lo siguiente en la consola:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-powershell"},"update-database\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Si existe algo mal configurado, al ejecutar este comando van a aparecer los errores.")))),(0,l.kt)("h4",{id:"nos-va-a-tirar-un-error-porque-no-especificamos-una-certificaci\xf3n-que-diga-que-es-seguro"},"Nos va a tirar un error porque no especificamos una certificaci\xf3n que diga que es seguro"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Vamos a corregirlo en appsettings.json:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Logging": {\n    "LogLevel": {\n      "Default": "Information",\n      "Microsoft.AspNetCore": "Warning"\n    }\n  },\n  "AllowedHosts": "*",\n  "ConnectionStrings": {\n    "DefaultConnection": "Server=localhost;Database=Villa;TrustServerCertificate=true;Trusted_Connection=true;MultipleActiveResultSets=true"\n  }\n}\n\n')),(0,l.kt)("h4",{id:"lo-ejecutamos-de-nuevo-y-ahora-deber\xeda-andar"},"Lo ejecutamos de nuevo y ahora deber\xeda andar"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Abrimos SQL Server Management Studio, nos conectamos y en la carpeta Databases debe estar la que creamos."),(0,l.kt)("li",{parentName:"ol"},"En nuestro caso deben haberse creado dos tablas (que est\xe1n en la carpeta Tables):",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Villas."),(0,l.kt)("li",{parentName:"ul"},"EFMigrationsHistory : Contiene un resumen de todas las migraciones que se hicieron.")))),(0,l.kt)("h2",{id:"alimentar-tabla-villa"},"Alimentar tabla Villa"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Vamos a crear un \u201calimentador\u201d que cree filas en la tabla al ejecutarse la app."),(0,l.kt)("li",{parentName:"ul"},"En ApplicationDbContext:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'protected override void OnModelCreating(ModelBuilder modelBuilder)\n        {\n            modelBuilder.Entity<Villa>().HasData(\n                 new Villa()\n                 {\n                     Id = 1,\n                     Nombre = "Villa real",\n                     Detalles = "Detalla de la Villa...",\n                     ImagenUrl = "",\n                     Ocupantes = 5,\n                     MetrosCuadrados = 50 ,\n                     Tarifa = 200 ,\n                     Amenidad = "",\n                     FechaCreacion = DateTime.Now,\n                     FechaActualizacion = DateTime.Now\n                 }, new Villa()\n                 {\n                     Id = 1,\n                     Nombre = "Premium Vista a la Piscina",\n                     Detalles = "Detalla de la Villa...",\n                     ImagenUrl = "",\n                     Ocupantes = 4,\n                     MetrosCuadrados = 40,\n                     Tarifa = 150,\n                     Amenidad = "",\n                     FechaCreacion = DateTime.Now,\n                     FechaActualizacion = DateTime.Now\n                 }\n                ) ;\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Entity recibe como par\xe1metro de tipo gen\xe9rico, un modelo."),(0,l.kt)("li",{parentName:"ul"},"El m\xe9todo HasData() inserta datos  en el modelo(tabla) que especificamos en el Entity. Entonces cada par\xe1metro del m\xe9todo es una instancia del modelo que se desean agregar a la tabla, donde cada instancia es una fila."),(0,l.kt)("li",{parentName:"ul"},"Estamos sobrescribiendo un m\xe9todo que se ejecuta cuando se crean los modelos.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"La mayor\xeda de las operaciones en una base de datos, se hace con una instancia de ModelBuilder.")))),(0,l.kt)("h4",{id:"ejecutamos-los-dos-comandos-de-nuevo"},"Ejecutamos los dos comandos de nuevo"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-powershell"},"add-migration AlimentarTablaVilla\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"En este comando, se ejecutar\xeda el m\xe9todo que sobrescribimos ya que se crean los modelos."),(0,l.kt)("li",{parentName:"ul"},"Proba modificando el m\xe9todo anterior para ingresar dos instancias con la misma id, y f\xedjate que pasa al ejecutar este comando.")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-powershell"},"update-database\n")),(0,l.kt)("h4",{id:"en-sql-server-management-studio-1"},"En SQL Server Management Studio"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En la tabla Villas, haces click derecho y luego le das a \u201cSelect Top \u2026  rows\u201d para poder ver los registros que creamos.")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Tambien podes hacer click en la base de dato que creamos y luego le das a \u201cNew query\u201d. Ac\xe1 pod\xe9s escribir SQL y luego ejecutarlo (con la opcion Execute).")))),(0,l.kt)("h2",{id:"usar-applicationdbcontext-en-api-controller"},"Usar ApplicationDbContext en API Controller"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Con el DbContext generalmente hacemos las operaciones de la BD, por lo tanto, debemos tener acceso a esta clase en el Controller."),(0,l.kt)("li",{parentName:"ul"},"En VillaController.cs , la inyectamos como dependencia:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'    [Route("api/[controller]")]\n    [ApiController]\n    public class VillaController : ControllerBase\n    {\n\n        private readonly ILogger<VillaController> _logger;\n        private readonly ApplicationDbContext _db;\n        public VillaController(ILogger<VillaController> logger, ApplicationDbContext db)\n        {\n            _logger = logger;\n            _db = db;\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Esto se puede realizar porque a\xf1adimos el dbContext como servicio (con el metodo AddDbContext() en Progam.cs)."),(0,l.kt)("li",{parentName:"ul"},"Cada argumento del constructor es un servicio.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Entonces, en el m\xe9todo para obtener las villas:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'     [HttpGet]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        public ActionResult<IEnumerable<VillaDto>> GetVillas()\n        {\n            _logger.LogInformation("Obtener las Villas");\n            return Ok(_db.Villas.ToList());\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Cada propiedad es una tabla de la BD. Por lo tanto, usar una propiedad es como hacer la consulta \u201cselect * from propiedad\u201d."),(0,l.kt)("li",{parentName:"ul"},"El Metodo ToList() Lo convierte en un List","<","T>.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el m\xe9todo para obtener una Villa:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'[HttpGet("id:int" , Name ="GetVilla")]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        public ActionResult<VillaDto> GetVilla(int id)\n        {\n            if (id==0)\n            {\n                _logger.LogError("Error al traer Villa con Id  " + 0);\n                return BadRequest();\n            }\n\n            var villa = _db.Villas.FirstOrDefault(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n            return Ok(villa);\n           \n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Es casi lo mismo, nom\xe1s que invocamos el m\xe9todo FirstOrDefault() utilizando la propiedad Villas.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el m\xe9todo para crear una villa:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'      public ActionResult<VillaDto> crearVilla([FromBody] VillaDto villaDto) { \n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n\n            if (_db.Villas.FirstOrDefault(v => v.Nombre.ToLower() == villaDto.Nombre.ToLower()) != null)\n            {\n                ModelState.AddModelError("NombreExiste", "La villa con ese nombre ya existe");\n                 return BadRequest(ModelState);\n            }\n\n            if (villaDto == null)\n            {\n                return BadRequest(villaDto);\n            }\n            if(villaDto.Id < 0) {\n                return StatusCode(StatusCodes.Status500InternalServerError);\n            }\n\n            Villa modelo = new()\n            {\n         \n                Nombre = villaDto.Nombre,\n                Detalles = villaDto.Detalles,\n                ImagenUrl = villaDto.ImagenUrl,\n                Ocupantes = villaDto.Ocupantes,\n                Tarifa = villaDto.Tarifa,\n                MetrosCuadrados = villaDto.MetrosCuadrados,\n                Amenidad = villaDto.Amenidad\n            };\n            _db.Villas.Add(modelo);\n            _db.SaveChanges();\n           return CreatedAtRoute("GetVilla" , new {id= villaDto.Id } , villaDto);\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El m\xe9todo Add(modelo) agrega el modelo (representa una fila) a la entidad (representa una tabla, como dijimos antes el nombre de la propiedad es la tabla). En resumen, agrega una fila a una tabla."),(0,l.kt)("li",{parentName:"ul"},"En el modelo no tienes que especificar el id porque se genera solo (como lo definimos)."),(0,l.kt)("li",{parentName:"ul"},"Con el m\xe9todo SaveChanges() guardamos todos los cambios que hicimos a trav\xe9s de la clase DbContext en la base de datos.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Recordatorio")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Cuando lo pruebes, no tienes que enviar el id porque se genera solo (como lo definimos)."),(0,l.kt)("li",{parentName:"ul"},"Si al probarlo enviamos un id, se generar\xe1 un error porque la aplicaci\xf3n no sabr\xe1 cual valor asignarle (el que se crea solo o el que definimos).")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el m\xe9todo para eliminar:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public IActionResult DeleteVilla(int id)\n        {\n            if (id == 0)\n            {\n                return BadRequest();\n            }\n\n            var villa = _db.Villas.FirstOrDefault(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n            _db.Villas.Remove(villa);\n            _db.SaveChanges();\n            return NoContent();\n        }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El m\xe9todo Remove(modelo) elimina el modelo (representa una fila) de la entidad (representa una tabla, como dijimos antes el nombre de la propiedad es la tabla). En resumen, elimina una fila de la tabla."),(0,l.kt)("li",{parentName:"ul"},"Con el m\xe9todo SaveChanges() guardamos todos los cambios que hicimos a trav\xe9s de la clase DbContext en la base de datos.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el m\xe9todo que hace update con Put:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public IActionResult UpdateVilla(int id , [FromBody] VillaDto villaDto)\n        {\n            if (villaDto == null || id!= villaDto.Id)\n            {\n                return BadRequest();\n            }\n            Villa modelo = new()\n            {\n                Id = villaDto.Id,\n                Nombre = villaDto.Nombre,\n                Detalles = villaDto.Detalles,\n                ImagenUrl = villaDto.ImagenUrl,\n                Ocupantes = villaDto.Ocupantes,\n                Tarifa = villaDto.Tarifa,\n                MetrosCuadrados = villaDto.MetrosCuadrados,\n                Amenidad = villaDto.Amenidad\n            };\n            _db.Villas.Update(modelo);\n            _db.SaveChanges();\n            return NoContent();\n        }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El m\xe9todo Update(modelo) actualiza un modelo (representa una fila) que contiene la entidad (representa una tabla, como dijimos antes el nombre de la propiedad es la tabla). En resumen, modifica una fila de la tabla."),(0,l.kt)("li",{parentName:"ul"},"Con el m\xe9todo SaveChanges() guardamos todos los cambios que hicimos a trav\xe9s de la clase DbContext en la base de datos.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el m\xe9todo que hace update con Patch:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public IActionResult UpdatePartialVilla(int id, JsonPatchDocument<VillaDto> patchDto)\n        {\n            if (patchDto == null || id == 0)\n            {\n                return BadRequest();\n            }\n            var villa = _db.Villas.FirstOrDefault(v => v.Id == id);\n            VillaDto villaDto = new()\n            {\n                Id = villa.Id,\n                Nombre = villa.Nombre,\n                Detalles = villa.Detalles,\n                ImagenUrl = villa.ImagenUrl,\n                Ocupantes = villa.Ocupantes,\n                Tarifa = villa.Tarifa,\n                MetrosCuadrados = villa.MetrosCuadrados,\n                Amenidad = villa.Amenidad\n            };\n\n            if (villa == null) return BadRequest();\n\n            patchDto.ApplyTo(villaDto , ModelState);\n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n\n            Villa modelo = new()\n            {\n                Id = villaDto.Id,\n                Nombre = villaDto.Nombre,\n                Detalles = villaDto.Detalles,\n                ImagenUrl = villaDto.ImagenUrl,\n                Ocupantes = villaDto.Ocupantes,\n                Tarifa = villaDto.Tarifa,\n                MetrosCuadrados = villaDto.MetrosCuadrados,\n                Amenidad = villaDto.Amenidad\n            };\n            _db.Villas.Update(modelo);\n            _db.SaveChanges();\n            return NoContent();\n        }\n\n")),(0,l.kt)("h2",{id:"asnotracking-en-acci\xf3n"},"AsNoTracking en acci\xf3n"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Cuando probamos el Path nos tira un error:  The instance of entity type 'Villa' cannot be tracked because another instance with the same key value for {'Id'} is already being tracked.")),(0,l.kt)("h4",{id:"qu\xe9-provoca-el-error"},"\xbfQu\xe9 provoca el error?"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En la siguiente l\xednea hay un modelo/registro (fila de la tabla) en memoria:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"var villa = _db.Villas.FirstOrDefault(v => v.Id == id);\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En las siguientes l\xedneas hay otro modelo/registro (fila de la tabla) en memoria:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"\n  Villa modelo = new()\n            {\n                Id = villaDto.Id,\n                Nombre = villaDto.Nombre,\n                Detalles = villaDto.Detalles,\n                ImagenUrl = villaDto.ImagenUrl,\n                Ocupantes = villaDto.Ocupantes,\n                Tarifa = villaDto.Tarifa,\n                MetrosCuadrados = villaDto.MetrosCuadrados,\n                Amenidad = villaDto.Amenidad\n            };\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"El error se produce porque los dos modelos/registros que est\xe1n en memoria usan el mismo ID y este debe ser \xfanico.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Para corregir este error:"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using Microsoft.EntityFrameworkCore;\n public IActionResult UpdatePartialVilla(int id, JsonPatchDocument<VillaDto> patchDto)\n        {\n            if (patchDto == null || id == 0)\n            {\n                return BadRequest();\n            }\n            var villa = _db.Villas.AsNoTracking().FirstOrDefault(v => v.Id == id);\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Con AsNoTracking() estamos haciendo que la entidad(tabla) Villas  no almacene en memoria el modelo/registro que estamos consiguiendo a trav\xe9s de la entidad(Villas)."),(0,l.kt)("li",{parentName:"ul"},"Ahora este modelo/registro no estar\xe1 en memoria y no genera conflicto con el otro modelo/registro.")))),(0,l.kt)("h2",{id:"subir-cambios-a-github"},"Subir cambios a github"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Abrimos la terminal en Visual studio  y ejecutamos los siguientes comandos:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-powershell"},"git add .\ngit commit -m \u201cDbContext \u2013 Inyeccion de Depedencia\u201d\ngit push -u origin main\n")),(0,l.kt)("h2",{id:"separar-dto"},"Separar DTO"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Generalmente se utilizan diferentes DTO, por ejemplo, una para el apartado de actualizar y otro para crear una villa."),(0,l.kt)("li",{parentName:"ul"},"Entonces, tenemos que crear nuevos DTO:",(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"Hacemos click en VillaDto.cs  - click derecho \u2013 Copiar --  Hacemos click en la carpeta DTO \u2013 click derecho \u2013 pegar (Hacemos esto dos veces)."),(0,l.kt)("li",{parentName:"ol"},"Les cambiamos los nombres a:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"VillaCreateDto"),(0,l.kt)("li",{parentName:"ul"},"VillaUpdateDto")))))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Como cambiar el nombre del archivo")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Hacemos click en la copia \u2013 click derecho \u2013 Cambiar nombre. ")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En VillaCreateDto.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.ComponentModel.DataAnnotations;\n\nnamespace MiApp_API.Modelos.Dto\n{\n    public class VillaCreateDto\n    {\n        \n\n        [Required]\n        [MaxLength(30)]\n        public String Nombre { get; set; }\n        public int Ocupantes { get; set; }\n        public int MetrosCuadrados { get; set; }\n        public string Detalles { get; set; }\n        [Required]\n        public double Tarifa { get; set; }\n        public string ImagenUrl { get; set; }\n        public string Amenidad { get; set; }\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Para crear una villa, no necesitamos el id asique lo sacamos.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"VillaUpdateDto.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.ComponentModel.DataAnnotations;\n\nnamespace MiApp_API.Modelos.Dto\n{\n    public class VillaUpdateDto\n    {\n\n\n        [Required]\n        public int Id { get; set; }\n\n        [Required]\n        [MaxLength(30)]\n        public String Nombre { get; set; }\n        [Required]\n        public int Ocupantes { get; set; }\n\n        [Required]\n        public int MetrosCuadrados { get; set; }\n        [Required]\n        public string Detalles { get; set; }\n        [Required]\n        public double Tarifa { get; set; }\n        [Required]\n        public string ImagenUrl { get; set; }\n        public string Amenidad { get; set; }\n    }\n}\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el controlador:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'public ActionResult<VillaDto> crearVilla([FromBody] VillaCreateDto villaDto) { \n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n\n            if (_db.Villas.FirstOrDefault(v => v.Nombre.ToLower() == villaDto.Nombre.ToLower()) != null)\n            {\n                ModelState.AddModelError("NombreExiste", "La villa con ese nombre ya existe");\n                 return BadRequest(ModelState);\n            }\n\n            if (villaDto == null)\n            {\n                return BadRequest(villaDto);\n            }\n          \n\n            Villa modelo = new()\n            {\n         \n                Nombre = villaDto.Nombre,\n                Detalles = villaDto.Detalles,\n                ImagenUrl = villaDto.ImagenUrl,\n                Ocupantes = villaDto.Ocupantes,\n                Tarifa = villaDto.Tarifa,\n                MetrosCuadrados = villaDto.MetrosCuadrados,\n                Amenidad = villaDto.Amenidad\n            };\n            _db.Villas.Add(modelo);\n            _db.SaveChanges();\n           return CreatedAtRoute("GetVilla" , new {id= modelo.Id } , modelo);\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El Modelo genera un id (como lo definimos) y ese mismo lo usamos en el metodo CreatedAtRoute().")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"      public IActionResult UpdateVilla(int id , [FromBody] VillaUpdateDto villaDto)\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public IActionResult UpdatePartialVilla(int id, JsonPatchDocument<VillaUpdateDto> patchDto)\n        {\n            if (patchDto == null || id == 0)\n            {\n                return BadRequest();\n            }\n            var villa = _db.Villas.AsNoTracking().FirstOrDefault(v => v.Id == id);\n            if (villa == null) return BadRequest();\n            VillaUpdateDto villaDto = new()\n            {\n                Id = villa.Id,\n                Nombre = villa.Nombre,\n                Detalles = villa.Detalles,\n                ImagenUrl = villa.ImagenUrl,\n                Ocupantes = villa.Ocupantes,\n                Tarifa = villa.Tarifa,\n                MetrosCuadrados = villa.MetrosCuadrados,\n                Amenidad = villa.Amenidad\n            };\n\n\n         \n            patchDto.ApplyTo(villaDto , ModelState);\n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n\n            Villa modelo = new()\n            {\n                Id = villaDto.Id,\n                Nombre = villaDto.Nombre,\n                Detalles = villaDto.Detalles,\n                ImagenUrl = villaDto.ImagenUrl,\n                Ocupantes = villaDto.Ocupantes,\n                Tarifa = villaDto.Tarifa,\n                MetrosCuadrados = villaDto.MetrosCuadrados,\n                Amenidad = villaDto.Amenidad\n            };\n            _db.Villas.Update(modelo);\n            _db.SaveChanges();\n            return NoContent();\n        }\n\n")),(0,l.kt)("h2",{id:"m\xe9todos-async"},"M\xe9todos Async"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Microsoft nos recomienda usar m\xe9todos as\xedncronos, para esto nos brinda m\xe9todos para trabajar de esta forma:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'\n  [HttpGet]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        public async Task<ActionResult<IEnumerable<VillaDto>>> GetVillas()\n        {\n            _logger.LogInformation("Obtener las Villas");\n            return Ok(await _db.Villas.ToListAsync());\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Generalmente hay que utilizar el await en un m\xe9todo async para esperarlo.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Hacemos exactamente lo mismo para el resto de m\xe9todos:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'      public async  Task<ActionResult<VillaDto>> GetVilla(int id)\n        {\n            if (id==0)\n            {\n                _logger.LogError("Error al traer Villa con Id  " + 0);\n                return BadRequest();\n            }\n\n            var villa = await _db.Villas.FirstOrDefaultAsync(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n            return Ok( villa);\n           \n        }\n\n\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'public async  Task<ActionResult<VillaDto>> crearVilla([FromBody] VillaCreateDto villaDto) { \n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n\n            if (await _db.Villas.FirstOrDefaultAsync(v => v.Nombre.ToLower() == villaDto.Nombre.ToLower()) != null)\n            {\n                ModelState.AddModelError("NombreExiste", "La villa con ese nombre ya existe");\n                 return BadRequest(ModelState);\n            }\n\n            if (villaDto == null)\n            {\n                return BadRequest(villaDto);\n            }\n          \n\n            Villa modelo = new()\n            {\n         \n                Nombre = villaDto.Nombre,\n                Detalles = villaDto.Detalles,\n                ImagenUrl = villaDto.ImagenUrl,\n                Ocupantes = villaDto.Ocupantes,\n                Tarifa = villaDto.Tarifa,\n                MetrosCuadrados = villaDto.MetrosCuadrados,\n                Amenidad = villaDto.Amenidad\n            };\n            await _db.Villas.AddAsync(modelo);\n            await _db.SaveChangesAsync();\n           return CreatedAtRoute("GetVilla" , new {id= modelo.Id } , modelo);\n        }\n\n\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"\n     public async Task<IActionResult> DeleteVilla(int id)\n        {\n            if (id == 0)\n            {\n                return BadRequest();\n            }\n\n            var villa = await _db.Villas.FirstOrDefaultAsync(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n            _db.Villas.Remove(villa);\n          await  _db.SaveChangesAsync();\n            return NoContent();\n        }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El m\xe9todo Remove() no se puede usar de forma as\xedncrona.")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public async Task<IActionResult> UpdateVilla(int id , [FromBody] VillaUpdateDto villaDto)\n        {\n            if (villaDto == null || id!= villaDto.Id)\n            {\n                return BadRequest();\n            }\n            Villa modelo = new()\n            {\n                Id = villaDto.Id,\n                Nombre = villaDto.Nombre,\n                Detalles = villaDto.Detalles,\n                ImagenUrl = villaDto.ImagenUrl,\n                Ocupantes = villaDto.Ocupantes,\n                Tarifa = villaDto.Tarifa,\n                MetrosCuadrados = villaDto.MetrosCuadrados,\n                Amenidad = villaDto.Amenidad\n            };\n            _db.Villas.Update(modelo);\n            await _db.SaveChangesAsync();\n            return NoContent();\n        }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El m\xe9todo Update() no se puede usar de forma as\xedncrona.")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public async Task<IActionResult> UpdatePartialVilla(int id, JsonPatchDocument<VillaUpdateDto> patchDto)\n        {\n            if (patchDto == null || id == 0)\n            {\n                return BadRequest();\n            }\n            var villa = await  _db.Villas.AsNoTracking().FirstOrDefaultAsync(v => v.Id == id);\n            if (villa == null) return BadRequest();\n            VillaUpdateDto villaDto = new()\n            {\n                Id = villa.Id,\n                Nombre = villa.Nombre,\n                Detalles = villa.Detalles,\n                ImagenUrl = villa.ImagenUrl,\n                Ocupantes = villa.Ocupantes,\n                Tarifa = villa.Tarifa,\n                MetrosCuadrados = villa.MetrosCuadrados,\n                Amenidad = villa.Amenidad\n            };\n\n\n         \n            patchDto.ApplyTo(villaDto , ModelState);\n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n\n            Villa modelo = new()\n            {\n                Id = villaDto.Id,\n                Nombre = villaDto.Nombre,\n                Detalles = villaDto.Detalles,\n                ImagenUrl = villaDto.ImagenUrl,\n                Ocupantes = villaDto.Ocupantes,\n                Tarifa = villaDto.Tarifa,\n                MetrosCuadrados = villaDto.MetrosCuadrados,\n                Amenidad = villaDto.Amenidad\n            };\n            _db.Villas.Update(modelo);\n            await _db.SaveChangesAsync();\n            return NoContent();\n        }\n\n\n")),(0,l.kt)("h2",{id:"configurar-automapper-y-mapping-config"},"Configurar AutoMapper y Mapping Config"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Si vemos nuestros m\xe9todos POST y PUT, podemos notar que convertimos un objeto en otro. B\xe1sicamente de VillaDto (o alguna clase DTO) a Villa (modelo) y viceversa."),(0,l.kt)("li",{parentName:"ul"},"Un ejemplo de la conversi\xf3n sacado del m\xe9todo POST:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"     Villa modelo = new()\n            {\n         \n                Nombre = villaDto.Nombre,\n                Detalles = villaDto.Detalles,\n                ImagenUrl = villaDto.ImagenUrl,\n                Ocupantes = villaDto.Ocupantes,\n                Tarifa = villaDto.Tarifa,\n                MetrosCuadrados = villaDto.MetrosCuadrados,\n                Amenidad = villaDto.Amenidad\n            };\n\n")),(0,l.kt)("h4",{id:"qu\xe9-pasar\xeda-cuando-el-modelo-tenga-miles-de-propiedades"},"\xbfQu\xe9 pasar\xeda cuando el modelo tenga miles de propiedades?"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Pues nos va a tocar escribir mucho c\xf3digo en el controlador. Por lo tanto, es mala pr\xe1ctica."),(0,l.kt)("li",{parentName:"ul"},"Para solucionar esto, tenemos un paquete Nuget llamado AutoMapper que se encargara de convertir un objeto a otro.")),(0,l.kt)("h4",{id:"instalaci\xf3n-de-automapper"},"Instalaci\xf3n de AutoMapper"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el administrador de paquetes Nuget , instalamos los siguientes paquetes:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"AutoMapper"),(0,l.kt)("li",{parentName:"ul"},"AutoMapper.Extensions.Microsoft.DependencyInjection")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Como no son paquetes de EntityFramework , aseg\xfarate de instalar la \xfaltima versi\xf3n de los paquetes.")))),(0,l.kt)("h4",{id:"creamos-la-clase-mappingconfig"},"Creamos la clase MappingConfig"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Esta clase, se encargar\xe1 del mapeo de los objetos."),(0,l.kt)("li",{parentName:"ul"},"Creamos una clase en el proyecto (en ninguna carpeta) llamada MappingConfig (Puede ser cualquier nombre).")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"A este punto ya sabr\xe1s que todas las operaciones en Visual Studio se hacen seleccionado y haciendo click derecho.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En  MappingConfig.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using AutoMapper;\nusing MiApp_API.Modelos;\nusing MiApp_API.Modelos.Dto;\n\nnamespace MiApp_API\n{\n    public class MappingConfig : Profile\n    {\n        public MappingConfig()\n        {\n            // 1 Forma\n            CreateMap<Villa, VillaDto>();\n            CreateMap<VillaDto, Villa>();\n\n            // 2 Forma\n            CreateMap<Villa, VillaCreateDto>().ReverseMap();\n            CreateMap<Villa, VillaUpdateDto>().ReverseMap();\n\n        }\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"La clase hereda de Profile que proviene de los paquetes que instalamos."),(0,l.kt)("li",{parentName:"ul"},"Con CreateMap() creamos los mapeos pero este se tiene que ubicar en alg\xfan constructor."),(0,l.kt)("li",{parentName:"ul"},"CreateMap tiene dos par\xe1metros de tipo gen\xe9rico: La fuente y el destino.  Especifica que se puede convertir el \u201ctipo de dato fuente\u201d en \u201ctipo de dato destino\u201d. Se hace una migraci\xf3n de datos de la fuente al destino."),(0,l.kt)("li",{parentName:"ul"},"Con ReverseMap() hacemos dos CreateMap() en uno . Especificamos que se puede hacer una migraci\xf3n de datos de la fuente al destino y viceversa.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Mapeo")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El mapeo de datos permite la migraci\xf3n de datos de un lugar a otro en tiempo real, de manera eficiente y rentable.")))),(0,l.kt)("h4",{id:"agregamos-el-servicio"},"Agregamos el servicio"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Lo agregamos al servicio, para luego por medio de inyecci\xf3n de dependencia poder usarlo."),(0,l.kt)("li",{parentName:"ul"},"En Progam.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using MiApp_API;\nbuilder.Services.AddAutoMapper(typeof(MappingConfig));\nvar app = builder.Build();\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"AddAutoMapper() recibe el nombre de la clase  que se encarga del mapeo (la que creamos anteriormente)."),(0,l.kt)("li",{parentName:"ul"},"Lo que recibe typeof() es la clase que se encarga del mapeo.")))),(0,l.kt)("h4",{id:"inyecci\xf3n-de-dependencia-1"},"Inyecci\xf3n de dependencia"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ahora que ya lo agregamos al servicio, podemos usarlo mediante la inyecci\xf3n de dependencia."),(0,l.kt)("li",{parentName:"ul"},"En el controlador:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using AutoMapper;\nusing MiApp_API.Datos;\nusing MiApp_API.Modelos;\nusing MiApp_API.Modelos.Dto;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.JsonPatch;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.EntityFrameworkCore;\n\nnamespace MiApp_API.Controllers\n{\n    [Route("api/[controller]")]\n    [ApiController]\n    public class VillaController : ControllerBase\n    {\n\n        private readonly ILogger<VillaController> _logger;\n        private readonly ApplicationDbContext _db;\n        private readonly IMapper _mapper;\n        public VillaController(ILogger<VillaController> logger, ApplicationDbContext db , IMapper mapper)\n        {\n            _logger = logger;\n            _db = db;\n            _mapper = mapper;\n        }\n\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ahora que ya lo tenemos inyectada en el controlador, los endpoints pueden usarlas:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'  public async Task<ActionResult<IEnumerable<VillaDto>>> GetVillas()\n        {\n            _logger.LogInformation("Obtener las Villas");\n            IEnumerable<Villa> villaList = await _db.Villas.ToListAsync();\n\n            return Ok(_mapper.Map<IEnumerable<VillaDto>>(villaList));\n\n\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Con Map() hacemos el mapeo (convertimos un objeto a otro):",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Su par\xe1metro de tipo gen\xe9rico especifica que tipo de dato va a devolver. "),(0,l.kt)("li",{parentName:"ul"},"A su vez recibe como par\xe1metro la fuente."),(0,l.kt)("li",{parentName:"ul"},"Entonces hace la migraci\xf3n(mapeo) desde la fuente (par\xe1metro normal) al destino (par\xe1metro de tipo gen\xe9rico)."))),(0,l.kt)("li",{parentName:"ul"},"En este endpoint convierte una colecci\xf3n de Villa a una colecci\xf3n de VillaDto.")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'public async  Task<ActionResult<VillaDto>> GetVilla(int id)\n        {\n            if (id==0)\n            {\n                _logger.LogError("Error al traer Villa con Id  " + 0);\n                return BadRequest();\n            }\n\n            var villa = await _db.Villas.FirstOrDefaultAsync(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n            return Ok(_mapper.Map<VillaDto>(villa));\n           \n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Convertimos un objeto de tipo Villa a VillaDto en el return.")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'  public async  Task<ActionResult<VillaDto>> crearVilla([FromBody] VillaCreateDto createDto) { \n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n\n            if (await _db.Villas.FirstOrDefaultAsync(v => v.Nombre.ToLower() == createDto.Nombre.ToLower()) != null)\n            {\n                ModelState.AddModelError("NombreExiste", "La villa con ese nombre ya existe");\n                 return BadRequest(ModelState);\n            }\n\n            if (createDto == null)\n            {\n                return BadRequest(createDto);\n            }\n            Villa modelo = _mapper.Map<Villa>(createDto);\n            await _db.Villas.AddAsync(modelo);\n            await _db.SaveChangesAsync();\n           return CreatedAtRoute("GetVilla" , new {id= modelo.Id } , modelo);\n        }\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Convertimos un objeto de tipo VillaCreateDto a Villa al crear el modelo.")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"  public async Task<IActionResult> UpdateVilla(int id , [FromBody] VillaUpdateDto updateDto)\n        {\n            if (updateDto == null || id!= updateDto.Id)\n            {\n                return BadRequest();\n            }\n            Villa modelo = _mapper.Map<Villa>(updateDto);\n            _db.Villas.Update(modelo);\n            await _db.SaveChangesAsync();\n            return NoContent();\n        }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Convertimos un objeto de tipo  VillaUpdateDto  a Villa al crear el modelo.")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public async Task<IActionResult> UpdatePartialVilla(int id, JsonPatchDocument<VillaUpdateDto> patchDto)\n        {\n            if (patchDto == null || id == 0)\n            {\n                return BadRequest();\n            }\n            var villa = await  _db.Villas.AsNoTracking().FirstOrDefaultAsync(v => v.Id == id);\n            if (villa == null) return BadRequest();\n            VillaUpdateDto villaDto = _mapper.Map<VillaUpdateDto>(villa);\n            patchDto.ApplyTo(villaDto , ModelState);\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n            Villa modelo = _mapper.Map<Villa>(villaDto);\n            _db.Villas.Update(modelo);\n            await _db.SaveChangesAsync();\n            return NoContent();\n        }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"\xbfHicimos dos conversiones, d\xf3nde est\xe1n?")))),(0,l.kt)("h2",{id:"subir-cambios-a-github-1"},"Subir cambios a github"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Abrimos la terminal en Visual studio  y ejecutamos los siguientes comandos:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-powershell"},"git add .\ngit commit -m \u201cDto y AutoMapper\u201d\ngit push -u origin main\n\n")),(0,l.kt)("h2",{id:"agregar-interfaz-villa---patr\xf3n-repositorio"},"Agregar Interfaz Villa - Patr\xf3n Repositorio"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En un proyecto real, no se acostumbra a trabajar directamente con la BD. Es decir, tener todo el dbContext en el controlador."),(0,l.kt)("li",{parentName:"ul"},"La forma correcta de trabajar es aplicando patrones de dise\xf1os."),(0,l.kt)("li",{parentName:"ul"},"Nosotros vamos a usar el Patr\xf3n repositorio, donde se crea un repositorio que se encargara de todo relacionado a los datos."),(0,l.kt)("li",{parentName:"ul"},"En este patr\xf3n se trabaja con interfaces y con implementaciones de estas.")),(0,l.kt)("h4",{id:"interfaces"},"Interfaces"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Entonces, creamos la carpeta Repositorio en el proyecto:\nAdentro de esta, creamos la carpeta IRepositorio (ac\xe1 van las interfaces)."),(0,l.kt)("li",{parentName:"ol"},"Agregamos una nueva interfaz llamada IRepositorio.")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"En la opcion \u201cnuevos elementos\u201d en \u201cagregar\u201d, est\xe1n todas las plantillas que puede seleccionar, entre estas se encuentra la interfaz.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Entonces en IRepositorio.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.Linq.Expressions;\n\nnamespace MiApp_API.Repositorio.IRepositorio\n{\n    public interface IRepositorio<T> where T : class\n    {\n\n        Task Crear(T entidad);\n        Task<List<T>> ObtenerTodos(Expression<Func<T, bool>>? filtro = null);\n\n        Task<T> Obtener(Expression<Func<T, bool>>? filtro = null , bool tracked = true);\n\n        Task Remover(T entidad);\n\n        Task Grabar();\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Es gen\xe9rico as\xed cualquier modelo lo puede utilizar.")))),(0,l.kt)("h4",{id:"implementamos-la-interfaz"},"Implementamos la interfaz"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En la carpeta Repositorio, creamos una clase llamada Repositorio"),(0,l.kt)("li",{parentName:"ul"},"Esta clase implementara la interfaz."),(0,l.kt)("li",{parentName:"ul"},"Primero creamos el constructor:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using MiApp_API.Datos;\nusing MiApp_API.Repositorio.IRepositorio;\nusing Microsoft.EntityFrameworkCore;\nusing System.Linq.Expressions;\n\nnamespace MiApp_API.Repositorio\n{\n    public class Repositorio<T> : IRepositorio<T> where T : class\n    {\n\n        private readonly ApplicationDbContext _db;\n        internal DbSet<T> dbSet;\n\n\n        public Repositorio(ApplicationDbContext db)\n        {\n            _db = db;\n            this.dbSet = _db.Set<T>();\n        }\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Con _db.Set","<","T>() obtenemos la propiedad de tipo DbSet","<","T> del DbContext."),(0,l.kt)("li",{parentName:"ul"},"T representa el modelo(tabla) que queremos manipular."),(0,l.kt)("li",{parentName:"ul"},"Ejemplo:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"T es el modelo Villa."),(0,l.kt)("li",{parentName:"ul"},"Usamos la linea \u201c_db.Set","<","Villa>()\u201d para obtener la propiedad  \u201cpublic DbSet","<","Villa> Villas {get;set;}\u201d.")))))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Implementamos los m\xe9todos de la interfaz:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using MiApp_API.Datos;\nusing MiApp_API.Repositorio.IRepositorio;\nusing Microsoft.EntityFrameworkCore;\nusing System.Diagnostics;\nusing System.Linq.Expressions;\n\nnamespace MiApp_API.Repositorio\n{\n    public class Repositorio<T> : IRepositorio<T> where T : class\n    {\n\n        private readonly ApplicationDbContext _db;\n        internal DbSet<T> dbSet;\n\n\n        public Repositorio(ApplicationDbContext db)\n        {\n            _db = db;\n            this.dbSet = _db.Set<T>();\n        }\n\n        public async Task Crear(T entidad)\n        {\n            await dbSet.AddAsync(entidad);\n            await Grabar();\n        }\n\n        public async Task Grabar()\n        {\n            await _db.SaveChangesAsync();\n        }\n\n        public async Task<T> Obtener(Expression<Func<T, bool>>? filtro = null, bool tracked = true)\n        {\n            IQueryable<T> query = dbSet;\n            if (!tracked)\n            {\n                query = query.AsNoTracking();\n            } \n\n            if (filtro != null)\n            {\n                query = query.Where(filtro);\n            }\n\n            return await query.FirstOrDefaultAsync();\n        }\n\n        public async Task<List<T>> ObtenerTodos(Expression<Func<T, bool>>? filtro = null)\n        {\n            IQueryable<T> query = dbSet;\n           \n\n            if (filtro != null)\n            {\n                query = query.Where(filtro);\n            }\n\n            return await query.ToListAsync();\n        }\n\n        public async Task Remover(T entidad)\n        {\n            dbSet.Remove(entidad);\n            await Grabar();\n        }\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El apartado de modificar no lo incluimos porque en cada modelo se va a modificar diferentes datos(propiedades). Por lo tanto, lo mejor ser\xeda que cada modelo defina como se va a actualizar/modificar.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"A un modelo (Tabla) se le suele decir entidad.")))),(0,l.kt)("h4",{id:"interfaz-para-la-entidad-villa"},"Interfaz para la entidad Villa"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Creamos la interfaz IVillaRepositorio en la carpeta IRepositorio.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"En esta interfaz definiremos el m\xe9todo para actualizar el modelo Villa."))),(0,l.kt)("li",{parentName:"ol"},"En IVillaRepositorio.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using MiApp_API.Modelos;\n\nnamespace MiApp_API.Repositorio.IRepositorio\n{\n    public interface IVillaRepositorio : IRepositorio<Villa>\n    {\n        Task<Villa> Actualizar(Villa entidad);\n    }\n}\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"Ahora creamos una nueva clase llamada VillaRepositorio en la carpeta Repositorio.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Esta ser\xe1 la clase que implementar\xe1 la interfaz."))),(0,l.kt)("li",{parentName:"ol"},"En VillaRepositorio.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using MiApp_API.Datos;\nusing MiApp_API.Modelos;\nusing MiApp_API.Repositorio.IRepositorio;\nusing Microsoft.EntityFrameworkCore;\n\nnamespace MiApp_API.Repositorio\n{\n    public class VillaRepositorio : Repositorio<Villa>, IVillaRepositorio\n    {\n        private readonly ApplicationDbContext _db;\n\n\n        public VillaRepositorio(ApplicationDbContext db) : base(db)\n        {\n            _db = db;\n        }\n\n        public async Task<Villa> Actualizar(Villa entidad)\n        {\n            entidad.FechaActualizacion = DateTime.Now;\n            _db.Villas.Update(entidad);\n            await _db.SaveChangesAsync();\n            return entidad;\n        }\n    }\n}\n\n")),(0,l.kt)("h4",{id:"agregarla-como-servicio"},"Agregarla como servicio"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"A la interfaz que creamos, debemos agregarla como servicio, para luego poder inyectarla en el controlador mediante el constructor (como hicimos con la mayor\xeda de dependencias)."),(0,l.kt)("li",{parentName:"ul"},"En el Progam.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using MiApp_API;\nusing MiApp_API.Datos;\nusing MiApp_API.Repositorio;\nusing MiApp_API.Repositorio.IRepositorio;\nusing Microsoft.EntityFrameworkCore;\n\nbuilder.Services.AddScoped<IVillaRepositorio, VillaRepositorio>();\nvar app = builder.Build();\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"AddScoped() recibe dos par\xe1metros de tipo gen\xe9rico:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"TService : Es el servicio que se debe agregar (Interfaz)."),(0,l.kt)("li",{parentName:"ul"},"TImplementation: La implementaci\xf3n que se va a usar (La clase que implementa la interfaz)."))),(0,l.kt)("li",{parentName:"ul"},"El servicio (con la implementaci\xf3n especificada) se agrega en los constructores de los controladores."),(0,l.kt)("li",{parentName:"ul"},"Cuando la aplicaci\xf3n inicia, se invoca el constructor del controlador, con todos los servicios que agregamos como \u201cpar\xe1metros\u201d del constructor."),(0,l.kt)("li",{parentName:"ul"},"Cada par\xe1metro del constructor es un servicio que agregamos, que luego se lo asignamos a una variable privada para su posterior uso.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"M\xe9todos para agregar un servicio")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Hay varios m\xe9todos para agregar un servicio:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"AddScope: Crea el servicio en la solicitud y luego se destruye."),(0,l.kt)("li",{parentName:"ul"},"AddSingleton: Crea el servicio la primera vez que se solicita y luego cada solicitud posterior utilizara la misma instancia."),(0,l.kt)("li",{parentName:"ul"},"AddTransient : Se crea cada vez que se solicita. Es \xfatil para servicios livianos y sin estado."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/38138100/addtransient-addscoped-and-addsingleton-services-differences#:~:text=Singleton%20is%20a%20single%20instance,single%20instance%20per%20code%20request"},"AddTransient, AddScoped and AddSingleton Services Differences")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://www.c-sharpcorner.com/article/understanding-addtransient-vs-addscoped-vs-addsingleton-in-asp-net-core/"},"Understanding AddTransient Vs AddScoped Vs AddSingleton In ASP.NET Core"))))),(0,l.kt)("h4",{id:"usamos-el-servicio-en-el-controlador"},"Usamos el servicio en el controlador"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En VillaController.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using AutoMapper;\nusing MiApp_API.Datos;\nusing MiApp_API.Modelos;\nusing MiApp_API.Modelos.Dto;\nusing MiApp_API.Repositorio.IRepositorio;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.JsonPatch;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.EntityFrameworkCore;\n\nnamespace MiApp_API.Controllers\n{\n    [Route("api/[controller]")]\n    [ApiController]\n    public class VillaController : ControllerBase\n    {\n\n        private readonly ILogger<VillaController> _logger;\n        private readonly IVillaRepositorio _villaRepo;\n        private readonly IMapper _mapper;\n\n        public VillaController(ILogger<VillaController> logger, IVillaRepositorio villaRepo, IMapper mapper)\n        {\n            _logger = logger;\n            _villaRepo = villaRepo;\n            _mapper = mapper;\n        }\n\n        [HttpGet]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        public async Task<ActionResult<IEnumerable<VillaDto>>> GetVillas()\n        {\n            _logger.LogInformation("Obtener las Villas");\n            IEnumerable<Villa> villaList = await _villaRepo.ObtenerTodos();\n\n            return Ok(_mapper.Map<IEnumerable<VillaDto>>(villaList));\n\n\n        }\n        [HttpGet("id:int" , Name ="GetVilla")]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        public async  Task<ActionResult<VillaDto>> GetVilla(int id)\n        {\n            if (id==0)\n            {\n                _logger.LogError("Error al traer Villa con Id  " + 0);\n                return BadRequest();\n            }\n\n            var villa = await  _villaRepo.Obtener(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n            return Ok(_mapper.Map<VillaDto>(villa));\n           \n        }\n\n        [HttpPost]\n        [ProducesResponseType(StatusCodes.Status201Created)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status500InternalServerError)]\n        public async  Task<ActionResult<VillaDto>> crearVilla([FromBody] VillaCreateDto createDto) { \n\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n\n            if (await _villaRepo.Obtener(v => v.Nombre.ToLower() == createDto.Nombre.ToLower()) != null)\n            {\n                ModelState.AddModelError("NombreExiste", "La villa con ese nombre ya existe");\n                 return BadRequest(ModelState);\n            }\n\n            if (createDto == null)\n            {\n                return BadRequest(createDto);\n            }\n            Villa modelo = _mapper.Map<Villa>(createDto);\n            await _villaRepo.Crear(modelo);\n           return CreatedAtRoute("GetVilla" , new {id= modelo.Id } , modelo);\n        }\n\n\n        [HttpDelete("{id:int}")]\n        [ProducesResponseType(StatusCodes.Status204NoContent)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public async Task<IActionResult> DeleteVilla(int id)\n        {\n            if (id == 0)\n            {\n                return BadRequest();\n            }\n\n            var villa = await _villaRepo.Obtener(v => v.Id == id);\n            if (villa == null)\n            {\n                return NotFound();\n            }\n\n           await _villaRepo.Remover(villa);\n            return NoContent();\n        }\n\n        [HttpPut ("{id:int}")]\n        [ProducesResponseType(StatusCodes.Status204NoContent)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public async Task<IActionResult> UpdateVilla(int id , [FromBody] VillaUpdateDto updateDto)\n        {\n            if (updateDto == null || id!= updateDto.Id)\n            {\n                return BadRequest();\n            }\n            Villa modelo = _mapper.Map<Villa>(updateDto);\n           await _villaRepo.Actualizar(modelo);\n           \n            return NoContent();\n        }\n\n\n        [HttpPatch("{id:int}")]\n        [ProducesResponseType(StatusCodes.Status204NoContent)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public async Task<IActionResult> UpdatePartialVilla(int id, JsonPatchDocument<VillaUpdateDto> patchDto)\n        {\n            if (patchDto == null || id == 0)\n            {\n                return BadRequest();\n            }\n            var villa = await  _villaRepo.Obtener(v => v.Id == id , false);\n            if (villa == null) return BadRequest();\n            VillaUpdateDto villaDto = _mapper.Map<VillaUpdateDto>(villa);\n            patchDto.ApplyTo(villaDto , ModelState);\n            if (!ModelState.IsValid)\n            {\n                return BadRequest(ModelState);\n            }\n            Villa modelo = _mapper.Map<Villa>(villaDto);\n\n            await _villaRepo.Actualizar(modelo);\n            return NoContent();\n        }\n\n    }\n\n  \n}\n\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Como te habr\xe1s dados cuenta, los servicios son \u201cInterfaces\u201d que tienen los m\xe9todos/propiedades de la clase que implemento la interfaz.")))),(0,l.kt)("h2",{id:"api-response"},"API Response"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Por ahora cada endpoint del controlador retorna una respuesta distinta. Esto es una mala pr\xe1ctica."),(0,l.kt)("li",{parentName:"ul"},"Una buena practica es que todos nuestros endpoints retornen una respuesta est\xe1ndar y que esta se adapte a lo que queremos devolver."),(0,l.kt)("li",{parentName:"ul"},"En la carpeta modelo, creamos una clase llamada APIResponse.cs"),(0,l.kt)("li",{parentName:"ul"},"Esta clase se encargar\xe1 de todas las respuestas que va a enviar nuestro controlador. B\xe1sicamente todos los endpoint devolver\xe1n como respuesta una instancia de esta clase, para que todas las respuestas sean similares (est\xe9n bajo un est\xe1ndar) y cambien seg\xfan lo que queremos devolver."),(0,l.kt)("li",{parentName:"ul"},"En APIResponse.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.Net;\n\nnamespace MiApp_API.Modelos\n{\n    public class APIResponse\n    {\n\n        public HttpStatusCode statusCode { get; set; }\n        public Boolean isExitoso { get; set; } = true;\n\n        public List<String>  ErrorMessages { get; set; }\n\n\n        public object Resultado { get; set; }\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Object es la clase base de todas las clases que existen en \u201c.NET\u201d. Por lo tanto, nos permite almacenar cualquier tipo de dato en la respuesta.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En el controlador VillaController.cs, lo a\xf1adimos en el constructor (no es una dependencia):")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"    public class VillaController : ControllerBase\n    {\n\n        private readonly ILogger<VillaController> _logger;\n        private readonly IVillaRepositorio _villaRepo;\n        private readonly IMapper _mapper;\n        protected APIResponse _response;\n\n        public VillaController(ILogger<VillaController> logger, IVillaRepositorio villaRepo, IMapper mapper)\n        {\n            _logger = logger;\n            _villaRepo = villaRepo;\n            _mapper = mapper;\n            _response = new();\n        }\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Y en cada endpoint ,  cambiamos lo que retorna:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using System.Net;\n      public async Task<ActionResult<APIResponse>> GetVillas()\n        {\n            try\n            {\n                _logger.LogInformation("Obtener las Villas");\n                IEnumerable<Villa> villaList = await _villaRepo.ObtenerTodos();\n                _response.Resultado = _mapper.Map<IEnumerable<VillaDto>>(villaList);\n                _response.statusCode = HttpStatusCode.OK;\n                return Ok(_response);\n            } catch (Exception e)\n            {\n                _response.isExitoso = false;\n                _response.ErrorMessages = new List<string> { e.ToString() };\n            }\n            return _response;\n\n\n        }\n\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Hacemos lo mismo para cada uno:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'public async  Task<ActionResult<APIResponse>> GetVilla(int id)\n        {\n            try\n            {\n                if (id == 0)\n                {\n                    _logger.LogError("Error al traer Villa con Id  " + 0);\n                    _response.statusCode = HttpStatusCode.BadRequest;\n                    _response.isExitoso = false;\n                    return BadRequest(_response);\n                   \n\n                }\n\n                var villa = await _villaRepo.Obtener(v => v.Id == id);\n                if (villa == null)\n                {\n                    _response.statusCode = HttpStatusCode.NotFound;\n                    _response.isExitoso = false;\n                    return NotFound(_response);\n                }\n                _response.Resultado = _mapper.Map<VillaDto>(villa);\n                _response.statusCode = HttpStatusCode.OK;\n                return Ok(_response);\n            }\n            catch (Exception e )\n            {\n                _response.isExitoso = false;\n                _response.ErrorMessages = new List<string> { e.ToString() };\n\n            }\n            return _response;\n           \n        }\n\n\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'  public async  Task<ActionResult<APIResponse>> crearVilla([FromBody] VillaCreateDto createDto) {\n            try\n            {\n                if (!ModelState.IsValid)\n                {\n                    return BadRequest(ModelState);\n                }\n\n                if (await _villaRepo.Obtener(v => v.Nombre.ToLower() == createDto.Nombre.ToLower()) != null)\n                {\n                    ModelState.AddModelError("NombreExiste", "La villa con ese nombre ya existe");\n                    return BadRequest(ModelState);\n                }\n\n                if (createDto == null)\n                {\n                    return BadRequest(createDto);\n                }\n                Villa modelo = _mapper.Map<Villa>(createDto);\n                await _villaRepo.Crear(modelo);\n                _response.Resultado = modelo;\n                _response.statusCode = HttpStatusCode.Created;\n                return CreatedAtRoute("GetVilla", new { id = modelo.Id }, _response);\n            }\n            catch (Exception e)\n            {\n\n                _response.isExitoso = false;\n                _response.ErrorMessages = new List<string> { e.ToString() };\n            }\n            return _response;\n        }\n\n')),(0,l.kt)("h4",{id:"c\xf3digo-de-estado-204"},"C\xf3digo de estado 204"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"No se puede aplicar esto a los que devuelven \u201cNo Content (204)\u201d porque:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"T\xe9cnicamente un 204 no tiene una respuesta."),(0,l.kt)("li",{parentName:"ul"},"Una Interfaz (como IActionResult por ej) no puede especificar el tipo de dato de un par\xe1metro de tipo gen\xe9rico. Ejemplo: iActionResult","<","APIResponse>."))),(0,l.kt)("li",{parentName:"ul"},"Si lo quieres hacer igual, cambia el 204 por un 200:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public async Task<IActionResult> DeleteVilla(int id)\n        {\n            try\n            {\n                if (id == 0)\n                {\n                    _response.isExitoso = false;\n                    _response.statusCode = HttpStatusCode.BadRequest;\n                    return BadRequest(_response);\n                }\n\n                var villa = await _villaRepo.Obtener(v => v.Id == id);\n                if (villa == null)\n                {\n                    _response.isExitoso = false;\n                    _response.statusCode = HttpStatusCode.NotFound;\n                    return NotFound(_response);\n                }\n\n                \n                await _villaRepo.Remover(villa);\n                _response.statusCode = HttpStatusCode.NoContent;\n                return Ok(_response);\n            } catch (Exception e)\n            {\n                _response.isExitoso = false;\n                _response.ErrorMessages = new List<string> { e.ToString() };\n            }\n\n            return BadRequest(_response);\n        }\n\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public async Task<IActionResult> UpdateVilla(int id , [FromBody] VillaUpdateDto updateDto)\n        {\n            if (updateDto == null || id!= updateDto.Id)\n            {\n                _response.isExitoso = false;\n                _response.statusCode = HttpStatusCode.BadRequest;\n                return BadRequest(_response);\n            }\n            Villa modelo = _mapper.Map<Villa>(updateDto);\n           await _villaRepo.Actualizar(modelo);\n            _response.statusCode = HttpStatusCode.NoContent;\n           \n            return Ok(_response);\n        }\n\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"   public async Task<IActionResult> UpdatePartialVilla(int id, JsonPatchDocument<VillaUpdateDto> patchDto)\n        {\n            if (patchDto == null || id == 0)\n            {\n                _response.isExitoso = false;\n                _response.statusCode = HttpStatusCode.BadRequest;\n                return BadRequest(_response);\n            }\n            var villa = await  _villaRepo.Obtener(v => v.Id == id , false);\n            if (villa == null) {\n                _response.isExitoso = false;\n                _response.statusCode = HttpStatusCode.BadRequest;\n                return BadRequest(_response);\n            }\n          \n            VillaUpdateDto villaDto = _mapper.Map<VillaUpdateDto>(villa);\n            patchDto.ApplyTo(villaDto , ModelState);\n            if (!ModelState.IsValid)\n            {\n               \n                return BadRequest(ModelState);\n            }\n            Villa modelo = _mapper.Map<Villa>(villaDto);\n\n            await _villaRepo.Actualizar(modelo);\n            _response.statusCode = HttpStatusCode.NoContent;\n            return Ok(_response);\n        }\n\n")),(0,l.kt)("h2",{id:"modelo-n\xfamero-de-villa"},"Modelo N\xfamero de Villa"),(0,l.kt)("h4",{id:"corregir-error-fecha-creaci\xf3nactualizaci\xf3n"},"Corregir error fecha creaci\xf3n/actualizaci\xf3n"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Para que el valor de las fechas se asigne bien en el Modelo Villa, hacemos lo siguiente."),(0,l.kt)("li",{parentName:"ul"},"En el villaController, espec\xedficamente el m\xe9todo de CrearVilla:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'                Villa modelo = _mapper.Map<Villa>(createDto);\n                modelo.FechaActualizacion = DateTime.Now;\n                modelo.FechaCreacion = DateTime.Now;\n                await _villaRepo.Crear(modelo);\n                _response.Resultado = modelo;\n                _response.statusCode = HttpStatusCode.Created;\n                return CreatedAtRoute("GetVilla", new { id = modelo.Id }, _response);\n\n')),(0,l.kt)("h4",{id:"nuevo-modelo"},"Nuevo Modelo"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Al crear un nuevo modelo debemos:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Modificar el dbContext para asignarlo como una tabla de la BD."),(0,l.kt)("li",{parentName:"ul"},"Crear su repositorio (interface e implementaci\xf3n), Dtos y su controlador."),(0,l.kt)("li",{parentName:"ul"},"Crear su mapeo."))),(0,l.kt)("li",{parentName:"ul"},"Creamos la clase NumeroVilla en la carpeta Modelos."),(0,l.kt)("li",{parentName:"ul"},"Representa una tabla en la BD."),(0,l.kt)("li",{parentName:"ul"},"Este modelo va a tener una relaci\xf3n de uno a muchos con la tabla Villa. \xd3sea una Villa puede tener muchos NumeroVilla."),(0,l.kt)("li",{parentName:"ul"},"En NumeroVilla.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using System.ComponentModel.DataAnnotations;\nusing System.ComponentModel.DataAnnotations.Schema;\n\nnamespace MiApp_API.Modelos\n{\n    public class NumeroVilla\n    {\n        [Key , DatabaseGenerated(DatabaseGeneratedOption.None)]\n        public int VillaNro { get; set; }\n\n\n        [Required]\n        public int VillaId { get; set; }\n\n        [ForeignKey("VillaId")]\n        public Villa Villa { get; set; }\n\n        public string DetalleEspecial { get; set; }\n\n        public DateTime FechaCreacion { get; set; }\n\n\n        public DateTime FechaActualizacion { get; set; }\n    }\n}\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Con DatabaseGeneratedOption.None , especificamos que la primary key la debemos asignar nosotros. \xd3sea debemos asignarle un valor a la propiedad que represente la primary key."),(0,l.kt)("li",{parentName:"ul"},"El  atributo ForeignKey recibe como par\xe1metro posicional el nombre de la propiedad que va a representar la foreign key . Este atributo se utiliza en una propiedad cuyo tipo de dato es el modelo(tabla) al cual hace referencia."),(0,l.kt)("li",{parentName:"ul"},"Con el atributo ForeignKey , el valor de la propiedad Villa es la villa que hace referencia su foreign key (la propiedad VillaId).")))),(0,l.kt)("h4",{id:"dtos"},"Dtos"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Debemos crear tres DTO: ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Uno normal."),(0,l.kt)("li",{parentName:"ul"},"El Dto para crear un modelo."),(0,l.kt)("li",{parentName:"ul"},"El Dto para actualizar un modelo.")))),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Agregamos una clase en la carpeta Modelos/Dto llamado NumeroVillaDto.cs.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Esta clase contendr\xe1 lo siguiente:")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.ComponentModel.DataAnnotations;\n\nnamespace MiApp_API.Modelos.Dto\n{\n    public class NumeroVillaDto\n    {\n  \n        public int VillaNro { get; set; }\n\n\n        [Required]\n        public int VillaId { get; set; }\n\n   \n\n        public string DetalleEspecial { get; set; }\n\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Recordatorio")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Una clase DTO contiene los datos que desea exponer al usuario.")))),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Agregamos otra clase en la carpeta Modelos/Dto llamado NumeroVillaCreateDto.cs.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Esta clase contendr\xe1 lo siguiente:")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.ComponentModel.DataAnnotations;\n\nnamespace MiApp_API.Modelos.Dto\n{\n    public class NumeroVillaCreateDto\n    {\n        public int VillaNro { get; set; }\n\n\n        [Required]\n        public int VillaId { get; set; }\n\n\n\n        public string DetalleEspecial { get; set; }\n    }\n}\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"A pesar que tienen las mismas propiedades, es una buena pr\xe1ctica dividir los DTO de una entidad(modelo) en varios.")))),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"Finalmente creamos NumeroVillaUpdateDto.cs con las mismas propiedades tambi\xe9n:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.ComponentModel.DataAnnotations;\n\nnamespace MiApp_API.Modelos.Dto\n{\n    public class NumeroVillaUpdateDto\n    {\n  \n        public int VillaNro { get; set; }\n\n\n        [Required]\n        public int VillaId { get; set; }\n\n   \n\n        public string DetalleEspecial { get; set; }\n\n    }\n}\n\n")),(0,l.kt)("h4",{id:"mapeo"},"Mapeo"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ahora creamos su mapeo."),(0,l.kt)("li",{parentName:"ul"},"En MappingConfig.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public class MappingConfig : Profile\n    {\n        public MappingConfig()\n        {\n            // 1 Forma\n            CreateMap<Villa, VillaDto>();\n            CreateMap<VillaDto, Villa>();\n\n            // 2 Forma\n            CreateMap<Villa, VillaCreateDto>().ReverseMap();\n            CreateMap<Villa, VillaUpdateDto>().ReverseMap();\n\n\n            CreateMap<NumeroVilla,  NumeroVillaDto>().ReverseMap();\n            CreateMap<NumeroVilla, NumeroVillaUpdateDto>().ReverseMap();\n            CreateMap<NumeroVilla, NumeroVillaCreateDto>().ReverseMap();\n\n        }\n    }\n\n")),(0,l.kt)("h4",{id:"dbcontext-1"},"DBContext"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En nuestro DbContext debemos agregar el dbSet de NumeroVilla"),(0,l.kt)("li",{parentName:"ul"},"En ApplicationDbContext.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"public class ApplicationDbContext : DbContext\n    {\n\n        public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options ) : base(options)\n        {\n            \n        }\n        public DbSet<Villa> Villas {get;set;}\n        public DbSet<NumeroVilla> NumeroVillas { get; set; }\n\n\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Recordatorio")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Cada propiedad de la clase dbContext es una tabla en la BD."),(0,l.kt)("li",{parentName:"ul"},"El nombre de cada propiedad debe ir en plural.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En la consola de administrador de paquetes, ejecutamos los comandos de la migraci\xf3n para crear la tabla en la BD:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-powershell"},"add-migration AgregarNumeroVilla\nupdate-database\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Luego de ejecutar los comandos, se recomienda fijarse en sql server  management studio (o la herramienta que uses) si la tabla se cre\xf3 correctamente.")))),(0,l.kt)("h4",{id:"interfaces-1"},"Interfaces"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ahora debemos hacer las interfaces y sus implementaciones correspondiente."),(0,l.kt)("li",{parentName:"ul"},"En la carpeta IRepositorio , creamos la interfaz INumeroVillaRepositorio (que puede ser una copia de IVillaRepositorio porque es casi igual)."),(0,l.kt)("li",{parentName:"ul"},"Contendr\xe1 casi lo mismo:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"using MiApp_API.Modelos;\n\nnamespace MiApp_API.Repositorio.IRepositorio\n{\n    public interface INumeroVillaRepositorio : IRepositorio<NumeroVilla>\n    {\n        Task<NumeroVilla> Actualizar(NumeroVilla entidad);\n    }\n}\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ahora creamos la implementaci\xf3n, en Repositorio creamos una clase llamada NumeroVillaRepositorio (que puede ser una copia de VillaRepositorio porque es casi igual)."),(0,l.kt)("li",{parentName:"ul"},"Contendra casi lo mismo:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"\nusing MiApp_API.Datos;\nusing MiApp_API.Modelos;\nusing MiApp_API.Repositorio.IRepositorio;\n\n\nnamespace MiApp_API.Repositorio\n{\n    public class NumeroVillaRepositorio : Repositorio<NumeroVilla>, INumeroVillaRepositorio\n    {\n        private readonly ApplicationDbContext _db;\n\n\n        public NumeroVillaRepositorio(ApplicationDbContext db) : base(db)\n        {\n            _db = db;\n        }\n\n        public async Task<NumeroVilla> Actualizar(NumeroVilla entidad)\n        {\n            entidad.FechaActualizacion = DateTime.Now;\n            _db.NumeroVillas.Update(entidad);\n            await _db.SaveChangesAsync();\n            return entidad;\n        }\n    }\n}\n\n")),(0,l.kt)("h4",{id:"agregamos-los-servicios"},"Agregamos los servicios"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Agregamos el servicio para poder usar los m\xe9todos que definimos en la interfaz."),(0,l.kt)("li",{parentName:"ul"},"En Progam.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"builder.Services.AddAutoMapper(typeof(MappingConfig));\nbuilder.Services.AddScoped<IVillaRepositorio, VillaRepositorio>();\nbuilder.Services.AddScoped<INumeroVillaRepositorio, NumeroVillaRepositorio>();\nvar app = builder.Build();\n\n")),(0,l.kt)("h4",{id:"creamos-el-controlador"},"Creamos el controlador"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Cada modelo, debe tener su propio controlador que lo gestione."),(0,l.kt)("li",{parentName:"ul"},"En la carpeta Controllers , creamos una copia de VillaController , que se va a llamar NumeroVillaController."),(0,l.kt)("li",{parentName:"ul"},"En NumeroVillaController.cs:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'using AutoMapper;\nusing MiApp_API.Datos;\nusing MiApp_API.Modelos;\nusing MiApp_API.Modelos.Dto;\nusing MiApp_API.Repositorio.IRepositorio;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Http.HttpResults;\nusing Microsoft.AspNetCore.JsonPatch;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.EntityFrameworkCore;\nusing System.Net;\n\nnamespace MiApp_API.Controllers\n{\n    [Route("api/[controller]")]\n    [ApiController]\n    public class NumeroVillaController : ControllerBase\n    {\n\n        private readonly ILogger<NumeroVillaController> _logger;\n        private readonly IVillaRepositorio _villaRepo;\n        private readonly INumeroVillaRepositorio _numeroRepo;\n        private readonly IMapper _mapper;\n        protected APIResponse _response;\n\n        public NumeroVillaController(ILogger<NumeroVillaController> logger, IVillaRepositorio villaRepo, IMapper mapper,\n           INumeroVillaRepositorio numeroRepo)\n        {\n            _logger = logger;\n            _villaRepo = villaRepo;\n            _mapper = mapper;\n            _response = new();\n            _numeroRepo = numeroRepo;\n        }\n\n        [HttpGet]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        public async Task<ActionResult<APIResponse>> GetNumeroVillas()\n        {\n            try\n            {\n                _logger.LogInformation("Obtener Numeros Villas");\n                IEnumerable<NumeroVilla> numeroVillaList = await _numeroRepo.ObtenerTodos();\n                _response.Resultado = _mapper.Map<IEnumerable<NumeroVillaDto>>(numeroVillaList);\n                _response.statusCode = HttpStatusCode.OK;\n                return Ok(_response);\n            } catch (Exception e)\n            {\n                _response.isExitoso = false;\n                _response.ErrorMessages = new List<string> { e.ToString() };\n            }\n            return _response;\n\n\n        }\n        [HttpGet("id:int" , Name ="GetVilla")]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        public async  Task<ActionResult<APIResponse>> GetNumeroVilla(int id)\n        {\n            try\n            {\n                if (id == 0)\n                {\n                    _logger.LogError("Error al traer Numero  Villa con Id  " + 0);\n                    _response.statusCode = HttpStatusCode.BadRequest;\n                    _response.isExitoso = false;\n                    return BadRequest(_response);\n                \n\n                }\n\n                var numeroVilla = await _numeroRepo.Obtener(v => v.VillaNro == id);\n                if (numeroVilla == null)\n                {\n                    _response.statusCode = HttpStatusCode.NotFound;\n                    _response.isExitoso = false;\n                    return NotFound(_response);\n                }\n                _response.Resultado = _mapper.Map<NumeroVillaDto>(numeroVilla);\n                _response.statusCode = HttpStatusCode.OK;\n                return Ok(_response);\n            }\n            catch (Exception e )\n            {\n                _response.isExitoso = false;\n                _response.ErrorMessages = new List<string> { e.ToString() };\n\n            }\n            return _response;\n           \n        }\n\n        [HttpPost]\n        [ProducesResponseType(StatusCodes.Status201Created)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status500InternalServerError)]\n        public async  Task<ActionResult<APIResponse>> crearNumeroVilla([FromBody] NumeroVillaCreateDto createDto) {\n            try\n            {\n                if (!ModelState.IsValid)\n                {\n                    return BadRequest(ModelState);\n                }\n\n                if (await _numeroRepo.Obtener(v => v.VillaNro == createDto.VillaNro) != null)\n                {\n                    ModelState.AddModelError("NombreExiste", "El numero de  villa  ya existe");\n                    return BadRequest(ModelState);\n                }\n\n\n                // Verificamos que la villa exista\n                if (await _villaRepo.Obtener(v => v.Id == createDto.VillaId ) == null) {\n                    ModelState.AddModelError("ClaveForanea", "El ID de la  villa  no existe");\n                    return BadRequest(ModelState);\n                }\n\n\n                if (createDto == null)\n                {\n                    return BadRequest(createDto);\n                }\n                NumeroVilla modelo = _mapper.Map<NumeroVilla>(createDto);\n                modelo.FechaActualizacion = DateTime.Now;\n                modelo.FechaCreacion = DateTime.Now;\n                await _numeroRepo.Crear(modelo);\n                _response.Resultado = modelo;\n                _response.statusCode = HttpStatusCode.Created;\n                return CreatedAtRoute("GetVilla", new { id = modelo.VillaNro }, _response);\n            }\n            catch (Exception e)\n            {\n\n                _response.isExitoso = false;\n                _response.ErrorMessages = new List<string> { e.ToString() };\n            }\n            return _response;\n        }\n\n\n        [HttpDelete("{id:int}")]\n        [ProducesResponseType(StatusCodes.Status204NoContent)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public async Task<IActionResult> DeleteNumeroVilla(int id)\n        {\n            try\n            {\n                if (id == 0)\n                {\n                    _response.isExitoso = false;\n                    _response.statusCode = HttpStatusCode.BadRequest;\n                    return BadRequest(_response);\n                }\n\n                var numeroVilla = await _numeroRepo.Obtener(v => v.VillaNro == id);\n                if (numeroVilla == null)\n                {\n                    _response.isExitoso = false;\n                    _response.statusCode = HttpStatusCode.NotFound;\n                    return NotFound(_response);\n                }\n\n                \n                await _numeroRepo.Remover(numeroVilla);\n                _response.statusCode = HttpStatusCode.NoContent;\n                return Ok(_response);\n            } catch (Exception e)\n            {\n                _response.isExitoso = false;\n                _response.ErrorMessages = new List<string> { e.ToString() };\n            }\n\n            return BadRequest(_response);\n        }\n\n        [HttpPut ("{id:int}")]\n        [ProducesResponseType(StatusCodes.Status204NoContent)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public async Task<IActionResult> UpdateNumeroVilla(int id , [FromBody] NumeroVillaUpdateDto updateDto)\n        {\n            if (updateDto == null || id!= updateDto.VillaNro)\n            {\n                _response.isExitoso = false;\n                _response.statusCode = HttpStatusCode.BadRequest;\n                return BadRequest(_response);\n            }\n\n            // Verificamos que la villa exista\n            if (await _villaRepo.Obtener(v => v.Id == updateDto.VillaId) == null)\n            {\n                ModelState.AddModelError("ClaveForanea", "El ID de la  villa  no existe");\n                return BadRequest(ModelState);\n            }\n            NumeroVilla modelo = _mapper.Map<NumeroVilla>(updateDto);\n           await _numeroRepo.Actualizar(modelo);\n            _response.statusCode = HttpStatusCode.NoContent;\n           \n            return Ok(_response);\n        }\n\n\n      \n\n    }\n\n  \n}\n\n')),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observaci\xf3n")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Tenemos acceso a las dos repositorios y sus m\xe9todos, por si queremos hacer alguna b\xfasqueda de alguna Villa.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Se utilizan un controlador por entidad, para poder identificar qu\xe9 modelo estas usando a trav\xe9s del endpoint (url).")))),(0,l.kt)("h4",{id:"attribute-routes-with-the-same-name-getvilla-must-have-the-same-template"},"Attribute routes with the same name 'GetVilla' must have the same template"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Al ejecutarlo nos va a tirar un error: Attribute routes with the same name 'GetVilla' must have the same template."),(0,l.kt)("li",{parentName:"ul"},"El error se produce porque no se puede tener dos endpoint con el mismo nombre (el que se especifica con el par\xe1metro nombrado \u201cName\u201d de un atributo verbo como HttpGet , HttpPost , etc)."),(0,l.kt)("li",{parentName:"ul"},"Cambiamos el nombre del endpoint GetNumeroVilla en NumeroVillaController.cs para solucionar este problema:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'    [HttpGet("id:int" , Name ="GetNumeroVilla")]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        public async  Task<ActionResult<APIResponse>> GetNumeroVilla(int id)\n\n')),(0,l.kt)("h4",{id:"lo-ejecutamos"},"Lo ejecutamos"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Podemos ver todos los endpoints(url) que creo el controlador para manipular los datos del modelo NumeroVilla.")),(0,l.kt)("h2",{id:"deploy"},"Deploy"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Para hacer deploy utilizaremos el servidor web IIS.")),(0,l.kt)("h4",{id:"habilitamos-iis"},"Habilitamos IIS"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Buscamos \u201cActivar o desactivar las caracteristicas de Windows\u201d en Windows."),(0,l.kt)("li",{parentName:"ol"},"Habilitamos Internet Information Services."),(0,l.kt)("li",{parentName:"ol"},'Debe estar Marcado "Herramientas de Administraci\xf3n web" y "Servicios World Wide Web".')),(0,l.kt)("h4",{id:"carpeta-inetpub"},"Carpeta inetpub"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Si lo hicimos bien, en el disco C se creo la carpeta inetpub que es donde IIS va a tomar los proyectos que desarrollamos."),(0,l.kt)("li",{parentName:"ul"},"La carpeta raiz es wwwroot."),(0,l.kt)("li",{parentName:"ul"},"En la carpeta raiz creamos una carpeta llamada netapi (aca van a ir los archivos).")),(0,l.kt)("h4",{id:"en-el-proyecto"},"En el proyecto"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En Progam.cs , cambiamos lo siguiente:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},"// Configure the HTTP request pipeline.\nif (app.Environment.IsProduction())\n{\n    app.UseSwagger();\n    app.UseSwaggerUI();\n}\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En Properties/launchSettings.json:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-csharp"},'  "profiles": {\n    "http": {\n      "commandName": "Project",\n      "dotnetRunMessages": true,\n      "launchBrowser": true,\n      "launchUrl": "swagger",\n      "applicationUrl": "http://localhost:5186",\n      "environmentVariables": {\n        "ASPNETCORE_ENVIRONMENT": "Production"\n      }\n    },\n\n')),(0,l.kt)("h4",{id:"pasos-a-seguir-para-hacer-deploy"},"Pasos a seguir para hacer deploy"),(0,l.kt)("h4",{id:"paso-1"},"Paso 1"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Hacemos click derecho en el nombre del proyecto \u2013 Abrir carpeta en el explorador de archivos. "),(0,l.kt)("li",{parentName:"ol"},"Nos ubicamos en /bin/Release/net7.0 (en esta carpeta se van a crear los archivos que vamos a generar en el siguiente paso, s\xed est\xe1 llena de archivos vac\xedala)."),(0,l.kt)("li",{parentName:"ol"},"En esta ubicaci\xf3n creamos una carpeta llamada publish.")),(0,l.kt)("h4",{id:"paso-2"},"Paso 2"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Hacemos click derecho en el nombre del proyecto \u2013 publicar \u2013 Carpeta."),(0,l.kt)("li",{parentName:"ol"},"Ubicaci\xf3n de la carpeta: Aca va la ubicaci\xf3n de la carpeta publish."),(0,l.kt)("li",{parentName:"ol"},"Le damos a finalizar."),(0,l.kt)("li",{parentName:"ol"},"Luego hacemos click en Publicar."),(0,l.kt)("li",{parentName:"ol"},"Si hicimos todo bien, se crearon archivos en la carpeta publish."),(0,l.kt)("li",{parentName:"ol"},"Copiamos todos los archivos/carpetas que se generaron en la carpeta publish (Control + E) al directorio C:\\inetpub\\wwwroot\\netapi (la carpeta que creamos para IIS).")),(0,l.kt)("h4",{id:"en-iis"},"En IIS"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"En sitios click derecho \u2013 Agregar Sitio web:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Nombre del sitio: apivillas."),(0,l.kt)("li",{parentName:"ul"},"Ruta de acceso f\xedsica: C:\\inetpub\\wwwroot\\netapi (La carpeta que creamos con los archivos que generamos)."),(0,l.kt)("li",{parentName:"ul"},"Conectar como \u2013 Usuario especifico \u2013 establecer:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Nombre de usuario: el usuario de la cuenta con el cual entras al equipo(pc)."),(0,l.kt)("li",{parentName:"ul"},"Contrase\xf1a: la contrase\xf1a que usas para entrar al equipo."))),(0,l.kt)("li",{parentName:"ul"},"Le damos a aceptar."))),(0,l.kt)("li",{parentName:"ol"},"Luego hacemos clic en Probar configuraci\xf3n para ver que este todo bien."),(0,l.kt)("li",{parentName:"ol"},"Por \xfaltimo, hacemos clic en Aceptar.")),(0,l.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"El usuario que especificamos, debe tener acceso a la ruta de acceso f\xedsica.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Si tenes dos sitios con el mismo puerto."),(0,l.kt)("li",{parentName:"ul"},"Para iniciar uno, tenes que detener el otro.")))),(0,l.kt)("h4",{id:"configuraci\xf3n-b\xe1sica-de-grupo-de-aplicaciones"},"Configuraci\xf3n b\xe1sica de Grupo de aplicaciones"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"El grupo de aplicaciones que generamos al crear el sitio, debe tener la siguiente configuraci\xf3n b\xe1sica:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Version de .NET CLR: Sin c\xf3digo administrado."),(0,l.kt)("li",{parentName:"ul"},"Modo de canalizaci\xf3n administrada: Integrada."))),(0,l.kt)("li",{parentName:"ul"},"En establecer valores predeterminados:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Version de .NET CLR: Sin c\xf3digo administrado."),(0,l.kt)("li",{parentName:"ul"},"Identidad: ApplicationPoolIdentity.")))),(0,l.kt)("h4",{id:"en-el-servidor-en-iis"},"En el servidor (en IIS)"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"En la pesta\xf1a modulos , nos fijamos si esta instalado  AspNetCoreModuleV2."),(0,l.kt)("li",{parentName:"ul"},"Si no lo esta, lo instalamos:",(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"Entramos al ",(0,l.kt)("a",{parentName:"li",href:"https://dotnet.microsoft.com/en-us/download/dotnet/7.0"},"sitio web"),"."),(0,l.kt)("li",{parentName:"ol"},"Instalamos ASP.NET Core Runtime X (el que dice que tiene soporte con ASP.Net Core Module v2) \u2013 Windows \u2013 Hosting Bundle."),(0,l.kt)("li",{parentName:"ol"},"Una vez instalado, reiniciamos el servidor en ISS y entramos a m\xf3dulos para verificar que est\xe1 instalado.")))),(0,l.kt)("h4",{id:"desplegamos"},"Desplegamos!"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Iniciamos el sitio que creamos y lo abrimos con la opcion Examinar."),(0,l.kt)("li",{parentName:"ul"},"Nos tirar\xeda un error 404."),(0,l.kt)("li",{parentName:"ul"},"Pero si entramos a localhost/swagger nos abrir\xeda un index.html con la API.")),(0,l.kt)("h4",{id:"usar-una-bd"},"Usar una BD"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Al hacer una petici\xf3n Get, nos tirar\xeda un error, esto es porque la BD est\xe1 mal configurada ya que nos pide autenticaci\xf3n."),(0,l.kt)("li",{parentName:"ul"},"El error se debe a que IIS no se puede conectar a la BD porque no tiene permisos."),(0,l.kt)("li",{parentName:"ul"},"Para solucionar esto: ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"En SQL Server Management Studio, abrimos la carpeta que corresponde a la BD y en la carpeta Security/Users , creamos un nuevo usuario (click derecho \u2013 new user):",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"User Name: IIS APPPOOL\\apivillas (este ultimo corresponde al nombre del sitio)."),(0,l.kt)("li",{parentName:"ul"},"User Login: IIS APPPOOL\\apivillas (este ultimo corresponde al nombre del sitio)."),(0,l.kt)("li",{parentName:"ul"},"En Membership:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Marcamos db_owner para que pueda tener acceso a la bd."))))),(0,l.kt)("li",{parentName:"ul"},"En IIS:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Grupo de Aplicaciones \u2013 Seleccionamos la que generamos al crear el sitio(apivillas) \u2013 Configuraci\xf3n avanzada y en entidad le asignamos LocalSystem.")))))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"En lugar de poner LocalSystem, podes poner en \u201cCuenta personalizada\u201d el usuario de Windows con el cual se ingresa a la base de datos."),(0,l.kt)("li",{parentName:"ul"},"De esta manera es mas seguro.")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},'Otra forma de implementarlo, es desactivando la opcion "Trusted_Connection" con false y acceder mediante un usuario de la bd (que se tiene que crear en sql server). Para esto se tiene que modificar la url de conexi\xf3n en Appsetings.json   '),(0,l.kt)("li",{parentName:"ul"},'De esta forma podemos seguir usando "ApplicationPoolIdentity" que es mas seguro.')))),(0,l.kt)("h4",{id:"listo"},"\xa1Listo!"))}c.isMDXComponent=!0}}]);