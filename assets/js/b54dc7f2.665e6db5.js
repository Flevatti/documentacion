"use strict";(self.webpackChunkdocumentacion=self.webpackChunkdocumentacion||[]).push([[5886],{3905:(e,a,n)=>{n.d(a,{Zo:()=>c,kt:()=>u});var o=n(7294);function t(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function r(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);a&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?r(Object(n),!0).forEach((function(a){t(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function l(e,a){if(null==e)return{};var n,o,t=function(e,a){if(null==e)return{};var n,o,t={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],a.indexOf(n)>=0||(t[n]=e[n]);return t}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}var s=o.createContext({}),d=function(e){var a=o.useContext(s),n=a;return e&&(n="function"==typeof e?e(a):i(i({},a),e)),n},c=function(e){var a=d(e.components);return o.createElement(s.Provider,{value:a},e.children)},m={inlineCode:"code",wrapper:function(e){var a=e.children;return o.createElement(o.Fragment,{},a)}},p=o.forwardRef((function(e,a){var n=e.components,t=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(n),u=t,k=p["".concat(s,".").concat(u)]||p[u]||m[u]||r;return n?o.createElement(k,i(i({ref:a},c),{},{components:n})):o.createElement(k,i({ref:a},c))}));function u(e,a){var n=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var r=n.length,i=new Array(r);i[0]=p;var l={};for(var s in a)hasOwnProperty.call(a,s)&&(l[s]=a[s]);l.originalType=e,l.mdxType="string"==typeof e?e:t,i[1]=l;for(var d=2;d<r;d++)i[d]=n[d];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},4240:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var o=n(7462),t=(n(7294),n(3905));const r={sidebar_position:7},i="API REST 2022",l={unversionedId:"Node/apiRest",id:"Node/apiRest",title:"API REST 2022",description:"- Separaremos lo que es backend del frontend, por ende este mismo proyecto de back nos servir\xe1 tanto para Vue o React.",source:"@site/docs/Node/apiRest.md",sourceDirName:"Node",slug:"/Node/apiRest",permalink:"/documentacion/docs/Node/apiRest",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Node/apiRest.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"Node",previous:{title:"Guia practica - 2022",permalink:"/documentacion/docs/Node/Guia"}},s={},d=[{value:"Normas a seguir",id:"normas-a-seguir",level:3},{value:"Primeros pasos",id:"primeros-pasos",level:2},{value:"1. Instalamos los modulos",id:"1-instalamos-los-modulos",level:3},{value:"Explicacion de los modulos:",id:"explicacion-de-los-modulos",level:4},{value:"Configuramos el package.json",id:"configuramos-el-packagejson",level:3},{value:"Archivo .gitignore",id:"archivo-gitignore",level:3},{value:"Carpetas a crear",id:"carpetas-a-crear",level:3},{value:"Probemos",id:"probemos",level:3},{value:"Mongoose",id:"mongoose",level:2},{value:"En mongoDB",id:"en-mongodb",level:3},{value:"En el proyecto",id:"en-el-proyecto",level:3},{value:"Schema &amp; Models",id:"schema--models",level:2},{value:"Routes/Controllers",id:"routescontrollers",level:2},{value:"Actualizamos el index.js",id:"actualizamos-el-indexjs",level:3},{value:"Separamos la logica",id:"separamos-la-logica",level:3},{value:"Formas de enviar datos",id:"formas-de-enviar-datos",level:2},{value:"Postman",id:"postman",level:3},{value:"Para leer la informaci\xf3n que nos mandan en JSON a trav\xe9s del body configuramos un middleware.",id:"para-leer-la-informaci\xf3n-que-nos-mandan-en-json-a-trav\xe9s-del-body-configuramos-un-middleware",level:3},{value:"Validaciones (Express-Validator)",id:"validaciones-express-validator",level:2},{value:"Completamos las validaciones",id:"completamos-las-validaciones",level:3},{value:"Middleware Personalizado para validar",id:"middleware-personalizado-para-validar",level:2},{value:"Cifrar contrase\xf1a / Schema.pre / Save",id:"cifrar-contrase\xf1a--schemapre--save",level:2},{value:"Schema pre",id:"schema-pre",level:3},{value:"bycriptjs",id:"bycriptjs",level:3},{value:"Guardamos los usuarios en la BD.",id:"guardamos-los-usuarios-en-la-bd",level:3},{value:"Validaciones // findOne()",id:"validaciones--findone",level:2},{value:"Validaciones",id:"validaciones",level:3},{value:"findOne()",id:"findone",level:3},{value:"Login/A\xf1adirle m\xe9todos al esquema",id:"logina\xf1adirle-m\xe9todos-al-esquema",level:2},{value:"A\xf1adirle metodos al esquema",id:"a\xf1adirle-metodos-al-esquema",level:3},{value:"JWT",id:"jwt",level:2},{value:"Generar Token en el Login/Register",id:"generar-token-en-el-loginregister",level:2},{value:"Metodo sign()",id:"metodo-sign",level:3},{value:"Refresh Token",id:"refresh-token",level:2},{value:"Refresh Token",id:"refresh-token-1",level:3},{value:"JWT V2",id:"jwt-v2",level:2},{value:"Generamos el token en el register",id:"generamos-el-token-en-el-register",level:3},{value:"Ruta protegida",id:"ruta-protegida",level:2},{value:"Postman",id:"postman-1",level:3},{value:"Middleware",id:"middleware",level:3},{value:"verify()",id:"verify",level:3},{value:"Quitarle el formato bearer",id:"quitarle-el-formato-bearer",level:3},{value:"Ruta protegida  #2  / A\xf1adir una propiedad al objeto req / findById()",id:"ruta-protegida--2---a\xf1adir-una-propiedad-al-objeto-req--findbyid",level:2},{value:"findById()",id:"findbyid",level:2},{value:"Validaciones del token",id:"validaciones-del-token",level:2},{value:"1 Forma",id:"1-forma",level:3},{value:"2 Forma",id:"2-forma",level:3},{value:"Modificamos la informaci\xf3n que nos devuelve la ruta protegida y usamos el Lean",id:"modificamos-la-informaci\xf3n-que-nos-devuelve-la-ruta-protegida-y-usamos-el-lean",level:2},{value:"lean()",id:"lean",level:3},{value:"Simple HTML",id:"simple-html",level:2},{value:"Habilitamos la carpeta public  con el middleware:",id:"habilitamos-la-carpeta-public--con-el-middleware",level:4},{value:"Solicitudes con fetch",id:"solicitudes-con-fetch",level:2},{value:"Metodo fetch",id:"metodo-fetch",level:3},{value:"fetch(url , {configuraciones})",id:"fetchurl--configuraciones",level:3},{value:"Configuraciones del fetch  (Propiedad y valor)",id:"configuraciones-del-fetch--propiedad-y-valor",level:3},{value:"Formas de guardar el token",id:"formas-de-guardar-el-token",level:2},{value:"localStorage",id:"localstorage",level:3},{value:"Cookies (Sin configuraciones)",id:"cookies-sin-configuraciones",level:3},{value:"metodo cookie()",id:"metodo-cookie",level:3},{value:"Cookies (Con configuraciones)",id:"cookies-con-configuraciones",level:3},{value:"Configuracion (3 parametro del metodo cookie)",id:"configuracion-3-parametro-del-metodo-cookie",level:4},{value:"httpOnly : boolean",id:"httponly--boolean",level:5},{value:"secure : boolean",id:"secure--boolean",level:5},{value:"Obtener el valor de la cookie",id:"obtener-el-valor-de-la-cookie",level:3},{value:"credentials",id:"credentials",level:3},{value:"Refresh Token",id:"refresh-token-2",level:2},{value:"Acceder al \u201ctoken verdadero\u201d a trav\xe9s del Refresh Token.",id:"acceder-al-token-verdadero-a-trav\xe9s-del-refresh-token",level:3},{value:"Explicacion",id:"explicacion",level:4},{value:"Ahora accedemos al \u201ctoken verdadero\u201d desde el archivo HTML",id:"ahora-accedemos-al-token-verdadero-desde-el-archivo-html",level:3},{value:"Explicacion",id:"explicacion-1",level:4},{value:"Logout",id:"logout",level:2},{value:"Refactorizacion",id:"refactorizacion",level:2},{value:"Errores  al verificar el token",id:"errores--al-verificar-el-token",level:3},{value:"middleware requireRefreshToken",id:"middleware-requirerefreshtoken",level:3},{value:"Separamos el middleware de express-validator del auth.route.js",id:"separamos-el-middleware-de-express-validator-del-authroutejs",level:3},{value:"Links (URL)  / Referencia al usuario",id:"links-url---referencia-al-usuario",level:2},{value:"Modelo",id:"modelo",level:3},{value:"Router",id:"router",level:3},{value:"Leer / Find()",id:"leer--find",level:2},{value:"Find()",id:"find",level:3},{value:"Sin parametros",id:"sin-parametros",level:4},{value:"Con un par\xe1metro (Objeto)",id:"con-un-par\xe1metro-objeto",level:4},{value:"Crear",id:"crear",level:2},{value:"Validar URL (longLink)",id:"validar-url-longlink",level:2},{value:"Express Validator",id:"express-validator",level:3},{value:"Axios",id:"axios",level:3},{value:"Obtener una ruta",id:"obtener-una-ruta",level:2},{value:"1 Alternativa",id:"1-alternativa",level:3},{value:"2 Alternativa",id:"2-alternativa",level:3},{value:"Remove",id:"remove",level:2},{value:"metodo remove()",id:"metodo-remove",level:3},{value:"Validar params (variables de la url)",id:"validar-params-variables-de-la-url",level:2},{value:"Modificar",id:"modificar",level:2},{value:"Redirect (Opcional)",id:"redirect-opcional",level:2},{value:"mongo sanitize",id:"mongo-sanitize",level:2},{value:"Cors",id:"cors",level:2},{value:"Cors sin configuracion",id:"cors-sin-configuracion",level:3},{value:"Configuracion de cors",id:"configuracion-de-cors",level:3},{value:"Propiedad Origin",id:"propiedad-origin",level:4},{value:"Lo dejamos configurado para dos dominios",id:"lo-dejamos-configurado-para-dos-dominios",level:3},{value:"Deploy Heroku",id:"deploy-heroku",level:2},{value:"A tener en cuenta",id:"a-tener-en-cuenta",level:3},{value:"El puerto",id:"el-puerto",level:4},{value:". gitignore",id:"-gitignore",level:4},{value:"Script",id:"script",level:4},{value:"En Heroku",id:"en-heroku",level:3},{value:"Cambios del proyecto",id:"cambios-del-proyecto",level:3},{value:"LISTO!",id:"listo",level:3},{value:"Deploy con Render",id:"deploy-con-render",level:2},{value:"En el sitio web",id:"en-el-sitio-web",level:3},{value:"Listo!!",id:"listo-1",level:3}],c={toc:d};function m(e){let{components:a,...n}=e;return(0,t.kt)("wrapper",(0,o.Z)({},c,n,{components:a,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"api-rest-2022"},"API REST 2022"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Separaremos lo que es backend del frontend, por ende este mismo proyecto de back nos servir\xe1 tanto para Vue o React.")),(0,t.kt)("h3",{id:"normas-a-seguir"},"Normas a seguir"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"No se puede guardar la sesion del usuario en el servidor"),(0,t.kt)("li",{parentName:"ul"},"La respuesta debe ser en JSON")),(0,t.kt)("h2",{id:"primeros-pasos"},"Primeros pasos"),(0,t.kt)("h3",{id:"1-instalamos-los-modulos"},"1. Instalamos los modulos"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-powershell"},"npm init -y\nnpm i bcryptjs cookie-parser cors dotenv express express-validator jsonwebtoken mongoose\nnpm i -D nodemon\n\n")),(0,t.kt)("h4",{id:"explicacion-de-los-modulos"},"Explicacion de los modulos:"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"nodemon : Para crear un servidor de desarollo "),(0,t.kt)("li",{parentName:"ol"},"express: Para levantar un servidor"),(0,t.kt)("li",{parentName:"ol"},"express-validator : Para validar las solicitudes del cliente"),(0,t.kt)("li",{parentName:"ol"},"mongoose: Para hacer consultas a la BD "),(0,t.kt)("li",{parentName:"ol"},"jsonwebtoken: Para generar tokens de seguridad y gestionarlo."),(0,t.kt)("li",{parentName:"ol"},"dontenv : Para trabajar con variables de entornos"),(0,t.kt)("li",{parentName:"ol"},"cors: Para configurar la comunicaci\xf3n del frontend y backend "),(0,t.kt)("li",{parentName:"ol"},"cookie-parser: Para gestionar las cookies."),(0,t.kt)("li",{parentName:"ol"},"bycripts : Para cifrar la contrase\xf1a")),(0,t.kt)("h3",{id:"configuramos-el-packagejson"},"Configuramos el package.json"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Configuramos el package.json para trabajar con los modulos (import y export)"),(0,t.kt)("li",{parentName:"ul"},"Tambien le a\xf1adimos los script dev y start")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "backend",\n  "type":"module",\n  "version": "1.0.0",\n  "description": "",\n  "main": "index.js",\n  "scripts": {\n    "dev": "nodemon index.js",\n    "start" : "node index.js"\n  },\n\n')),(0,t.kt)("h3",{id:"archivo-gitignore"},"Archivo .gitignore"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"node_modules\n.env\n\n")),(0,t.kt)("h3",{id:"carpetas-a-crear"},"Carpetas a crear"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"controllers : Contiene la logica de las rutas"),(0,t.kt)("li",{parentName:"ul"},"routes  : Contiene las rutas "),(0,t.kt)("li",{parentName:"ul"},"models : modelos/esquemas de la BD"),(0,t.kt)("li",{parentName:"ul"},"middlewares : Para interceptar rutas."),(0,t.kt)("li",{parentName:"ul"},"helper/utils : Para reutilizar c\xf3digo "),(0,t.kt)("li",{parentName:"ul"},"database : Contiene la conexi\xf3n a la BD")),(0,t.kt)("h3",{id:"probemos"},"Probemos"),(0,t.kt)("p",null,"index.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import express from 'express';\n\nconst app = express();\n\n// Gestionamos una peticion get a la raiz\napp.get('/' , (req , res) => {\n    res.json({ok : true})\n})\n\napp.listen(5000 , () => console.log('http://localhost:5000'));\n\n")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-powershell"},"npm run dev\n")),(0,t.kt)("h2",{id:"mongoose"},"Mongoose"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://www.mongodb.com/"},"mongodb")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://mongoosejs.com/"},"mongoose"))),(0,t.kt)("h3",{id:"en-mongodb"},"En mongoDB"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"Iniciamos sesion  (si sos  nuevo , tenes que crear un cluster)"),(0,t.kt)("li",{parentName:"ol"},"Creas un usuario ")),(0,t.kt)("h3",{id:"en-el-proyecto"},"En el proyecto"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"Pones la URI en una variable del .env ")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"URI_MONGO=XXX\n")),(0,t.kt)("ol",{start:2},(0,t.kt)("li",{parentName:"ol"},"Establecemos la conexion\ndatabase/connectDB.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import mongoose from \"mongoose\";\n\n//connect(uri)\ntry {\n    await mongoose.connect(process.env.URI_MONGO)\n    console.log('Conexion a la BD completa');\n} catch(error) {\n   console.log('Error de conexion a mongoDB  ' + error)\n}\n\n")),(0,t.kt)("p",null,"index.js "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import express from 'express';\n// Habilitamos las variables de entorno\nimport 'dotenv/config';\nimport './database/connectDB.js'\nconst app = express();\n\n// Gestionamos una peticion get a la raiz\napp.get('/' , (req , res) => {\n    res.json({ok : true})\n})\n// Si no existe, asigna el puerto 500\nconst PORT = process.env.PORT || 5000\napp.listen(PORT , () => console.log('http://localhost:'+PORT));\n\n")),(0,t.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Al importar un archivo , puede pasar que sin la extensi\xf3n .js no lo lea."))),(0,t.kt)("h2",{id:"schema--models"},"Schema & Models"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://mongoosejs.com/docs/guide.html#definition"},"Esquema")),(0,t.kt)("li",{parentName:"ul"},"Con Mongoose, todo se deriva de un esquema."),(0,t.kt)("li",{parentName:"ul"},"Cada esquema se asigna a una colecci\xf3n MongoDB y define la forma de los documentos dentro de esa colecci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"Para usar nuestra definici\xf3n de esquema, necesitamos convertirla a un modelo con el que podamos trabajar.")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Modelo")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Modelo: Contiene los m\xe9todos para leer, crear, modificar, eliminar datos de la colecci\xf3n."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://mongoosejs.com/docs/queries.html"},"Ver metodos del modelo"))))),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Esquema")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Esquema: Estructura de los documentos de la colecci\xf3n"),(0,t.kt)("li",{parentName:"ul"},"Si no se respeta la estructura(esquema) a la hora de crear un documento, se genera un error.")))),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"indice ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://desarrolloweb.com/articulos/intro-indices-mysql.html#:~:text=Los%20%C3%ADndices%20en%20MySQL%20permiten,tabla%20en%20un%20momento%20dado"},"link")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://www.adictosaltrabajo.com/2015/09/11/introduccion-a-indices-en-mysql/"},"link2"))))),(0,t.kt)("p",null,"models/User.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import mongoose from 'mongoose'\n\n// Creamos el esquema (Lo instanciamos)\n// new Schema({los campos que va a tener el documento})\n\nconst userSchema =  new mongoose.Schema({\n    // Cada campo contiene un objeto especificando el tipo de dato(type) , si es obligatorio(required) , etc\n    email: {\n            type:String ,\n            required:true,\n            trim:true /* Limpia los caracteres en blanco */ ,\n            unique:true /* Valor unico */ ,\n            lowercase:true /* Los convierte en minuscula */, \n            index:{unique:true} /* Indexar */,\n    } , \n    password : {\n        type:String ,\n        required:true\n    }\n})\n\n// Creamos el modelo y lo exportamos\n // model('nombreModelo' , esquema )\n // el nombreModelo = nombre de la coleccion que va a contener esa estructura(esquema)\nexport const User = mongoose.model('User' , userSchema);\n\n")),(0,t.kt)("h2",{id:"routescontrollers"},"Routes/Controllers"),(0,t.kt)("p",null,"Routes/auth.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import express from \'express\';\nconst router = express.Router();\n\nrouter.post("/login" , (req,res) => {\n    res.json({ok:true})\n})\nrouter.post("/register" , (req,res) => {\n    res.json({ok:true})\n})\n\nexport default router;\n\n')),(0,t.kt)("p",null,"index.js "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import express from 'express';\n// Habilitamos las variables de entorno\nimport 'dotenv/config';\nimport './database/connectDB.js'\n\nimport authRouter from './routes/auth.route.js';\n\nconst app = express();\n\napp.use('/' , authRouter)\n\n// Si no existe, asigna el puerto 500\nconst PORT = process.env.PORT || 5000\napp.listen(PORT , () => console.log('http://localhost:'+PORT));\n\n")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tipo de peticiones ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"El navegador solo trabaja con solicitudes GET."),(0,t.kt)("li",{parentName:"ul"},"El formulario HTML a trav\xe9s del atributo method puede enviar solicitudes GET O POST"),(0,t.kt)("li",{parentName:"ul"},"Usamos postman para trabajar con un conjunto de solicitudes (GET , POST , PUT , DELETE , ETC)")))),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Se hace peticiones get a :"),(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"http://localhost:5000/login"),(0,t.kt)("li",{parentName:"ul"},"http://localhost:5000/register")))),(0,t.kt)("h3",{id:"actualizamos-el-indexjs"},"Actualizamos el index.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"app.use('/api' , authRouter)\n")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Se hace peticiones get a :"),(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"http://localhost:5000/api/register"),(0,t.kt)("li",{parentName:"ul"},"http://localhost:5000/api/login")))),(0,t.kt)("h3",{id:"separamos-la-logica"},"Separamos la logica"),(0,t.kt)("p",null,"Controllers/auth.controllers.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const login = (req , res) => {\n    res.json({ok:true})\n}\nexport const register = (req , res) => {\n    res.json({ok:true})\n}\n\n")),(0,t.kt)("p",null,"Routes/auth.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import express from 'express';\nimport { login, register } from '../Controllers/auth.controllers.js';\nconst router = express.Router();\n\nrouter.post(\"/login\" , login)\nrouter.post(\"/register\" , register)\n\nexport default router;\n\n")),(0,t.kt)("h2",{id:"formas-de-enviar-datos"},"Formas de enviar datos"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"La informaci\xf3n se env\xeda por el body.")),(0,t.kt)("h3",{id:"postman"},"Postman"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Existen diferente manera de enviar la informacion: ")),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"A traves de un query params (GET)"),(0,t.kt)("li",{parentName:"ol"},"A trav\xe9s de form-data"),(0,t.kt)("li",{parentName:"ol"},"A trav\xe9s de x-www-form-urlencoded (etiqueta form HTML)"),(0,t.kt)("li",{parentName:"ol"},"raw \u2013 Json   (Para Enviar por json)")),(0,t.kt)("h3",{id:"para-leer-la-informaci\xf3n-que-nos-mandan-en-json-a-trav\xe9s-del-body-configuramos-un-middleware"},"Para leer la informaci\xf3n que nos mandan en JSON a trav\xe9s del body configuramos un middleware."),(0,t.kt)("p",null,"index.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"const app = express();\napp.use(express.json());\n\n")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Entonces podemos leer la informaci\xf3n que recibimos en el requirimiento (body).")),(0,t.kt)("p",null,"Ejemplo:"),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const login = (req , res) => {\n    console.log(req.body);\n    res.json({ok:true})\n    \n}\n\n")),(0,t.kt)("h2",{id:"validaciones-express-validator"},"Validaciones (Express-Validator)"),(0,t.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"LAS VALIDACIONES EN EL BACKEND SON OBLIGATORIAS YA QUE APORTA SEGURIDAD"),(0,t.kt)("li",{parentName:"ul"},"LAS VALIDACIONES EN EL FRONTEND AYUDAN AL USUARIO , NO APORTAN SEGURIDAD")))),(0,t.kt)("p",null,"auth.route.js "),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Especificamos las validaciones a realizar")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"// importamos el body de express-validator que es un middleware\nimport {body} from 'express-validator';\nconst router = express.Router();\n\n//post(\"ruta\" , [middlewares] , funcion que gestiona la solicitud)\n// Los middleware analizan la solicitud y si esta todo correcto , ejecuta la funcion que gestiona la solicitud.\n//body('nombrepropiedad' , 'mensaje de error').validaciones.validaciones.validaciones\n// cuando se reciba en el body la propiedad 'nombrepropiedad' , lo validara.\nrouter.post(\"/login\" , [body('email' , 'No es un email').isEmail().normalizeEmail()] , login)\nrouter.post(\"/register\" , register)\n\nexport default router;\n\n")),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Realizamos las validaciones que especificamos y obtenemos un resultado (si paso o no)")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { validationResult } from "express-validator";\nexport const login = (req, res) => {\n    // Realizamos/Ejecutamos las validaciones de express-validator \n    //validationResult(req) -- en el req estan los datos que se van a validar\n    // Devuelve el error en caso que exista\n    const error = validationResult(req);\n\n    // Si existen errores\n    if (!error.isEmpty()) {\n        return res.status(400).json({ errors: error.array() })\n    }\n    console.log(req.body);\n    res.json({ ok: true })\n\n}\n\n')),(0,t.kt)("h3",{id:"completamos-las-validaciones"},"Completamos las validaciones"),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Validaciones ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"trim()  = Limpia los caracteres en blanco"),(0,t.kt)("li",{parentName:"ul"},"isEmail() y normalizeEmail() = Comprueba que sea un email valido"),(0,t.kt)("li",{parentName:"ul"},"isLenght({min:X}) = Comprueba que el valor tenga m\xednimo  X caracteres"),(0,t.kt)("li",{parentName:"ul"},"custom(funcion) = Validacion personalizada")))),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"validacion personalizada")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"custom(funcion) = Validacion personalizada"),(0,t.kt)("li",{parentName:"ul"},"La funci\xf3n de la validacion personalizada tiene dos par\xe1metros, el valor y el requerimiento(req)."),(0,t.kt)("li",{parentName:"ul"},"En la funci\xf3n se realiza una validacion. En caso que no se cumpla se lanza un error, si se cumple se retorna el valor.")))),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Por defecto la respuesta tiene el c\xf3digo de estado 200"))),(0,t.kt)("p",null,"auth.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import express from 'express';\nimport { login, register } from '../Controllers/auth.controllers.js';\n// importamos el body de express-validator que es un middleware\nimport {body} from 'express-validator';\nconst router = express.Router();\n\n//post(\"ruta\" , [middlewares] , funcion que gestiona la solicitud)\n// Los middleware analizan la solicitud y si esta todo correcto , ejecuta la funcion que gestiona la solicitud.\n//body('nombrepropiedad' , 'mensaje de error').validaciones.validaciones.validaciones\n// cuando se reciba en el body la propiedad 'nombrepropiedad' , lo validara.\nrouter.post(\"/login\" , [body('email' , 'No es un email').trim().isEmail().normalizeEmail() , body('password' , 'formato de password incorrecta').trim().isLength({min:6}) ] , login)\nrouter.post(\"/register\" , [body('email' , 'No es un email').trim().isEmail().normalizeEmail() ,body('password' , 'formato de password incorrecta').trim().isLength({min:6}) ,  body('password' , 'No coinciden las contrase\xf1as').custom((value , {req}) => {\n   if (value !== req.body.repassword) {\n       // No se cumple la validacion\n       // Se lanza un error\n       throw new Error('No coinciden las contrase\xf1as');\n   }\n   // Se cumple la validacion \n   // Se retorna el valor\n   return value;\n}) ] ,  register)\n\nexport default router;\n\n")),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { validationResult } from "express-validator";\nexport const login = (req, res) => {\n    // Realizamos/Ejecutamos las validaciones de express-validator \n    //validationResult(req) -- en el req estan los datos que se van a validar\n    // Devuelve el error en caso que exista\n    const error = validationResult(req);\n\n    // Si existen errores\n    if (!error.isEmpty()) {\n        return res.status(400).json({ errors: error.array() })\n    }\n    console.log(req.body);\n    res.json({ ok: true })\n\n}\nexport const register = (req, res) => {\n     // Realizamos/Ejecutamos las validaciones de express-validator \n    //validationResult(req) -- en el req estan los datos que se van a validar\n    // Devuelve el error en caso que exista\n    const error = validationResult(req);\n\n    // Si existen errores\n    if (!error.isEmpty()) {\n        return res.status(400).json({ errors: error.array() })\n    }\n    console.log(req.body);\n    res.json({ ok: true })\n}\n\n')),(0,t.kt)("h2",{id:"middleware-personalizado-para-validar"},"Middleware Personalizado para validar"),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\xbfQue es un mi middleware?")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Es una funci\xf3n que contiene tres par\xe1metros : req (requirimiento) , res (respuesta) y next "),(0,t.kt)("li",{parentName:"ul"},"Un middleware intercepta la peticion antes que llegue al \u201cservidor\u201d ,  se ejecuta antes de la funcion que gestiona la petici\xf3n (dicha funci\xf3n se encuentra en la carpeta controllers)"),(0,t.kt)("li",{parentName:"ul"},"Entonces el middleware analiza la peticion y si esta todo bien, ejecuta el next().")))),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"next()")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"next() = Ejecuta el siguiente middleware (Puede haber varios middleware en un array) o ejecuta la funci\xf3n que gestiona la petici\xf3n (se encuentra en la carpeta controllers)"),(0,t.kt)("li",{parentName:"ul"},"El next ejecuta el siguiente middleware, si NO EXISTE, ejecuta la funci\xf3n que gestiona la petici\xf3n.")))),(0,t.kt)("p",null,"middlewares/validationResultExpress.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { validationResult } from "express-validator";\n\nexport const validationResult = (req , res , next) => {\n    // Realizamos/Ejecutamos las validaciones de express-validator \n    //validationResult(req) -- en el req estan los datos que se van a validar\n    // Devuelve el error en caso que exista\n    const error = validationResult(req);\n\n    // Si existen errores\n    if (!error.isEmpty()) {\n        return res.status(400).json({ errors: error.array() })\n    }\n\n    next();\n}\n\n')),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"\nexport const login = (req, res) => {\n    res.json({ ok: true })\n}\nexport const register = (req, res) => {\n    res.json({ ok: true })\n}\n\n")),(0,t.kt)("p",null,"auth.route.js "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import express from 'express';\nimport { login, register } from '../Controllers/auth.controllers.js';\n// importamos el body de express-validator que es un middleware\nimport {body} from 'express-validator';\nimport { validationResultExpress } from '../middlewares/validationResultExpress.js';\nconst router = express.Router();\n\n//post(\"ruta\" , [middlewares] , funcion que gestiona la solicitud)\n// Los middleware analizan la solicitud y si esta todo correcto , ejecuta la funcion que gestiona la solicitud.\n//body('nombrepropiedad' , 'mensaje de error').validaciones.validaciones.validaciones\n// cuando se reciba en el body la propiedad 'nombrepropiedad' , lo validara.\nrouter.post(\"/login\" , [body('email' , 'No es un email').trim().isEmail().normalizeEmail() , body('password' , 'formato de password incorrecta').trim().isLength({min:6}) , validationResultExpress ] , login)\n\n\nrouter.post(\"/register\" , [body('email' , 'No es un email').trim().isEmail().normalizeEmail() ,body('password' , 'formato de password incorrecta').trim().isLength({min:6}) ,  body('password' , 'No coinciden las contrase\xf1as').custom((value , {req}) => {\n   if (value !== req.body.repassword) {\n       // No se cumple la validacion\n       // Se lanza un error\n       throw new Error('No coinciden las contrase\xf1as');\n   }\n   // Se cumple la validacion \n   // Se retorna el valor\n   return value;\n}), validationResultExpress ] ,  register)\n\nexport default router;\n\n")),(0,t.kt)("h2",{id:"cifrar-contrase\xf1a--schemapre--save"},"Cifrar contrase\xf1a / Schema.pre / Save"),(0,t.kt)("h3",{id:"schema-pre"},"Schema pre"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"El pre sirve para ejecutar una funci\xf3n antes de una acci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"Por ejemplo: Ciframos la contrase\xf1a antes de guardarla en la BD."),(0,t.kt)("li",{parentName:"ul"},"Sintaxis: Esquema.pre(\u2018accion\u2019 , function )"),(0,t.kt)("li",{parentName:"ul"},"La function se ejecutar\xe1 antes de realizar la acci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"La funci\xf3n no debe ser una funci\xf3n flecha ya que utiliza el this para acceder al esquema."),(0,t.kt)("li",{parentName:"ul"},"La funci\xf3n tiene como par\xe1metro el next que cumple la misma funci\xf3n que el del middleware. (en este caso que ejecute la \u2018accion\u2019)")),(0,t.kt)("h3",{id:"bycriptjs"},"bycriptjs"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Encriptamos la contrase\xf1a a trav\xe9s de saltos"),(0,t.kt)("li",{parentName:"ul"},"Primero se encripta la contrase\xf1a y luego se realiza saltos."),(0,t.kt)("li",{parentName:"ul"},"saltos = palabras aleatorias que se van incorporando a la encriptaci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"Sirve para que dos contrase\xf1as iguales no tengan el mismo hash (contrase\xf1a encriptada)")),(0,t.kt)("p",null,"User.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import mongoose from 'mongoose'\nimport bcryptjs from 'bcryptjs';\n// Creamos el esquema (Lo instanciamos)\n// new Schema({los campos que va a tener el documento})\n\nconst userSchema = new mongoose.Schema({\n    // Cada campo contiene un objeto especificando el tipo de dato(type) , si es obligatorio(required) , etc\n    email: {\n        type: String,\n        required: true,\n        trim: true /* Limpia los caracteres en blanco */,\n        unique: true /* Valor unico */,\n        lowercase: true /* Los convierte en minuscula */,\n        index: { unique: true } /* Indexar */,\n    },\n    password: {\n        type: String,\n        required: true\n    }\n})\n\n// Antes de guardar en la bd , se ejecutara la function\nuserSchema.pre(\"save\", async function (next) {\n    // user = el esquema (en este caso es un objeto con dos propiedades (email,password))\n    const user = this;\n  // Si la contrase\xf1a no es modificada\n  // isModified('nombrecampo') = Devuelve true si el nombrecampo es modificado\n   if (!user.isModified('password')) {\n        return next();\n   }\n\n    try {\n        // Obtenemos los saltos\n        // genSalt(nro de salto)\n        const salt = await bcryptjs.genSalt(10);\n        // Encriptamos la contrase\xf1a\n        // hash(contrase\xf1a , numero de saltos)\n        // Devuelve el hash (contrase\xf1a encriptada)\n               const contrase\xf1aEncriptada = await bcryptjs.hash(user.password, salt);\n        // Le asignamos la contrase\xf1a encriptada al campo password\n        user.password = contrase\xf1aEncriptada;\n        next()\n    } catch (error) {\n        console.log(error);\n        throw new Error('Fallo el hash de contrase\xf1a');\n    }\n\n})\n\n// Creamos el modelo y lo exportamos\n// model('nombreModelo' , esquema )\n// el nombreModelo = nombre de la coleccion que va a contener esa estructura(esquema)\nexport const User = mongoose.model('User', userSchema);\n\n")),(0,t.kt)("h3",{id:"guardamos-los-usuarios-en-la-bd"},"Guardamos los usuarios en la BD."),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"La instancia del modelo (el que exportamos del User.js) contiene el m\xe9todo para crear documentos en la colecci\xf3n."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://mongoosejs.com/docs/queries.html"},"metodos del modelo"))),(0,t.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Algunos metodos (como el de crear/guardar)  lo contienen la instancia del modelo que creamos"),(0,t.kt)("li",{parentName:"ul"},"Para crear una instancia, se debe pasar un objeto con las mismas propiedades especificadas en el esquema que contiene el modelo.")))),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { User } from "../models/User.js"\n\nexport const login = (req, res) => {\n    res.json({ ok: true })\n}\nexport const register = async (req, res) => {\n try {\nconst {email , password}  = req.body;\n     // Creamos una instancia del modelo\n     // new nombreModelo({propiedades del documento})\n     // Las propiedades del documento debe coincidir con las propiedades que se especifico en el esquema que contiene el modelo.\n      const user = new User({email , password}) \n      // Guardamos en la base de datos\n      await user.save();\n      return res.json({ok : true});\n } catch(error) {\n    \n\n }\n\n\n    res.json({ ok: true })\n}\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"El modelo representa una colecci\xf3n . "),(0,t.kt)("li",{parentName:"ul"},"Entonces el nombre del modelo === el nombre de la colecci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"Cuando usamos el metodo save , se crea la colecci\xf3n (en caso de no existir) y el documento."),(0,t.kt)("li",{parentName:"ul"},"El documento que se guarda con el metodo save , contiene la informaci\xf3n que se especifico al momento de instanciar el modelo."),(0,t.kt)("li",{parentName:"ul"},"Entonces el objeto que se pasa al momento de instanciar el modelo es el documento a \u201ccrear\u201d"),(0,t.kt)("li",{parentName:"ul"},"Por lo tanto, la instancia contiene las propiedades del esquema y los m\xe9todos para manipular la colecci\xf3n.")))),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Explicacion somo si fuera SQL ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("pre",{parentName:"div"},(0,t.kt)("code",{parentName:"pre",className:"language-js"}," const user = new User({email , password}) \n // Guardamos en la base de datos\n  await user.save();\n\n")),(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"User es el nombre del modelo."),(0,t.kt)("li",{parentName:"ul"},"user.save() = INSERT INTO User (email, password) VALUES (email , password)"),(0,t.kt)("li",{parentName:"ul"},"VALUES(email , password )  = Los valores de email y password  corresponden a los valores de las propiedades email y password  del objeto que se pasa en la instancia de la primera l\xednea (new User).")))),(0,t.kt)("h2",{id:"validaciones--findone"},"Validaciones // findOne()"),(0,t.kt)("h3",{id:"validaciones"},"Validaciones"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Usamos los c\xf3digos de errores de la BD para validar que el correo sea \xfanico.")),(0,t.kt)("h3",{id:"findone"},"findOne()"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Usamos el m\xe9todo findOne  para buscar un documento en la colecci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"Recibe un objeto con la propiedad y valor que est\xe1n buscando:")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Ejemplo como si fuera relacional")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"modelo.findOne({apellido: \u201cperez\u201d);"),(0,t.kt)("li",{parentName:"ul"},"SQL : select * from modelo WHERE apellido = \u201cperez\u201d")))),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"el metodo findOne lo contiene el modelo , NO LA INSTANCIA."),(0,t.kt)("li",{parentName:"ul"},"Devuelve una instancia del modelo con el documento seleccionado.")),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { User } from "../models/User.js"\n\n')),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const register = async (req, res) => {\n    try {\n        const { email, password } = req.body;\n        // lo buscamos en la BD\n        // WHERE email = valorPropiedadEmail\n        let user = await User.findOne({ email: email});\n        // Si existe el usuario\n        if (user) {\n            // Enviamos un objeto como error\n               throw ({code : 11000})\n        }\n         \n        user = new User({ email, password })\n\n        // Guardamos en la base de datos\n        await user.save();\n        return res.status(201).json({ ok: true });\n    } catch (error) {\n        console.log(error.code);\n        // Codigo 11000 = Se duplica la key (el valor no es unico)\n        if (error.code === 11000) {\n            return res.status(400).json({ error: "Ya existe este usuario" });\n        }\n       return res.status(500).json({error : "Error de servidor"})\n    }\n\n\n}\n\n')),(0,t.kt)("h2",{id:"logina\xf1adirle-m\xe9todos-al-esquema"},"Login/A\xf1adirle m\xe9todos al esquema"),(0,t.kt)("h3",{id:"a\xf1adirle-metodos-al-esquema"},"A\xf1adirle metodos al esquema"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"El metodo a\xf1adido lo va a contener las instancias del modelo "),(0,t.kt)("li",{parentName:"ul"},"Sintaxis: NombreEsquema.methods.nombreMetodo = funci\xf3n"),(0,t.kt)("li",{parentName:"ul"},"La funci\xf3n no debe ser de tipo flecha ya que necesitamos tener acceso al this para acceder a las propiedades del esquema.")),(0,t.kt)("p",null,"User.js "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"// Esquema.methods.nombreMetodo = funcion\nuserSchema.methods.comparePassword = async function(candidatePassword) {\n    // this.password = Accedemos a la contrase\xf1a cifrada guardada en la BD\n    //compare(contrase\xf1a sin cifrar , contrase\xf1a cifrada)\n    // compare() compara dos contrase\xf1as y devuelve true si coinciden\n    return await bcryptjs.compare(candidatePassword , this.password)\n}\n\nexport const User = mongoose.model('User', userSchema);\n\n")),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { User } from "../models/User.js"\n\nexport const login = async (req, res) => {\n    try {\n        const { email, password } = req.body;\n        // lo buscamos en la BD\n        // WHERE email = valorPropiedadEmail\n        let user = await User.findOne({ email: email });\n        // Si NO existe el usuario\n        if (!user) {\n            return res.status(403).json({ error: "No existe el usuario" })\n        }\n\n        const respuestaPassword = await user.comparePassword(password);\n        // Si no coinciden las contrase\xf1as\n        if (!respuestaPassword) {\n            return res.status(403).json({ error: "Contrase\xf1a incorrecta" })\n        }\n        return res.json({ ok: true })\n    } catch (error) {\n        console.log(error);\n\n        return res.status(500).json({ error: "Error de servidor" })\n    }\n\n}\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Si el m\xe9todo findOne encuentra el documento , nos devuelve una instancia del Modelo que contiene el documento seleccionado."),(0,t.kt)("li",{parentName:"ul"},"Entonces cuando invocamos el m\xe9todo que creamos anteriormente con la instancia, el this.password === la propiedad password del documento.")))),(0,t.kt)("h2",{id:"jwt"},"JWT"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"EL Token es un \u201cc\xf3digo\u201d de acceso que le damos al Usuario."),(0,t.kt)("li",{parentName:"ul"},"A trav\xe9s del token, verificamos que el usuario tenga acceso al recurso que solicito."),(0,t.kt)("li",{parentName:"ul"},"Es el desarollador frontend el que se tiene que encargar de enviar el token al servidor(backend)."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://jwt.io/"},"jwt"))),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Partes del token ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Header : Contiene el algoritmo "),(0,t.kt)("li",{parentName:"ul"},"PayLoad: Contiene la data"),(0,t.kt)("li",{parentName:"ul"},"Verify Signature : Contiene el secreto  , se gestiona por el backend.")))),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"encoded ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Contiene un ejemplo del token "),(0,t.kt)("li",{parentName:"ul"},"Contiene las tres partes(se distingue por los colores)")))),(0,t.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"En el Payload no debe haber informaci\xf3n delicada. (contrase\xf1as , etc)"))),(0,t.kt)("h2",{id:"generar-token-en-el-loginregister"},"Generar Token en el Login/Register"),(0,t.kt)("h3",{id:"metodo-sign"},"Metodo sign()"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"sign({payload} , \u2018secreto\u2019);\n")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"El m\xe9todo sign como primer par\xe1metro recibe el payload (es un objeto con informacion)"),(0,t.kt)("li",{parentName:"ul"},"El segundo par\xe1metro  contiene el secreto (verify signature)")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Recordatorio ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"En el proyecto el JWT_SECRET esta en el .env (Es un String con palabras alazar)")))),(0,t.kt)("p",null,"auth.Controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { User } from "../models/User.js"\nimport jwt from \'jsonwebtoken\';\nexport const login = async (req, res) => {\n    try {\n        const { email, password } = req.body;\n\n        let user = await User.findOne({ email: email });\n        if (!user) {\n            return res.status(403).json({ error: "No existe el usuario" })\n        }\n\n        const respuestaPassword = await user.comparePassword(password);\n        if (!respuestaPassword) {\n            return res.status(403).json({ error: "Contrase\xf1a incorrecta" })\n        }\n        // Generamos el token JWT\n        // sign() crea el token \n        //sign({objeto con la informacion del payload} , \'String secreto\')\n\n        // para mongosee _id === id\n        const token = jwt.sign({ uid: user.id }, process.env.JWT_SECRET)\n        return res.json({ token })\n    } catch (error) {\n        console.log(error);\n\n        return res.status(500).json({ error: "Error de servidor" })\n    }\n\n}\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Pasos a seguir ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ol",{parentName:"div"},(0,t.kt)("li",{parentName:"ol"},"iniciamos sesion  Y obtenemos un token."),(0,t.kt)("li",{parentName:"ol"},"Lo pegamos en la pagina de JWT (en donde esta el ejemplo)")),(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Ya podemos tenemos acceso al payload"),(0,t.kt)("li",{parentName:"ul"},"El payload es publico"),(0,t.kt)("li",{parentName:"ul"},"Mientras mas informaci\xf3n tenga el payload , mas extenso es el token.")))),(0,t.kt)("h2",{id:"refresh-token"},"Refresh Token"),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\xbfEl navegador donde guarda el token? ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Como el token se pierde al refrescar la pagina se suele guardar en:"),(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Cookies"),(0,t.kt)("li",{parentName:"ul"},"LocalStorage")))),(0,t.kt)("h3",{id:"refresh-token-1"},"Refresh Token"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"En este proyecto no lo vamos a guardar en ninguna de las dos opciones")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Hay cookies especiales que solo son accedidas y insertadas desde el lado del servidor.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"En esas cookies especiales vamos a guardar un Refresh token.")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Cuando el usuario refresca el navegador, vamos a utilizar el refresh  token para recibir el token nuevamente."))),(0,t.kt)("h2",{id:"jwt-v2"},"JWT V2"),(0,t.kt)("p",null,"en .env debe haber cuatros variables"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"JWT_SECRET  = el secreto (Debe ser un String , puede ser una palabra aleatoria)\nJWT_REFRESH = Debe ser un String , puede ser una palabra aleatoria\nMODO=developer\nURI_MONGO=XXX\n")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Token Expiration ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Para que un token expire luego de un determinado tiempo usamos expiresIn"),(0,t.kt)("li",{parentName:"ul"},"expiresIn es una propiedad de un objeto cuyo valor es la cantidad de tiempo (en segundos) que va a estar activo el token. "),(0,t.kt)("li",{parentName:"ul"},"El objeto  se pasa como tercer par\xe1metro al m\xe9todo sign")))),(0,t.kt)("p",null,"utils/tokenManager.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import jwt from 'jsonwebtoken';\nexport const generateToken = (uid) => {\n    try {\n   // 15 Minutos en segundos\n    const expiresIn = 60 * 15;\n\n        // Generamos el token JWT\n        // sign() crea el token \n        //sign({objeto con la informacion del payload} , 'String secreto' , {expiresIn: cantTiempo en segundos})\n        // expiresIn = Para especificar  cuando va a expirar el token\n        const token = jwt.sign({ uid }, process.env.JWT_SECRET , {expiresIn})\n        return {token , expiresIn};\n    } catch (error) {\n        console.log(error);\n    }\n}\n\n")),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { generateToken } from "../utils/tokenManager.js"; \n')),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const login = async (req, res) => {\n    try {\n        const { email, password } = req.body;\n\n        let user = await User.findOne({ email: email });\n        if (!user) {\n            return res.status(403).json({ error: "No existe el usuario" })\n        }\n\n        const respuestaPassword = await user.comparePassword(password);\n        if (!respuestaPassword) {\n            return res.status(403).json({ error: "Contrase\xf1a incorrecta" })\n        }\n\n        const {token , expiresIn} = generateToken(user.id);\n        return res.json({ token , expiresIn })\n    } catch (error) {\n        console.log(error);\n\n        return res.status(500).json({ error: "Error de servidor" })\n    }\n\n}\n\n')),(0,t.kt)("h3",{id:"generamos-el-token-en-el-register"},"Generamos el token en el register"),(0,t.kt)("p",null,"auth.controllers.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const register = async (req, res) => {\n    try {\n        const { email, password } = req.body;\n        // lo buscamos en la BD\n        // WHERE email = valorPropiedadEmail\n        let user = await User.findOne({ email: email });\n        // Si existe el usuario\n        if (user) {\n            // Enviamos un objeto como error\n            throw ({ code: 11000 })\n        }\n\n        user = new User({ email, password })\n\n        // Guardamos en la base de datos\n        await user.save();\n        const { token, expiresIn } = generateToken(user.id);\n        return res.status(201).json({ token , expiresIn });\n    } catch (error) {\n        console.log(error.code);\n        // Codigo 11000 = Se duplica la key (el valor no es unico)\n        if (error.code === 11000) {\n            return res.status(400).json({ error: "Ya existe este usuario" });\n        }\n        return res.status(500).json({ error: "Error de servidor" })\n    }\n\n\n}\n\n')),(0,t.kt)("h2",{id:"ruta-protegida"},"Ruta protegida"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Creamos la \u201cruta protegida\u201d")),(0,t.kt)("p",null,"auth.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'router.get("/protected" , infoUser);\nexport default router;\n\n')),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const infoUser = (req, res) => {\n    res.json({user: "correo@hotmail.com"});\n}\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Ruta protegida ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"http://localhost:5000/api/protected"))),(0,t.kt)("h3",{id:"postman-1"},"Postman"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"La informaci\xf3n puede viajar por el body y por el header"),(0,t.kt)("li",{parentName:"ul"},"En authorization hay muchos formatos(Type) Ej. API Key , Oauth 1.0 , etc"),(0,t.kt)("li",{parentName:"ul"},"El que mas se usa es el Bearer Token."),(0,t.kt)("li",{parentName:"ul"},"Bearer Token: Env\xeda informaci\xf3n(token) a la cabecera(header)")),(0,t.kt)("h3",{id:"middleware"},"Middleware"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Vamos a crear un middleware para preguntar sobre el token."),(0,t.kt)("li",{parentName:"ul"},"Si el token es v\xe1lido, le damos acceso a la informaci\xf3n de la ruta protected.")),(0,t.kt)("p",null,"auth.route.js"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Implementamos el middleware")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'router.get("/protected" , requireToken ,  infoUser);\n')),(0,t.kt)("p",null,"middlewares/RequireToken.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import jwt from 'jsonwebtoken';\nexport const requireToken = (req , res , next) => {\n    try {\n        // Accedemos al token que se envio a traves de header\n        const token = req.headers?.authorization;\n        // Si no existe el token\n        if (!token) {\n            throw new Error('No existe el token');\n        }\n        next();\n    } catch (error) {\n        console.log(error);\n        return res.status(401).json({error: error.message});\n    }\n}\n\n")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"con req.headers  tenemos acceso a los headers ")))),(0,t.kt)("h3",{id:"verify"},"verify()"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Sirve para comprobar que el token sea valido."),(0,t.kt)("li",{parentName:"ul"},"Tiene dos par\xe1metros:")),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"El token"),(0,t.kt)("li",{parentName:"ol"},"La palabra secreta/secret")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Devuelve la informaci\xf3n decodificada (el payload). "),(0,t.kt)("li",{parentName:"ul"},"Si el token no es v\xe1lido, lanza un error y se va al catch.")),(0,t.kt)("p",null,"RequireToken.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import jwt from 'jsonwebtoken';\nexport const requireToken = (req , res , next) => {\n    try {\n        // Accedemos al token que se envio a traves de header\n        const token = req.headers?.authorization;\n        // Si no existe el token\n        if (!token) {\n            throw new Error('No existe el token');\n        }\n        const payload = jwt.verify(token , process.env.JWT_SECRET);\n        console.log(payload);\n        next();\n    } catch (error) {\n        console.log(error);\n        return res.status(401).json({error: error.message});\n    }\n}\n\n")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Prueba ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Prueben enviando en\u2013 authorization -- Bearer Token , el token."))),(0,t.kt)("h3",{id:"quitarle-el-formato-bearer"},"Quitarle el formato bearer"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"En el ejemplo anterior, ning\xfan token es v\xe1lido."),(0,t.kt)("li",{parentName:"ul"},"Esto pasa porque la const token contiene el formato bearer."),(0,t.kt)("li",{parentName:"ul"},"Como la const token no tiene el formato de un token, no es v\xe1lido."),(0,t.kt)("li",{parentName:"ul"},"Para solucionar esto, hay que conseguir el valor del token espec\xedficamente.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"\n try {\n        // Accedemos al token que se envio a traves de header\n        let token = req.headers?.authorization;\n        // Si no existe el token\n        if (!token) {\n            throw new Error('No existe el token');\n        }\n        // Conseguimos el token\n        token = token.split(\" \")[1];\n        const payload = jwt.verify(token , process.env.JWT_SECRET);\n        console.log(payload);\n        next();\n    } catch (error) {\n        console.log(error);\n        return res.status(401).json({error: error.message});\n    }\n\n")),(0,t.kt)("h2",{id:"ruta-protegida--2---a\xf1adir-una-propiedad-al-objeto-req--findbyid"},"Ruta protegida  #2  / A\xf1adir una propiedad al objeto req / findById()"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Sacamos informaci\xf3n del payload para pasarla a la ruta protegida.")),(0,t.kt)("p",null,"RequireToken.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import jwt from 'jsonwebtoken';\nexport const requireToken = (req, res, next) => {\n    try {\n        // Accedemos al token que se envio a traves de header\n        let token = req.headers?.authorization;\n        // Si no existe el token\n        if (!token) {\n            throw new Error('No existe el token');\n        }\n        // Conseguimos el token\n        token = token.split(\" \")[1];\n        const { uid } = jwt.verify(token, process.env.JWT_SECRET);\n        // Le a\xf1adimos una propiedad al req\n        req.uid = uid;\n        //El mismo objeto req se le pasa al siguiente middleware o funcion que gestione la solicitud\n        next();\n    } catch (error) {\n        console.log(error);\n        return res.status(401).json({ error: error.message });\n    }\n}\n\n")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Le a\xf1adimos la uid(id) del usuario al requerimiento(req) desde el middleware para que luego la funci\xf3n que gestione la solicitud HTTP tenga acceso a la id del usuario."))),(0,t.kt)("h2",{id:"findbyid"},"findById()"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Lo contiene el modelo, no la instancia"),(0,t.kt)("li",{parentName:"ul"},"Utilizamos el m\xe9todo findById () para buscar un documento por la id. (Parecido a findOne)"),(0,t.kt)("li",{parentName:"ul"},"Recibe la id a buscar"),(0,t.kt)("li",{parentName:"ul"},"Nos devuelve una instancia del modelo que contiene el documento seleccionado."),(0,t.kt)("li",{parentName:"ul"},"Ej. Ej. User.findById(123) = Select * from User WHERE id = 123;")),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const infoUser = async (req, res) => {\n    try {\n        // Buscamos un documento por la id \n//findById(id);\n\n        const user = await User.findById(req.uid);\n        return res.json({user});\n    } catch (error) {\n        return res.status(500).json({error: "error de server"})\n    }\n}\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Accedemos al requirimiento uid que agrego el middleware."))),(0,t.kt)("h2",{id:"validaciones-del-token"},"Validaciones del token"),(0,t.kt)("h3",{id:"1-forma"},"1 Forma"),(0,t.kt)("p",null,"tokenManager.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const errorsValidateToken = error => {\n    switch (error) {\n        case \'invalid signature\':\n            return "firma no v\xe1lida";\n        case \'jwt expired\':\n            return "token expirado";\n        case \'invalid token\':\n            return "No invente token";\n        default:\n            return "Token no valido";\n    }\n}\n\n')),(0,t.kt)("p",null,"RequireToken.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import { errorsValidateToken } from '../utils/tokenManager.js';\n\n\n\ncatch (error) {\n      \n        return res.status(401).json({ error: errorsValidateToken(error.message) });\n    }\n\n")),(0,t.kt)("h3",{id:"2-forma"},"2 Forma"),(0,t.kt)("p",null,"RequireToken.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'catch (error) {\n        console.log(error.message);\n       const TokenVerificationError = {\n           ["jwt expired"] : "JWT expirado" ,\n           ["invalid token"] : "Token no valido",\n           ["jwt expired"] : "Token expirado",\n           ["invalid signature"] : "Firma no valida",\n           ["jwt malformed"] : "Token no valido" ,\n           ["No existe el token"] : "No existe el token" ,\n       }\n        return res.status(401).json({ \n            error: TokenVerificationError[error.message] });\n    }\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Le podes quitar los corchetes que funciona igual."))),(0,t.kt)("h2",{id:"modificamos-la-informaci\xf3n-que-nos-devuelve-la-ruta-protegida-y-usamos-el-lean"},"Modificamos la informaci\xf3n que nos devuelve la ruta protegida y usamos el Lean"),(0,t.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"No mostrar la contrase\xf1a"))),(0,t.kt)("h3",{id:"lean"},"lean()"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Al realizar una b\xfasqueda con findById (Lo mismo pasa con findOne) nos devuelve una instancia del modelo que contiene varios m\xe9todos para manipular el documento seleccionado."),(0,t.kt)("li",{parentName:"ul"},"Con lean() le quitamos todos los  m\xe9todos que corresponden a la instancia del modelo , permitiendo que la consulta sea mas r\xe1pido."),(0,t.kt)("li",{parentName:"ul"},"Ej. con lean() , no contiene el metodo save()")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const infoUser = async (req, res) => {\n    try {\n        // Buscamos un documento por la id \n        //findById(id);\n        const user = await User.findById(req.uid).lean();\n        return res.json({email: user.email , uid:user.id});\n    } catch (error) {\n        return res.status(500).json({error: "error de server"})\n    }\n}\n\n')),(0,t.kt)("h2",{id:"simple-html"},"Simple HTML"),(0,t.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Es un ejemplo , luego se elimina del proyecto ya que una API REST no trabaja con el frontend.")))),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"En la carpeta public van los archivos est\xe1ticos (HTML , CSS , JS , im\xe1genes , etc)"),(0,t.kt)("li",{parentName:"ul"},"Todo el contenido que puede ser accedido desde el navegador va en la carpeta public"),(0,t.kt)("li",{parentName:"ul"},"Trabajar en la carpeta public es trabajar en el frontend."),(0,t.kt)("li",{parentName:"ul"},"Todo en esta carpeta lo interpreta y ejecuta el navegador."),(0,t.kt)("li",{parentName:"ul"},"Todas las dem\xe1s carpetas es el backend (se ejecuta en el servidor/maquina)")),(0,t.kt)("h4",{id:"habilitamos-la-carpeta-public--con-el-middleware"},"Habilitamos la carpeta public  con el middleware:"),(0,t.kt)("p",null,"index.js "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"const app = express();\napp.use(express.json());\napp.use('/api' , authRouter)\n//Temporal\napp.use(express.static(\"public\"))\n")),(0,t.kt)("h2",{id:"solicitudes-con-fetch"},"Solicitudes con fetch"),(0,t.kt)("h3",{id:"metodo-fetch"},"Metodo fetch"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Utilizamos el fetch para realizar una solicitud HTTP."),(0,t.kt)("li",{parentName:"ul"},"Por defecto hace una solicitud en GET")),(0,t.kt)("h3",{id:"fetchurl--configuraciones"},"fetch(url , {configuraciones})"),(0,t.kt)("p",null,"Parametros:"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"}," Una url, donde se va a hacer la solicitud"),(0,t.kt)("li",{parentName:"ol"}," un objeto con configuraciones")),(0,t.kt)("h3",{id:"configuraciones-del-fetch--propiedad-y-valor"},"Configuraciones del fetch  (Propiedad y valor)"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"method : POST/GET/DELETE/ETC"),(0,t.kt)("li",{parentName:"ul"},"headers: {         el tipo de informaci\xf3n que acepta el servidor , datos que se envia por el header     }"),(0,t.kt)("li",{parentName:"ul"},"body: La informacion que se envia"),(0,t.kt)("li",{parentName:"ul"},"credentials : 'valor'   =  Depende del valor, incluye las cookies del navegador en la solicitud.")),(0,t.kt)("p",null,"index.html "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="es">\n    <head>\n        <meta charset="UTF-8" />\n        <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n        <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n        <title>Login</title>\n    </head>\n    <body>\n        <form id="formLogin">\n            <input type="email" value="correo5@hotmail.com" id="email" />\n            <input type="password" value="123456" id="password" />\n            <button type="submit">Acceder</button>\n        </form>\n\n        <script>\n            const formLogin = document.querySelector("#formLogin");\n            const email = document.querySelector("#email");\n            const password = document.querySelector("#password");\n\n            formLogin.addEventListener("submit", async (e) => {\n                e.preventDefault();\n                try {\n                    const res = await fetch("/api/login", {\n                        method: "post",\n                        headers: {\n                            "Content-Type": "application/json",\n                        },\n                        body: JSON.stringify({\n                            email: email.value,\n                            password: password.value,\n                        }),\n                    });\n\n                    console.log(res.ok, res.status);\n                    const { token } = await res.json();\n                    console.log(token);\n                    // Redirreciono a otro sitio\n                    window.location.href = "/protected.html";\n                } catch (error) {\n                    console.log(error);\n                }\n            });\n        <\/script>\n    </body>\n</html>\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Si en el navegador, ingresamos a http://localhost:5000/ , se ejecutar\xeda el index.html (lo ejecuta el navegador)")))),(0,t.kt)("p",null,"protected.html "),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},'Seria la "ruta protegida"')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Configuracion del Header -- Authorization ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("pre",{parentName:"div"},(0,t.kt)("code",{parentName:"pre",className:"language-js"},' headers: {\n                            Authorization: "Bearer " + token,\n                        }\n\n')),(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Sirve para Para enviar el token por el header como estuvimos haciendo, respetando el formato Bearer.")))),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n    <head>\n        <meta charset="UTF-8" />\n        <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n        <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n        <title>Ruta protegida</title>\n    </head>\n    <body>\n        <h1>Ruta protegida</h1>\n        <div id="app">\n            <h2>Email</h2>\n            <h3>UID</h3>\n        </div>\n        <button id="logout">Logout</button>\n\n        <script>\n            const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiI2Mjg2M2NiYzU4ZjQ1MmRkZGIxYjI3M2UiLCJpYXQiOjE2NTM0MTcyNzcsImV4cCI6MTY1MzQxODE3N30.MkwHDyGsMzJ2NtIHTVBh9ibKQjGZLffxhtnsHp72jEI"\n            // Cuando se cargue el DOM\n            document.addEventListener("DOMContentLoaded", async (e) => {\n                const app = document.querySelector("#app");\n                try {\n                    const resToken = await fetch("/api/protected", {\n                        headers: {\n                            Authorization: "Bearer " + token,\n                            "Content-Type": "application/json",\n                        },\n                    });\n                    const data = await resToken.json();\n                    app.innerHTML = `\n                        <h2>Email: ${data.email}</h2>\n                    `;\n                    console.log(data);\n                } catch (error) {\n                    console.log(error);\n                }\n\n           \n            });\n        <\/script>\n    </body>\n</html>\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Si en el navegador, ingresamos a http://localhost:5000/protected.html , se ejecutar\xeda el protected.html (lo ejecuta el navegador).")))),(0,t.kt)("h2",{id:"formas-de-guardar-el-token"},"Formas de guardar el token"),(0,t.kt)("h3",{id:"localstorage"},"localStorage"),(0,t.kt)("p",null,"index.html "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'console.log(res.ok, res.status);\n                    const { token } = await res.json();\n                    console.log(token);\n                    // Guardamos en el localStorage;\n                    localStorage.setItem("token" , token);\n                    // Redirreciono a otro sitio\n                     window.location.href = "/protected.html";\n\n')),(0,t.kt)("p",null,"protected.html"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'  <script>\n            // Obtenemos el valor del localStorage\n            const token =  localStorage.getItem("token");\n\n')),(0,t.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Desventajas")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Menos seguridad: Se puede acceder desde el navegador."))),(0,t.kt)("h3",{id:"cookies-sin-configuraciones"},"Cookies (Sin configuraciones)"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Las cookies es  como el localStorage , se guarda con nombre -> valor")),(0,t.kt)("h3",{id:"metodo-cookie"},"metodo cookie()"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Sirve para crear una cookie"),(0,t.kt)("li",{parentName:"ul"},"Tiene tres parametros")),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"nombre de la cookie"),(0,t.kt)("li",{parentName:"ol"},"valor de la cookie"),(0,t.kt)("li",{parentName:"ol"},"un objeto con las configuraciones (opcional)")),(0,t.kt)("p",null,"index.js"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Habilitamos el m\xf3dulo de cookieParser para trabajar con cookies.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"\nimport express from 'express';\n// Habilitamos las variables de entorno\nimport 'dotenv/config';\nimport './database/connectDB.js'\nimport cookieParser from 'cookie-parser';\nimport authRouter from './routes/auth.route.js';\n\nconst app = express();\napp.use(express.json());\n// Habilitamos las cookies para poder usarlas\napp.use(cookieParser());\napp.use('/api' , authRouter)\n\n")),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const login = async (req, res) => {\n    try {\n        const { email, password } = req.body;\n\n        let user = await User.findOne({ email: email });\n        if (!user) {\n            return res.status(403).json({ error: "No existe el usuario" })\n        }\n\n        const respuestaPassword = await user.comparePassword(password);\n        if (!respuestaPassword) {\n            return res.status(403).json({ error: "Contrase\xf1a incorrecta" })\n        }\n\n        const {token , expiresIn} = generateToken(user.id);\n        // Guardamos una cookie  \n        //cookie(nombre , valor , {configuraciones})\n        res.cookie("token" , token)\n        return res.json({ token , expiresIn })\n    } catch (error) {\n        console.log(error);\n\n        return res.status(500).json({ error: "Error de servidor" })\n    }\n\n}\n\n')),(0,t.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Desventajas")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Menos seguridad: Se puede acceder desde el navegador."))),(0,t.kt)("h3",{id:"cookies-con-configuraciones"},"Cookies (Con configuraciones)"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Tiene mas seguridad que la anterior ")),(0,t.kt)("h4",{id:"configuracion-3-parametro-del-metodo-cookie"},"Configuracion (3 parametro del metodo cookie)"),(0,t.kt)("h5",{id:"httponly--boolean"},"httpOnly : boolean"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"true = Solo va a vivir en el HTTP, no se puede acceder desde el frontend.")),(0,t.kt)("h5",{id:"secure--boolean"},"secure : boolean"),(0,t.kt)("p",null,"true = Va a vivir en https   false = Va a vivir en http "),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'       res.cookie("token" , token , {\n            httpOnly:true,\n            \n            secure: !(process.env.MODO === "developer")\n        })\n\n')),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Es mas seguro que localStorage y las cookies sin configuraci\xf3n.")),(0,t.kt)("h3",{id:"obtener-el-valor-de-la-cookie"},"Obtener el valor de la cookie"),(0,t.kt)("p",null,"RequireToken.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const requireToken = (req, res, next) => {\n    try {\n        // Accedemos al token que se envio a traves de las cookies\n// Obtenemos el valor de una cookie\n// req.cookies.nombrecookie    \n        let token = req.cookies?.token;\n        // Si no existe el token\n        if (!token) {\n            throw new Error(\'No existe el token\');\n        }\n        const { uid } = jwt.verify(token, process.env.JWT_SECRET);\n        // Le a\xf1adimos una propiedad al req\n        req.uid = uid;\n        //El mismo objeto req se le pasa al siguiente middleware o funcion que gestione la solicitud\n        next();\n    } catch (error) {\n        console.log(error.message);\n       const TokenVerificationError = {\n           ["jwt expired"] : "JWT expirado" ,\n           ["invalid token"] : "Token no valido",\n           ["jwt expired"] : "Token expirado",\n           ["invalid signature"] : "Firma no valida",\n           ["jwt malformed"] : "Token no valido" ,\n           ["No existe el token"] : "No existe el token" ,\n       }\n        return res.status(401).json({ \n            error: TokenVerificationError[error.message] });\n    }\n}\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Con req.cookies tenemos acceso a las cookies"))),(0,t.kt)("p",null,"protected.html "),(0,t.kt)("h3",{id:"credentials"},"credentials"),(0,t.kt)("p",null,"credentials :  \u2018include\u2019 =  cada solicitud debe tener una credencial (debe tener cookies) , sirve para enviar las cookies en la petici\xf3n HTTP , estamos incluyendo las cookies que se encuentran en el navegador en la solicitud (petici\xf3n HTTP)."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'     const resToken = await fetch("/api/protected", {\n                        headers: {\n                            "Content-Type": "application/json",\n                        },\n                        credentials: \'include\'\n                    });\n\n')),(0,t.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Desventajas")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Se puede acceder a la informaci\xf3n  , si una pagina sospecha hace alguna solicitud que \u201cincluya cookie\u201d"))),(0,t.kt)("h2",{id:"refresh-token-2"},"Refresh Token"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Es un token, que refrescara(actualizara) el \u201ctoken verdadero\u201d."),(0,t.kt)("li",{parentName:"ul"},"el Refresh token se guarda en la cookie ya que da lo mismo si lo roban, total no es el \u201ctoken verdadero\u201d.")),(0,t.kt)("p",null,"tokenManager.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const generateRefreshToken = (uid , res) => {\n    // 30 dias  en segundos\n    const expiresIn = 60 * 60 * 24 * 30;\n    try {\n        const refreshToken = jwt.sign({ uid }, process.env.JWT_REFRESH, {expiresIn});\n        res.cookie("refreshToken", refreshToken, {\n            httpOnly: true,\n            secure: !(process.env.MODO === "developer"),\n            // La expiracion de la cookie : recibe el tiempo en milisegundos\n            expires: new Date(Date.now() + expiresIn * 1000)\n        })\n\n    } catch (error) {\n         console.log(error);\n    }\n}\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Usamos la variable de entorno JWT_REFRESH que es un String oculto (como el secreto)")))),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},'En el login , al momento de crear el "token verdadero" , tambien creamos el refesh token')),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { generateRefreshToken, generateToken } from "../utils/tokenManager.js";\n\n const { token, expiresIn } = generateToken(user.id);\n        generateRefreshToken(user.id , res);\n\n')),(0,t.kt)("h3",{id:"acceder-al-token-verdadero-a-trav\xe9s-del-refresh-token"},"Acceder al \u201ctoken verdadero\u201d a trav\xe9s del Refresh Token."),(0,t.kt)("h4",{id:"explicacion"},"Explicacion"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Le enviamos una solicitud al servidor con el Refresh Token."),(0,t.kt)("li",{parentName:"ul"},"El servidor validara el token y si es v\xe1lido, devolver\xe1 el \u201ctoken verdadero\u201d."),(0,t.kt)("li",{parentName:"ul"},"el \u201ctoken verdadero\u201d solo vivir\xe1 en la memoria RAM del pc del cliente (es una constante)")),(0,t.kt)("p",null,"auth.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import { infoUser, login, refreshToken, register } from '../Controllers/auth.controllers.js';\n\nrouter.get(\"/refresh\" , refreshToken);\n\n")),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import jwt from \'jsonwebtoken\';\n\nexport const refreshToken = (req, res) => {\n    try {\n        const refreshTokenCookie = req.cookies.refreshToken;\n        // Si no existe el token\n        if (!refreshTokenCookie) {\n            throw new Error("No existe el token");\n        }\n        const { uid } = jwt.verify(refreshTokenCookie, process.env.JWT_REFRESH);\n        // Generamos el "token verdadero"\n        const { token, expiresIn } = generateToken(uid);\n        return res.json({ token, expiresIn })\n\n    } catch (error) {\n        console.log("error de refresh" , error.message , error);\n        const TokenVerificationError = {\n            ["jwt expired"]: "JWT expirado",\n            ["invalid token"]: "Token no valido",\n            ["jwt expired"]: "Token expirado",\n            ["invalid signature"]: "Firma no valida",\n            ["jwt malformed"]: "Token no valido",\n            ["No existe el token"]: "No existe el token",\n        }\n        return res.status(401).json({\n            error: TokenVerificationError[error.message]\n        });\n    }\n}\n\n')),(0,t.kt)("p",null,"RequireToken.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const requireToken = (req, res, next) => {\n    try {\n        // Accedemos al token que se envio a traves del header\n        let token = req.headers?.authorization;\n        \n        // Si no existe el token\n        if (!token) {\n            throw new Error('No existe el token');\n        }\n        token = token.split(\" \")[1];\n        const { uid } = jwt.verify(token, process.env.JWT_SECRET);\n\n")),(0,t.kt)("h3",{id:"ahora-accedemos-al-token-verdadero-desde-el-archivo-html"},"Ahora accedemos al \u201ctoken verdadero\u201d desde el archivo HTML"),(0,t.kt)("p",null,"protected.html"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-html"},'  <script>\n  \n        // Cuando se cargue el DOM\n        document.addEventListener("DOMContentLoaded", async (e) => {\n\n            const app = document.querySelector("#app");\n            try {\n                const resToken = await fetch("/api/refresh", {\n                    method: "GET",\n                    credentials: \'include\'\n\n                })\n                const {token} = await resToken.json();\n                const res = await fetch("/api/protected", {\n                    headers: {\n                        "Content-Type": "application/json",\n                        Authorization:"Bearer " + token\n                    },\n              \n                });\n                const data = await res.json();\n                app.innerHTML = `\n                        <h2>Email: ${data.email}</h2>\n                    `;\n                console.log(data);\n            } catch (error) {\n                console.log(error);\n            }\n\n        });\n    <\/script>\n\n')),(0,t.kt)("h4",{id:"explicacion-1"},"Explicacion"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Esto junto con la implementaci\xf3n de los CORS (m\xe1s adelante lo vemos) proporcionar\xeda mucha mas seguridad que los otros dos m\xe9todos (guardar en la cookie/Localstorage)"),(0,t.kt)("li",{parentName:"ul"},"El usuario malicioso podr\xe1 hacer solicitudes, pero no recibir\xe1 ninguna respuesta (LA API NO LE DEVOLVERA INFORMACION)"),(0,t.kt)("li",{parentName:"ul"},"Por lo tanto, el usuario malicioso nunca podr\xe1 acceder al token verdadero.")),(0,t.kt)("h2",{id:"logout"},"Logout"),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const logout = (req, res) => {\n    //Eliminamos una cookie \n    //clearCookie('nombrecookie')\n    res.clearCookie(\"refreshToken\");\n    res.json({ok:true})\n}\n\n")),(0,t.kt)("p",null,"auth.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import { infoUser, login, logout, refreshToken, register } from '../Controllers/auth.controllers.js';\n\n\nrouter.get(\"/logout\" , logout);\n\n")),(0,t.kt)("p",null,"protected.html"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-html"},'  <script>\n  \n        // Cuando se cargue el DOM\n        document.addEventListener("DOMContentLoaded", async (e) => {\n\n            const app = document.querySelector("#app");\n            try {\n                const resToken = await fetch("/api/refresh", {\n                    method: "GET",\n                    credentials: \'include\'\n\n                })\n                const {token} = await resToken.json();\n                const res = await fetch("/api/protected", {\n                    headers: {\n                        "Content-Type": "application/json",\n                        Authorization:"Bearer " + token\n                    },\n              \n                });\n                const data = await res.json();\n                app.innerHTML = `\n                        <h2>Email: ${data.email}</h2>\n                    `;\n                console.log(data);\n            } catch (error) {\n                console.log(error);\n            }\n\n            const logout = document.querySelector("#logout");\n                logout.addEventListener("click", async () => {\n                    const res = await fetch("/api/logout");\n                    console.log(res.ok, res.status);\n                    if (res.ok) {\n                        window.location.href = "/";\n                    }\n                });\n        });\n    <\/script>\n\n')),(0,t.kt)("h2",{id:"refactorizacion"},"Refactorizacion"),(0,t.kt)("h3",{id:"errores--al-verificar-el-token"},"Errores  al verificar el token"),(0,t.kt)("p",null,"tokenManager.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const tokenVerificationError = {\n    ["jwt expired"] : "JWT expirado" ,\n    ["invalid token"] : "Token no valido",\n    ["jwt expired"] : "Token expirado",\n    ["invalid signature"] : "Firma no valida",\n    ["jwt malformed"] : "Token no valido" ,\n    ["No existe el token"] : "No existe el token" ,\n}\n\n')),(0,t.kt)("p",null,"RequireToken.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"\nimport { tokenVerificationError } from '../utils/tokenManager.js';\n\n\ncatch (error) {\n        console.log(  error.message);\n     \n        return res.status(401).json({ \n            error: tokenVerificationError[error.message] });\n    }\n\n")),(0,t.kt)("h3",{id:"middleware-requirerefreshtoken"},"middleware requireRefreshToken"),(0,t.kt)("p",null,"middlewares/requireRefreshToken.js"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Crea un nuevo requirimiento(req).")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { tokenVerificationError } from "../utils/tokenManager.js";\nimport jwt from \'jsonwebtoken\';\nexport const requireRefreshToken = (req, res, next) => {\n    try {\n        const refreshTokenCookie = req.cookies.refreshToken;\n        // Si no existe el token\n        if (!refreshTokenCookie) {\n            throw new Error("No existe el token");\n        }\n        const { uid } = jwt.verify(refreshTokenCookie, process.env.JWT_REFRESH);\n        req.uid = uid;\n        next();\n    } catch (error) {\n        console.log(error.message, error);\n        return res.status(401).json({\n            error: tokenVerificationError[error.message]\n        });\n    }\n}\n\n')),(0,t.kt)("p",null,"auth.controller.js"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Accedemos al nuevo requirimiento (req).")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const refreshToken = (req, res) => {\n    try {\n        // Generamos el "token verdadero"\n        const { token, expiresIn } = generateToken(req.uid);\n        return res.json({ token, expiresIn })\n\n    } catch (error) {\n       console.log(error);\n       return res.status(500).json({ error: "error de server" })\n    }\n}\n\n')),(0,t.kt)("p",null,"auth.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import { requireRefreshToken } from '../middlewares/requirerefreshToken.js';\n\nrouter.get(\"/refresh\" , requireRefreshToken, refreshToken);\n\n")),(0,t.kt)("h3",{id:"separamos-el-middleware-de-express-validator-del-authroutejs"},"Separamos el middleware de express-validator del auth.route.js"),(0,t.kt)("p",null,"middleware/validatorManager.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import { validationResult } from \"express-validator\";\n// importamos el body de express-validator que es un middleware\nimport {body} from 'express-validator';\n\nexport const validationResultExpress = (req, res, next) => {\n    // Realizamos/Ejecutamos las validaciones de express-validator \n    //validationResult(req) -- en el req estan los datos que se van a validar\n    // Devuelve el error en caso que exista\n    const error = validationResult(req);\n\n    // Si existen errores\n    if (!error.isEmpty()) {\n        return res.status(400).json({ errors: error.array() })\n    }\n\n    next();\n}\n\nexport const bodyLoginValidator = [body('email', 'No es un email').trim().isEmail().normalizeEmail(), body('password', 'formato de password incorrecta').trim().isLength({ min: 6 }), validationResultExpress, validationResultExpress];\n\nexport const bodyRegisterValidator = [body('email', 'No es un email').trim().isEmail().normalizeEmail(), body('password', 'formato de password incorrecta').trim().isLength({ min: 6 }), body('password', 'No coinciden las contrase\xf1as').custom((value, { req }) => {\n    if (value !== req.body.repassword) {\n        // No se cumple la validacion\n        // Se lanza un error\n        throw new Error('No coinciden las contrase\xf1as');\n    }\n    // Se cumple la validacion \n    // Se retorna el valor\n    return value;\n}), validationResultExpress];\n\n")),(0,t.kt)("p",null,"auth.routes.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import express from \'express\';\nimport { infoUser, login, logout, refreshToken, register } from \'../Controllers/auth.controllers.js\';\nimport { requireToken } from \'../middlewares/RequireToken.js\';\nimport { requireRefreshToken } from \'../middlewares/requirerefreshToken.js\';\nimport { bodyLoginValidator, bodyRegisterValidator } from \'../middlewares/validatorManager.js\';\nconst router = express.Router();\n\n//post("ruta" , [middlewares] , funcion que gestiona la solicitud)\nrouter.post("/login", bodyLoginValidator, login)\nrouter.post("/register", bodyRegisterValidator, register)\nrouter.get("/protected", requireToken, infoUser);\nrouter.get("/refresh", requireRefreshToken, refreshToken);\nrouter.get("/logout", logout);\nexport default router;\n\n')),(0,t.kt)("h2",{id:"links-url---referencia-al-usuario"},"Links (URL)  / Referencia al usuario"),(0,t.kt)("h3",{id:"modelo"},"Modelo"),(0,t.kt)("p",null,"model/Link.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import mongoose from "mongoose";\nconst { Schema } = mongoose;\n\nconst linkSchema = new Schema({\n    longLink: {\n        type: String,\n        required: true,\n        trim: true,\n    },\n    nanoLink: {\n        type: String,\n        unique: true,\n        required: true,\n        trim: true,\n    },\n    // Creamos una referencia a la id del usuario\n    uid: {\n        // Schema.Types.ObjectId  = Es  una ID de un documento de una coleccion.\n        type: Schema.Types.ObjectId,\n        // ref: nombre de la coleccion(nombre del modelo) al que hace referencia\n        ref: "User",\n        required: true,\n    },\n});\n\nexport const Link = mongoose.model("Link", linkSchema);\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Explicacion como si fuera relacional")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Se hace una referencia a la columna _id(type:Schema.Types.ObjectId) de la tabla User(ref:\u201dUser\u201d)."),(0,t.kt)("li",{parentName:"ul"},"_id lo genera mongoDB de manera autom\xe1tica.")))),(0,t.kt)("h3",{id:"router"},"Router"),(0,t.kt)("p",null,"index.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import express from 'express';\n// Habilitamos las variables de entorno\nimport 'dotenv/config';\nimport './database/connectDB.js'\nimport cookieParser from 'cookie-parser';\nimport authRouter from './routes/auth.route.js';\nimport authLink from './routes/link.route.js';\n\nconst app = express();\napp.use(express.json());\n// Habilitamos las cookies para poder usarlas\napp.use(cookieParser());\napp.use('/api' , authRouter)\napp.use('/api/links' , authLink)\n//Temporal\napp.use(express.static(\"public\"))\n// Si no existe, asigna el puerto 500\nconst PORT = process.env.PORT || 5000\napp.listen(PORT , () => console.log('http://localhost:'+PORT));\n\n")),(0,t.kt)("p",null,"routes/link.route.js"),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Diferencia entre el metodo put y patch")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Una petici\xf3n patch, modifica una parte del \u201ctodo\u201d Ej. Modifica una parte del documento de la colecci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"Una petici\xf3n put, modifica \u201ctodo\u201d. Ej. Modifica todo el documento de la colecci\xf3n.")))),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import {Router} from "express";\nimport { getLinks } from "../Controllers/link.controller.js";\nconst router = Router();\n\n// Rutas \n\n// PETICION GET A http://localhost:5000/api/links = Acceder a todos los links \n\n// PETICION GET A http://localhost:5000/api/links/:id = Acceder a un link\n\n// PETICION POST  A http://localhost:5000/api/links = Crea un link \n\n//PETICION PATCH/PUT A http://localhost:5000/api/links/:id = Actualiza un link\n\n//PETICION DELETE A http://localhost:5000/api/links/:id = Elimina un link\n\nrouter.get(\'/\' , getLinks);\n\n\n\nexport default router;\n\n')),(0,t.kt)("p",null,"controllers/link.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const getLinks = (req , res) => {\n    return res.json({ok : true});\n}\n\n")),(0,t.kt)("h2",{id:"leer--find"},"Leer / Find()"),(0,t.kt)("h3",{id:"find"},"Find()"),(0,t.kt)("h4",{id:"sin-parametros"},"Sin parametros"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Busca todos los documentos de la colecci\xf3n."),(0,t.kt)("li",{parentName:"ul"},"modelo.find()  = Select * from nombreModelo")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Recordatorio")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"El nombre del modelo  es el nombre de la colecci\xf3n.")))),(0,t.kt)("h4",{id:"con-un-par\xe1metro-objeto"},"Con un par\xe1metro (Objeto)"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Sirve para filtrar (Seria como implementar un WHERE)"),(0,t.kt)("li",{parentName:"ul"},"modelo.find({dato:valor}); = Select * from nombreModelo WHERE dato = valor;")),(0,t.kt)("p",null,"link.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import { requireToken } from \"../middlewares/RequireToken.js\";\n\nrouter.get('/' , requireToken , getLinks);\n\n")),(0,t.kt)("p",null,"link.controller.js"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Utilizamos el uid del requirimiento que lo inserta el middleware requireToken.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const getLinks = async (req , res) => {\n    try {\n        // select * from Link(nombre modelo) WHERE uid = req.uid\n     const links =    await Link.find({uid : req.uid});\n        return res.json({links});\n    } catch (error) {\n        console.log(error);\n        return res.status(500).json({error: 'Error de servidor'});\n    }\n    \n}\n")),(0,t.kt)("h2",{id:"crear"},"Crear"),(0,t.kt)("p",null,"link.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import { createLink, getLinks } from \"../Controllers/link.controller.js\";\nrouter.get('/' , requireToken , getLinks);\nrouter.post('/' , requireToken , createLink);\n\n")),(0,t.kt)("p",null,"link.controller.js"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Usamos el modulo nanoid para generar un String aleatorio.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-powershell"},"npm i nanoid\n")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Utilizamos el uid del requirimiento que lo inserta el middleware requireToken.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'\nimport { nanoid } from "nanoid";\nimport { Link } from "../models/Link.js";\n\nexport const createLink = async (req,res) => {\n    try {\n        const {longLink} = req.body;\n        //nanoid(longitud) = genera un string aleatorio\n        const link = new Link({longLink , nanoLink: nanoid(6) , uid: req.uid});\n        await link.save()\n        return res.json({link});\n    } catch (error) {\n        console.log(error);\n        return res.status(500).json({error: \'Error de servidor\'});\n    }\n}\n\n')),(0,t.kt)("h2",{id:"validar-url-longlink"},"Validar URL (longLink)"),(0,t.kt)("h3",{id:"express-validator"},"Express Validator"),(0,t.kt)("p",null,"validatorManager.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'export const bodyLinkValidator = [\n    body("longLink" , "Formato link incorrecto")\n    .trim()\n    .notEmpty() // No este vacio \n    ,validationResultExpress\n]\n\n')),(0,t.kt)("p",null,"link.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import { bodyLinkValidator } from \"../middlewares/validatorManager.js\";\n\nrouter.get('/' , requireToken , getLinks);\n// (ruta , middleware , middleware , funcion para gestionar la solicitud)\nrouter.post('/' , requireToken , bodyLinkValidator , createLink);\n\n")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Los middlewares est\xe1n en el segundo y tercer par\xe1metro del m\xe9todo POST."),(0,t.kt)("li",{parentName:"ul"},"Primero se ejecuta el del segundo par\xe1metro y luego el tercero\u2026")))),(0,t.kt)("h3",{id:"axios"},"Axios"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Vamos a utilizer el modulo de ",(0,t.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/axios"},"axios")," (cumple la misma funci\xf3n que fetch)")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-powershell"},"npm i axios\n")),(0,t.kt)("p",null,"validatorManager.js"),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Explicacion del codigo ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Se hace una petici\xf3n GET a la url que se pasa en el body de la petici\xf3n."),(0,t.kt)("li",{parentName:"ul"},"Si se obtiene una respuesta, la url es v\xe1lida."),(0,t.kt)("li",{parentName:"ul"},"Si no se obtiene una respuesta, pasa al catch (el axios genera un error)")))),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import axios from 'axios';\n\nexport const bodyLinkValidator = [\n    body(\"longLink\" , \"Formato link incorrecto\")\n    .trim()\n    .notEmpty() // No este vacio \n    // Funcion personalizada , value es el valor de la propiedad\n    .custom(async value => {\n\n\n\n\n        try {\n\n            //Si la url NO comienza con 'https://' \n           if (!value.startsWith('https://')) {\n               // Le a\xf1adimos el https:// al comienzo\n                   value = 'https://' + value;\n           }\n\n\n        // Hacemos una peticion a la url\n          // axios.X(url);\n          // X puede ser GET , POST , FETCH , PUT , ETC\n          // Peticion GET a la url \n          await axios.get(value);\n          return value;\n        } catch (error) {\n            throw new Error('No se encontro el link');\n        }\n       \n    })\n    ,validationResultExpress\n]\n\n")),(0,t.kt)("p",null,"link.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const createLink = async (req,res) => {\n    try {\n        let {longLink} = req.body;\n           //Si la url NO comienza con 'https://' \n        if (!longLink.startsWith('https://')) {\n            // Le a\xf1adimos el https:// al comienzo\n            longLink = 'https://' + longLink;\n        }\n\n\n        //nanoid(longitud) = genera un string aleatorio\n        const link = new Link({longLink , nanoLink: nanoid(6) , uid: req.uid});\n        await link.save()\n        return res.status(201).json({link});\n    } catch (error) {\n        console.log(error);\n        return res.status(500).json({error: 'Error de servidor'});\n    }\n}\n\n")),(0,t.kt)("h2",{id:"obtener-una-ruta"},"Obtener una ruta"),(0,t.kt)("h3",{id:"1-alternativa"},"1 Alternativa"),(0,t.kt)("p",null,"link.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { createLink, getLink, getLinks } from "../Controllers/link.controller.js";\nrouter.get("/:id" , requireToken , getLink);\n\n')),(0,t.kt)("p",null,"link.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const getLink = async (req, res) => {\n    try {\n        // Obtener el valor de la variable(params) de la url\n        const {id} = req.params;\n        // Buscamos por la id\n     const link =    await Link.findById(id);\n        return res.json({link});\n    } catch (error) {\n        console.log(error);\n        return res.status(500).json({error: 'Error de servidor'});\n    }\n}\n\n")),(0,t.kt)("p",null,"Le a\xf1adimos algunas validaciones: "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const getLink = async (req, res) => {\n   try {\n       // Obtener el valor de la variable(params) de la url\n       const { id } = req.params;\n       // Buscamos por la id\n       const link = await Link.findById(id);\n       // Si no existe una url\n       if (!link) {\n           return res.status(404).json({ error: ' No existe el link' });\n       }\n       // Si No corresponde a la id del usuario\n       if (!link.uid.equals(req.uid)) {\n           return res.status(401).json({ error: ' No le pertenece este link' });\n       }\n       return res.json({ link });\n   } catch (error) {\n       console.log(error);\n       if (error.kind == \"ObjectId\") {\n           return res.status(403).json({ error: 'Formato id incorrecto' });\n       }\n\n       return res.status(500).json({ error: 'Error de servidor' });\n   }\n}\n\n")),(0,t.kt)("h3",{id:"2-alternativa"},"2 Alternativa"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"En lugar de buscar por la id, buscamos por el nanoLink y solo devolvemos el longLink"),(0,t.kt)("li",{parentName:"ul"},"Le quitamos la validacion del usuario y la del token, ya que lo puede usar cualquiera.")),(0,t.kt)("p",null,"link.router.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'router.get("/:nanolink"  , getLink);\n')),(0,t.kt)("p",null,"link.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const getLink = async (req, res) => {\n    try {\n        // Obtener el valor de la variable(params) de la url\n        const { nanolink } = req.params;\n        // Buscamos por el nanolink\n        const link = await Link.findOne({nanoLink: nanolink });\n        // Si no existe una url\n        if (!link) {\n            return res.status(404).json({ error: ' No existe el link' });\n        }\n        return res.json({ longLink: link.longLink });\n    } catch (error) {\n        console.log(error);\n        if (error.kind == \"ObjectId\") {\n            return res.status(403).json({ error: 'Formato id incorrecto' });\n        }\n\n        return res.status(500).json({ error: 'Error de servidor' });\n    }\n}\n\n")),(0,t.kt)("h2",{id:"remove"},"Remove"),(0,t.kt)("h3",{id:"metodo-remove"},"metodo remove()"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Pertenece a una instancia del modelo."),(0,t.kt)("li",{parentName:"ul"},"Elimina el documento que contiene la instancia de la BD."),(0,t.kt)("li",{parentName:"ul"},"Sirve para eliminar el documento de la BD.")),(0,t.kt)("p",null,"link.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { createLink, getLink, getLinks, removeLink } from "../Controllers/link.controller.js";\n\nrouter.delete("/:id" , requireToken , removeLink);\n\n')),(0,t.kt)("p",null,"link.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const removeLink = async (req, res) => {\n    try {\n        // Obtener el valor de la variable(params) de la url\n        const {id} = req.params;\n        // Buscamos por la id\n     const link =    await Link.findById(id);\n   // Si no existe una url\n     if (!link){\n        return res.status(404).json({error: ' No existe el link'});\n     }\n     // Si No corresponde a la id del usuario\n     if (!link.uid.equals(req.uid)) {\n        return res.status(401).json({error: ' No le pertenece este link'});\n     }\n     // Eliminamos de la BD\n     link.remove();\n        return res.json({link});\n    } catch (error) {\n        console.log(error);\n        if (error.kind == \"ObjectId\") {\n            return res.status(403).json({error: 'Formato id incorrecto'});\n        }\n   \n        return res.status(500).json({error: 'Error de servidor'});\n    }\n}\n\n")),(0,t.kt)("h2",{id:"validar-params-variables-de-la-url"},"Validar params (variables de la url)"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Usamos express-validator."),(0,t.kt)("li",{parentName:"ul"},"Se remplaza el m\xe9todo body() por el m\xe9todo param()."),(0,t.kt)("li",{parentName:"ul"},"De esta manera se validan/evaluan las propiedades del params.")),(0,t.kt)("p",null,"validatorManager.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"\nimport {body , param} from 'express-validator';\n\nexport const paramsLinkValidator = [\n    //Se evalua la  propiedad id de params \n    param(\"id\")\n    .trim()\n    .notEmpty() // No este vacio \n    .escape() // Escapamos \n    ,validationResultExpress\n]\n\n")),(0,t.kt)("p",null,"link.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { bodyLinkValidator, paramsLinkValidator } from "../middlewares/validatorManager.js";\n\nrouter.delete("/:id" , paramsLinkValidator , requireToken , removeLink);\n\n')),(0,t.kt)("h2",{id:"modificar"},"Modificar"),(0,t.kt)("p",null,"link.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import { createLink, getLink, getLinks, removeLink, updateLink } from "../Controllers/link.controller.js";\n\nrouter.delete("/:id" ,  requireToken ,  paramsLinkValidator , removeLink);\nrouter.patch("/:id" ,  requireToken ,   paramsLinkValidator ,bodyLinkValidator , updateLink);\n\n')),(0,t.kt)("p",null,"link.controller.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"export const updateLink = async (req, res) => {\n    try {\n        // Obtener el valor de la variable(param) de la url\n        const { id } = req.params;\n        let { longLink } = req.body;\n         //Si la url NO comienza con 'https://' \n        if (!longLink.startsWith('https://')) {\n            // Le a\xf1adimos el https:// al comienzo\n            longLink = 'https://' + longLink;\n        }\n\n\n        // Buscamos por la id\n        const link = await Link.findById(id);\n        // Si no existe una url\n        if (!link) {\n            return res.status(404).json({ error: ' No existe el link' });\n        }\n        // Si No corresponde a la id del usuario\n        if (!link.uid.equals(req.uid)) {\n            return res.status(401).json({ error: ' No le pertenece este link' });\n        }\n        // Modificamos el valor una propiedad \n        link.longLink = longLink;\n        await link.save();\n        return res.json({ link });\n    } catch (error) {\n        console.log(error);\n        if (error.kind == \"ObjectId\") {\n            return res.status(403).json({ error: 'Formato id incorrecto' });\n        }\n\n        return res.status(500).json({ error: 'Error de servidor' });\n    }\n}\n\n")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Modificamos el valor de una propiedad del documento (longLink en este caso) y lo volvemos a guardar (metodo save)."),(0,t.kt)("li",{parentName:"ul"},"MongoDB internamente hace un update de la propiedad que se cambi\xf3 (en este ejemplo modifica la propiedad longLink con el nuevo valor que ingresamos).")))),(0,t.kt)("h2",{id:"redirect-opcional"},"Redirect (Opcional)"),(0,t.kt)("p",null,"index.js "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import express from 'express';\n// Habilitamos las variables de entorno\nimport 'dotenv/config';\nimport './database/connectDB.js'\nimport cookieParser from 'cookie-parser';\nimport authRouter from './routes/auth.route.js';\nimport linkRouter from './routes/link.route.js';\nimport redirectRouter from './routes/redirect.route.js';\n\nconst app = express();\napp.use(express.json());\n// Habilitamos las cookies para poder usarlas\napp.use(cookieParser());\napp.use('/api' , authRouter)\napp.use('/api/links' , linkRouter)\napp.use('/' ,  redirectRouter)\n\n\n// Si no existe, asigna el puerto 500\nconst PORT = process.env.PORT || 5000\napp.listen(PORT , () => console.log('http://localhost:'+PORT));\n\n")),(0,t.kt)("p",null,"Routes/redirect.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import {Router} from "express";\nimport { redirectLink } from "../Controllers/redirect.controllers.js";\n\nconst router = Router();\n\nrouter.get(\'/:nanoLink\' , redirectLink);\n\nexport default router;\n\n')),(0,t.kt)("p",null,"Controllers/redirect.controllers.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import { Link } from \"../models/Link.js\";\nexport const redirectLink = async (req, res) => {\n   \n    try {\n        // Obtener el valor de la variable(params) de la url\n        const { nanoLink } = req.params;\n        // Buscamos por el nanolink\n        const link = await Link.findOne({nanoLink: nanoLink });\n        // Si no existe una url\n        if (!link) {\n            return res.status(404).json({ error: ' No existe el link' });\n        }\n        //redirect(url)\n        //redirreciono a la url\n        return res.redirect(link.longLink)\n    } catch (error) {\n        console.log(error);\n        if (error.kind == \"ObjectId\") {\n            return res.status(403).json({ error: 'Formato id incorrecto' });\n        }\n\n        return res.status(500).json({ error: 'Error de servidor' });\n    }\n}\n\n")),(0,t.kt)("h2",{id:"mongo-sanitize"},"mongo sanitize"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/13436467/javascript-nosql-injection-prevention-in-mongodb"},"Como evitar inyecciones javascript en mongoDB")),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://medium.com/@losantiemi/inyecci%C3%B3n-nosql-en-aplicaciones-de-node-js-y-mongodb-3d4d699f13f4"},"El problema radica en que se le pueda pasar un objeto a la consulta { $ne: 1 }")),(0,t.kt)("li",{parentName:"ul"},"Pero con Moongose nosotros hicimos un esquema, por ende, como definimos los campos como String, estos ser\xe1n interpretados como tal, por ende, no se ejecutar\xe1 el objeto en cuesti\xf3n.")),(0,t.kt)("h2",{id:"cors"},"Cors"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Sirven para interferir con la respuesta."),(0,t.kt)("li",{parentName:"ul"},"La petici\xf3n siempre llega al servidor, pero en base del dominio que realiza la solicitud, le devuelve o no una respuesta. (A un intruso no le devuelve una respuesta)"),(0,t.kt)("li",{parentName:"ul"},"Sirve para especificar que dominios pueden consumir la APP (en este caso la API REST). Seria una lista blanca de dominios.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-powershell"},"npm i cors\n")),(0,t.kt)("p",null,".env"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"ORIGIN1=http://127.0.0.1:5000\n")),(0,t.kt)("p",null,"index.js "),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Habilitamos y configuramos los cors. ")),(0,t.kt)("h3",{id:"cors-sin-configuracion"},"Cors sin configuracion"),(0,t.kt)("p",null,"index.js "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"const app = express();\n// Habilitamos y configuramos los cors.\napp.use(cors())\n\n")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"En la configuraci\xf3n por defecto ,todos los dominios pueden consumir nuestra API ")),(0,t.kt)("h3",{id:"configuracion-de-cors"},"Configuracion de cors"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"La configuraci\xf3n esta en un objeto que se le pasa al metodo cors()")),(0,t.kt)("h4",{id:"propiedad-origin"},"Propiedad Origin"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Especifica Los dominios que tienen acceso a la APP (en este caso la API REST)"),(0,t.kt)("li",{parentName:"ul"},"La propiedad origin recibe una funcion con dos parametros (origin y callback)"),(0,t.kt)("li",{parentName:"ul"},"Origin : function(origin,callback)"),(0,t.kt)("li",{parentName:"ul"},"El par\xe1metro origin es quien est\xe1 haciendo la solicitud (el  dominio que hace la petici\xf3n)"),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://fedeleva.github.io/aprendizaje/Javascript/promesas.html#callback"},"El callback es una funci\xf3n ")," que como primer argumento recibe el error y en el segundo argumento la respuesta satisfactoria (funciono correctamente).")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'import cors from "cors";\nconst app = express();\n// Un array con todos los dominios \nconst whiteList = [process.env.ORIGIN1];\n\n// Habilitamos y configuramos los cors.\n//cors({configuracion})\napp.use(cors({\n    origin: function(origin , callback){\n        // Si el dominio esta autorizado\n        if (whiteList.includes(origin)) {\n            return callback(null, origin);\n        }\n        return callback("Error de CORS origin " + origin + "No autorizado!");\n    }\n    \n}))\n\n')),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Observacion ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Cuando se hace una solicitud desde el mismo dominio que contiene la app, el origin es undefined"))),(0,t.kt)("h3",{id:"lo-dejamos-configurado-para-dos-dominios"},"Lo dejamos configurado para dos dominios"),(0,t.kt)("p",null,".env "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"ORIGIN1=\nORIGIN2=\n\n")),(0,t.kt)("p",null,"Index.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"const whiteList = [process.env.ORIGIN1 , process.env.ORIGIN2];\n")),(0,t.kt)("h2",{id:"deploy-heroku"},"Deploy Heroku"),(0,t.kt)("h3",{id:"a-tener-en-cuenta"},"A tener en cuenta"),(0,t.kt)("h4",{id:"el-puerto"},"El puerto"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Cada hosting tiene un Puerto en especifico.\nindex.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"// Si no existe, asigna el puerto 500\nconst PORT = process.env.PORT || 5000\napp.listen(PORT , () => console.log('http://localhost:'+PORT));\n\n")),(0,t.kt)("h4",{id:"-gitignore"},". gitignore"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Los hosting descargan los modulos y configuran las variables de entorno.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"node_modules\n.env\n\n")),(0,t.kt)("h4",{id:"script"},"Script"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"El script start es el que ejecuta heroku al iniciar el proyecto.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},' "scripts": {\n    "dev": "nodemon index.js",\n    "start": "node index.js"\n  },\n\n')),(0,t.kt)("h3",{id:"en-heroku"},"En Heroku"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Utilizaremos  Heroku CLI  para el deploy")),(0,t.kt)("p",null,"Pasos:"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"Iniciamos sesion en  Heroku"),(0,t.kt)("li",{parentName:"ol"},"Creamos una aplicaci\xf3n (todo por defecto)"),(0,t.kt)("li",{parentName:"ol"},"Nos logueamos en la  consola(cmd , powershell , etc) (en la ubicacion del proyecto) , con el comando:")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-powershell"},"Heroku login\n")),(0,t.kt)("ol",{start:4},(0,t.kt)("li",{parentName:"ol"},"Inicializamos el proyecto , con los comandos:")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"En la ubicaci\xf3n del proyecto:")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-powershell"},"git init\nheroku git:remote -a XXX\nXXX = El nombre de la aplicacion\n")),(0,t.kt)("ol",{start:5},(0,t.kt)("li",{parentName:"ol"},"Hacemos el deploy haciendo el push ")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-powershell"},"git add .\nGit commit -m \u201cmensaje\u201d\ngit push heroku X\nX = master/main dependiendo de que rama principal tenga.\n")),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Por cada deploy , se debe hacer un push"))),(0,t.kt)("ol",{start:6},(0,t.kt)("li",{parentName:"ol"},"Configuramos las variables de entorno (config -- config VARS -- Reveal config vars)")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Copiamos todas las variables de .env menos el modo.")),(0,t.kt)("h3",{id:"cambios-del-proyecto"},"Cambios del proyecto"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Heroku distingue mayuscula con min\xfascula , ojo con el nombre de los archivos o carpetas en las importaciones y exportaciones")),(0,t.kt)("p",null,"index.js "),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import cookieParser from 'cookie-parser';\nimport authRouter from './Routes/auth.route.js';\nimport linkRouter from './Routes/link.route.js';\nimport redirectRouter from './Routes/redirect.route.js';\n\n")),(0,t.kt)("p",null,"auth.route.js"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"import { requireRefreshToken } from '../middlewares/requireRefreshToken.js';\n")),(0,t.kt)("h3",{id:"listo"},"LISTO!"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"More -- Views Logs =  Abrir la consola")),(0,t.kt)("h2",{id:"deploy-con-render"},"Deploy con Render"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"https://render.com/"},"Es una alternativa a Heroku"))),(0,t.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Postman ")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("ul",{parentName:"div"},(0,t.kt)("li",{parentName:"ul"},"Postman hace solicitudes sin dominio(origin)"),(0,t.kt)("li",{parentName:"ul"},"Postman cuando realiza alguna solicitud simula que el origin es el mismo que el de la App (Api REST) (Se comunica a si mismo).")))),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Como el valor de origin es undefined cuando el origin es el mismo que el de la API, modificamos los cors:")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},"// Un array con todos los dominios \nconst whiteList = [process.env.ORIGIN1 , process.env.ORIGIN2 , undefined];\n\n")),(0,t.kt)("h3",{id:"en-el-sitio-web"},"En el sitio web"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"Iniciamos sesion "),(0,t.kt)("li",{parentName:"ol"},"Seleccionamos Web services"),(0,t.kt)("li",{parentName:"ol"},"Vinculamos con un repositorio de Github")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Para esto ya debemos tener el proyecto en un repositorio.")),(0,t.kt)("p",null,"Opciones :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Name = Nombre del proyecto"),(0,t.kt)("li",{parentName:"ul"},"Environment = Con que tecnolog\xeda trabajamos (Node)"),(0,t.kt)("li",{parentName:"ul"},"Branch = La RAMA con la que se hace el deploy."),(0,t.kt)("li",{parentName:"ul"},"Build Command = El comando para construir , ponemos npm install."),(0,t.kt)("li",{parentName:"ul"},"Start Command = El comando para levantar el servidor (El script start) , ponemos npm start"),(0,t.kt)("li",{parentName:"ul"},"Opciones ADVANCED = Te permite agregar variables de entorno , Configuramos las variables de entorno (Todas menos el modo).",(0,t.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,t.kt)("div",{parentName:"div",className:"admonition-heading"},(0,t.kt)("h5",{parentName:"div"},(0,t.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,t.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,t.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,t.kt)("div",{parentName:"div",className:"admonition-content"},(0,t.kt)("p",{parentName:"div"},"Start es el \xfanico comando que no se requiere la palabra run "))))),(0,t.kt)("ol",{start:4},(0,t.kt)("li",{parentName:"ol"},"Por ultimo le damos a Create Web Service")),(0,t.kt)("h3",{id:"listo-1"},"Listo!!"))}m.isMDXComponent=!0}}]);